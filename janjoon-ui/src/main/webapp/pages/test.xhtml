<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/layout.xhtml">
	<ui:define name="content">
		<p:layout styleClass="content" style="min-height:500px;"
			stateful="true">
			<f:event type="preRenderComponent"
				listener="#{jJTestcaseBean.loadData()}" />

			<p:layoutUnit position="west"
				style="min-width:200px;min-height:500px;" resizable="true">
				<h:form id="testFormWest">
					<p:panelGrid style="margin-top:10px;">
						<p:row>
							<p:column>
								<h:outputText for="build" value="Build:" />
								<p:selectOneMenu id="build" value="#{jJBuildBean.build}"
									panelStyle="width:150px;" effect="fade" style="width:150px;"
									filter="true" filterMatchMode="startsWith">
									<f:converter
										converterId="com.starit.janjoonweb.ui.mb.converter.JJBuildConverter" />
									<f:selectItem itemValue="#{null}" itemLabel="-- Select One --" />
									<f:selectItems value="#{jJBuildBean.builds}" var="c"
										itemLabel="#{c.name}" itemValue="#{c}" />
									<p:ajax process="@this" partialSubmit="true"
										update=":testFormCenter" />
								</p:selectOneMenu>
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<h:commandLink id="exportPDF" title="Export category to PDF"
									disabled="#{jJTestcaseBean.disabledExport}">
									<p:graphicImage value="/resources/images/pdf.png" />
									<p:dataExporter type="pdf"
										target=":testFormCenter:testcaseRecapDataTable"
										fileName="#{jJTestcaseBean.namefile}"
										preProcessor="#{jJTestcaseBean.preProcessPDF}" />
								</h:commandLink>
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<p:tree id="testCaseTree" value="#{jJTestcaseBean.rootNode}"
									var="node" selectionMode="single"
									selection="#{jJTestcaseBean.selectedNode}" dynamic="true">
									<p:ajax event="select"
										listener="#{jJTestcaseBean.onNodeSelect}"
										update=":testFormCenter :testFormWest:exportPDF" />
									<p:treeNode>
										<h:outputText value="#{node}" />
										<!--styleClass="#{node.styleClass}" /-->
									</p:treeNode>
								</p:tree>
							</p:column>
						</p:row>
					</p:panelGrid>
				</h:form>
			</p:layoutUnit>
			<p:layoutUnit position="center" resizable="true"
				style="min-height:500px;">
				<h:form id="testFormCenter">
					<p:dataTable id="testcaseRecapDataTable" var="tcr"
						value="#{jJTestcaseBean.testCaseRecaps}" paginator="true" rows="8"
						style="width:550px;" rowKey="#{tcr.testcase.name}"
						rendered="#{jJTestcaseBean.rendredTestCaseRecaps}">
						<f:facet name="header">
							<h:outputText value="#{jJTestcaseBean.chapter.name}" />
						</f:facet>
						<p:column exportable="false">
							<f:facet name="header">
								<h:outputText value="Testcase" />
							</f:facet>
							<h:outputText value="#{tcr.testcase.name}" />
						</p:column>
						<p:column exportable="false">
							<f:facet name="header">
								<h:outputText value="Status" />
							</f:facet>
							<h:outputText value="#{tcr.status}" />
						</p:column>

						<p:column styleClass="action-column">
							<f:facet name="header">
								<h:outputText value="Actions" />
							</f:facet>
							<p:commandButton id="runButton" icon="ui-icon-play"
								oncomplete="runTestcaseDialogWidget.show()"
								action="#{jJTestcaseBean.runTestcase(jJTestcaseexecutionBean,jJTeststepexecutionBean)}"
								update=":runTestcaseDialog" disabled="#{tcr.disabled}">
								<f:setPropertyActionListener value="#{tcr.testcase}"
									target="#{jJTestcaseBean.testcase}" />
							</p:commandButton>
							<p:tooltip for="runButton" value="Run #{tcr.testcase.name}"
								showEffect="fade" hideEffect="fade" />
							<p:commandButton id="editButton" icon="ui-icon-pencil"
								oncomplete="testcaseDialogWidget.show()"
								action="#{jJTestcaseBean.editTestcase(jJTeststepBean)}"
								update=":testcaseDialog">
								<f:setPropertyActionListener value="#{tcr.testcase}"
									target="#{jJTestcaseBean.testcase}" />
							</p:commandButton>
							<p:tooltip for="editButton" value="#{messages.label_edit}"
								showEffect="fade" hideEffect="fade" />
						</p:column>
						<f:facet name="footer">
							<p:commandButton value="New testcase" id="newTestcase"
								actionListener="#{jJTestcaseBean.newTestcase(jJTeststepBean)}"
								update=":testcaseDialog"
								oncomplete="testcaseDialogWidget.show()"
								icon="ui-icon-circle-plus" />
						</f:facet>
					</p:dataTable>

					<p:lineChart id="filled" value="#{chartBean.categoryModel}"
						legendPosition="ne" title="Test Case Execution Statistics"
						seriesColors="#{chartBean.seriesColors}"
						style="height:300px;margin-top:20px;" xaxisLabel="Date"
						yaxisLabel="Test Case Execution" animate="true"
						rendered="#{jJTestcaseBean.rendredTestCaseRecaps}" />

					<p:dataTable id="teststepRecapDataTable"
						value="#{jJTeststepBean.teststeps}" rowKey="#{ts.name}" var="ts"
						rendered="#{jJTestcaseBean.rendredTestCaseHistorical}"
						paginator="true" rows="8" style="width:650px;">
						<f:facet name="header">
							<p:row>
								<p:column>
									<h:outputText
										value="TC #{jJTestcaseBean.testcase.ordering}: #{jJTestcaseBean.testcase.name}" />
								</p:column>

								<p:column>
									<h:outputText
										value="Requirement: #{jJTestcaseBean.testcase.requirement.name}" />
								</p:column>
								<!-- 							<p:column> -->
								<!-- 								<h:outputText value="Description :" /> -->
								<!-- 								<p:editor id="description" widgetVar="descriptionWidget" -->
								<!-- 									style="width:500px;" -->
								<!-- 									value="#{jJTestcaseBean.testcase.description}" disabled="true" /> -->
								<!-- 							</p:column> -->
								<p:column>
									<p:commandButton id="editButton" icon="ui-icon-pencil"
										oncomplete="testcaseDialogWidget.show()"
										action="#{jJTestcaseBean.editTestcase(jJTeststepBean)}"
										update=":testcaseDialog" />
									<p:tooltip for="editButton" value="#{messages.label_edit}"
										showEffect="fade" hideEffect="fade" />
								</p:column>
							</p:row>
						</f:facet>

						<p:column headerText="Order">
							<h:outputText value="#{ts.ordering}" />
						</p:column>

						<p:column headerText="Action">
							<h:outputText value="#{ts.actionstep}" />
						</p:column>
						<p:column headerText="Result">
							<h:outputText value="#{ts.resultstep}" />
						</p:column>
					</p:dataTable>

					<p:dataTable id="testexecutionRecapDataTable"
						value="#{jJTestcaseexecutionBean.testCaseexecutionRecaps}"
						rowKey="#{tce.name}" var="tce"
						rendered="#{jJTestcaseBean.rendredTestCaseHistorical}"
						paginator="true" rows="8" style="width:650px;">
						<p:column headerText="Id">
							<h:outputText value="#{tce.testcaseexecution.id}" />
						</p:column>
						<p:column headerText="Build">
							<h:outputText value="#{tce.testcaseexecution.build.name}" />
						</p:column>
						<p:column headerText="Creation Date">
							<h:outputText value="#{tce.testcaseexecution.creationDate}" />
						</p:column>
						<p:column headerText="Update Date">
							<h:outputText value="#{tce.testcaseexecution.updatedDate}" />
						</p:column>
						<p:column headerText="Status">
							<h:outputText value="#{tce.status}" />
						</p:column>
					</p:dataTable>
				</h:form>
			</p:layoutUnit>
		</p:layout>

		<p:dialog id="testcaseDialog" header="#{jJTestcaseBean.message}"
			modal="true" widgetVar="testcaseDialogWidget" dynamic="true"
			resizable="false">
			<p:ajax event="close" update=":testFormCenter :testFormWest"
				listener="#{jJTestcaseBean.closeDialog()}" />
			<p:outputPanel id="testcaseDialogPanel">
				<h:form id="testcaseDialogForm">
					<p:growl id="msg" />
					<p:scrollPanel style="width:720px;height:500px;" mode="native">
						<p:panelGrid style="margin-top:10px;">
							<p:row>
								<p:column>
									<p:inputText id="name" value="#{jJTestcaseBean.testcase.name}"
										required="true" widgetVar="nameWidget" label="Testcase Name"
										requiredMessage="Testcase Name is a required value">
									</p:inputText>
									<p:watermark for="name" value="Name *" />
									<p:message for="name" id="msgName" />
								</p:column>
								<p:column>
									<h:outputText for="requirement" value="Requirement: *" />
									<p:selectOneMenu id="requirement"
										value="#{jJTestcaseBean.requirement}"
										panelStyle="width:150px;" effect="fade" style="width:150px;"
										filter="true" required="true" filterMatchMode="startsWith"
										widgetVar="requirementWidget"
										requiredMessage="Testcase Requirement is a required value">
										<f:converter
											converterId="com.starit.janjoonweb.ui.mb.converter.JJRequirementConverter" />
										<f:selectItem itemLabel="#{jJTestcaseBean.requirement.name}"
											itemValue="#{jJTestcaseBean.requirement}" />
										<f:selectItems value="#{jJTestcaseBean.requirements}" var="c"
											itemLabel="#{c.name}" itemValue="#{c}" />
										<p:ajax process="@this" partialSubmit="true"
											listener="#{jJTestcaseBean.handleSelectRequirement()}" />
									</p:selectOneMenu>
									<p:message for="requirement" id="msgRequirement" />
								</p:column>
								<p:column>
									<h:outputText value="Automatic: " />
									<p:selectBooleanCheckbox
										value="#{jJTestcaseBean.testcase.automatic}">
										<p:ajax listener="#{jJTestcaseBean.addMessage}" />
									</p:selectBooleanCheckbox>
								</p:column>
							</p:row>
							<p:row>
								<p:column colspan="3">
									<h:outputText value="Description : *" />
									<pe:ckEditor id="description" widgetVar="descriptionWidget"
										style="width:680px;"
										value="#{jJTestcaseBean.testcase.description}" required="true"
										requiredMessage="Testcase Description is a required value" />
									<p:message for="description" id="msgDescription" />
								</p:column>
							</p:row>
							<p:row>
								<p:column>
									<h:outputText value="Initiate Task: " />
									<p:selectBooleanCheckbox id="initiateTask"
										value="#{jJTestcaseBean.initiateTask}"
										disabled="#{jJTestcaseBean.disabledInitTask}">
										<p:ajax listener="#{jJTestcaseBean.loadTask()}"
											update="outputPanel" />
									</p:selectBooleanCheckbox>
								</p:column>
								<p:column>
									<h:outputLabel for="workload" value="Workload: " />
									<p:outputPanel id="outputPanel">
										<p:spinner id="workload"
											value="#{jJTestcaseBean.task.workloadPlanned}" stepFactor="1"
											min="0" disabled="#{jJTestcaseBean.disabledTask}">
											<p:ajax update="workloadvalue" process="@this" />
										</p:spinner>
										<h:outputText id="workloadvalue"
											value="#{jJTestcaseBean.task.workloadPlanned} h" />
									</p:outputPanel>
								</p:column>
								<p:column>
									<p:commandButton id="saveTestcase" value="Save"
										disabled="#{jJTestcaseBean.disabled}"
										actionListener="#{jJTestcaseBean.save()}"
										process="@widgetVar(nameWidget) @widgetVar(requirementWidget) @widgetVar(descriptionWidget)"
										update="saveTestcase action result saveTestStep msg" />
								</p:column>
							</p:row>
							<p:row>
								<p:column>
									<h:outputText for="action" value="Action: *" />
									<p:inputText id="action"
										value="#{jJTeststepBean.teststep.actionstep}"
										disabled="#{jJTestcaseBean.disabledTeststep}"
										label="Teststep Action" required="true"
										requiredMessage="Teststep Action is a required value"
										maxlength="100" widgetVar="actionWidget">
									</p:inputText>
									<p:message for="action" id="msgAction" />
								</p:column>
								<p:column>
									<h:outputText for="result" value="Result: *" />
									<p:inputText id="result"
										value="#{jJTeststepBean.teststep.resultstep}"
										disabled="#{jJTestcaseBean.disabledTeststep}"
										label="Teststep Result" required="true"
										requiredMessage="Teststep Result is a required value"
										maxlength="100" widgetVar="resultWidget">
									</p:inputText>
									<p:message for="result" id="msgResult" />
								</p:column>
								<p:column>
									<p:commandButton id="saveTestStep" value="Add Teststep"
										disabled="#{jJTestcaseBean.disabledTeststep}"
										actionListener="#{jJTeststepBean.save()}"
										icon="ui-icon-circle-plus"
										update="action result testStepDataTable msg"
										process="@widgetVar(actionWidget) @widgetVar(resultWidget)" />
								</p:column>
							</p:row>
						</p:panelGrid>
						<p:dataTable id="testStepDataTable" var="ts"
							value="#{jJTeststepBean.teststeps}" scrollRows="10"
							scrollable="true" scrollHeight="100" style="width:700px;"
							rowKey="#{ts.name}" editable="true">
							<p:ajax event="rowEdit" listener="#{jJTeststepBean.editTestStep}"
								update=":testcaseDialogForm:msg"
								process="@widgetVar(actionInputWidget) @widgetVar(resultInputWidget)" />
							<p:ajax event="rowEditCancel"
								listener="#{jJTeststepBean.cancelEditTestStep}"
								update=":testcaseDialogForm:msg" />
							<f:facet name="header">  
            						Test Steps  
        					</f:facet>
							<p:column headerText="Order" style="width:9%;">
								<h:outputText value="#{ts.ordering}" />
							</p:column>
							<p:column headerText="Action" style="width:33%;">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{ts.actionstep}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText value="#{ts.actionstep}" style="width:90%"
											required="true" label="Action Input"
											widgetVar="actionInputWidget"
											requiredMessage="Action Input is a required value">
										</p:inputText>
									</f:facet>
								</p:cellEditor>
							</p:column>
							<p:column headerText="Result" style="width:33%;">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{ts.resultstep}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText value="#{ts.resultstep}" style="width:90%"
											required="true" label="Result Input"
											widgetVar="resultInputWidget"
											requiredMessage="Result Input is a required value">
										</p:inputText>
									</f:facet>
								</p:cellEditor>
							</p:column>
							<p:column headerText="Actions" style="width:15%;">
								<p:commandButton id="insertTestStep" update="testStepDataTable"
									action="#{jJTeststepBean.insertTestStep()}"
									icon="ui-icon-circle-triangle-n" process="@this"
									style="align:center;">
									<f:setPropertyActionListener value="#{ts}"
										target="#{jJTeststepBean.teststep}" />
								</p:commandButton>
								<p:tooltip for="insertTestStep" value="Insert a Test Step"
									showEffect="fade" hideEffect="fade" />

								<p:commandButton id="deleteTestStep" update="testStepDataTable"
									action="#{jJTeststepBean.deleteTestStep()}"
									icon="ui-icon-circle-minus" process="@this"
									style="align:center;">
									<f:setPropertyActionListener value="#{ts}"
										target="#{jJTeststepBean.teststep}" />
								</p:commandButton>
								<p:tooltip for="deleteTestStep"
									value="#{messages.label_delete} a Test Step" showEffect="fade"
									hideEffect="fade" />
							</p:column>
							<p:column style="width:10%;">
								<p:rowEditor />
							</p:column>
						</p:dataTable>
					</p:scrollPanel>
				</h:form>
			</p:outputPanel>
			<f:facet name="footer">
				<p:row>
					<p:column colspan="3">
						<p:commandButton id="resetButton" value="Reset"
							disabled="#{jJTestcaseBean.disabledReset}"
							update=":testcaseDialogForm"
							action="#{jJTestcaseBean.newTestcase(jJTeststepBean)}" />
					</p:column>
				</p:row>
			</f:facet>
		</p:dialog>

		<p:dialog id="runTestcaseDialog" header="Test Case Execution"
			modal="true" widgetVar="runTestcaseDialogWidget" dynamic="true"
			resizable="false">
			<p:ajax event="close" update=":testFormCenter :testFormWest"
				listener="#{jJTeststepexecutionBean.closeDialog()}" />
			<p:outputPanel id="runTestcaseDialogPanel">
				<h:form id="runForm">
					<p:growl id="msg" />

					<p:scrollPanel style="width:670px;height:450px;" mode="native">

						<p:tabView id="teststepTabView" widgetVar="teststepTabViewWidget"
							activeIndex="#{jJTeststepexecutionBean.activeIndex}"
							dynamic="true" scrollable="true"
							value="#{jJTeststepexecutionBean.teststepexecutions}" var="tse">

							<p:ajax event="tabChange"
								listener="#{jJTeststepexecutionBean.onTabChange}"
								update="teststepTabView :runForm:testcaseexecutionStatus :runForm:quitButton :runForm:nextButton" />

							<p:tab title="#{tse.teststep.ordering}">
								<p:panelGrid style="margin-top:10px;">
									<p:row>
										<p:column>
											<h:outputText value="#{tse.teststep.actionstep}" />
										</p:column>
										<p:column>
											<h:outputText value="#{tse.teststep.resultstep}" />
										</p:column>
									</p:row>
									<p:row>
										<p:column>

											<h:outputText value="Status: " />
										</p:column>
										<p:column>
											<p:selectOneButton value="#{jJTeststepexecutionBean.status}">
												<p:ajax update="name description"
													listener="#{jJTeststepexecutionBean.toto()}" />
												<f:selectItem itemLabel="Passed" itemValue="true" />
												<f:selectItem itemLabel="Failed" itemValue="false" />
											</p:selectOneButton>
										</p:column>
									</p:row>
									<p:row>
										<p:column>
											<h:outputText value="Name : *" />
										</p:column>
										<p:column>
											<p:inputText id="name"
												disabled="#{jJTeststepexecutionBean.disabled}"
												value="#{jJTeststepexecutionBean.bug.name}" required="true"
												widgetVar="nameWidget" label="Testcase Name"
												requiredMessage="Testcase Name is a required value">
											</p:inputText>
											<p:message for="name" id="msgName" />
										</p:column>
									</p:row>
									<p:row>
										<p:column colspan="2">
											<h:outputText value="Description : *" />
											<pe:ckEditor id="description" widgetVar="descriptionWidget"
												style="width:600px;"
												value="#{jJTeststepexecutionBean.bug.description}"
												required="true"
												disabled="#{jJTeststepexecutionBean.disabled}"
												requiredMessage="Testcase Description is a required value" />
											<p:message for="description" id="msgDescription" />
										</p:column>
									</p:row>
								</p:panelGrid>
							</p:tab>

						</p:tabView>

					</p:scrollPanel>

					<p:panelGrid style="margin-top:10px;">
						<p:row>
							<p:column>
								<h:outputText
									value="Would you like to fix the status of this test case execution as :" />
							</p:column>
							<p:column>
								<p:selectOneButton id="testcaseexecutionStatus"
									value="#{jJTestcaseexecutionBean.status}"
									disabled="#{jJTeststepexecutionBean.disabledTestcase}">
									<p:ajax listener="#{jJTestcaseexecutionBean.toto()}" />
									<f:selectItem itemLabel="Passed" itemValue="true" />
									<f:selectItem itemLabel="Failed" itemValue="false" />
								</p:selectOneButton>
							</p:column>
							<p:column>
								<p:commandButton id="quitButton" value="Quit"
									icon="ui-icon-circle-close"
									update=":testFormCenter :testFormWest"
									process="@widgetVar(name) @widgetVar(description)"
									actionListener="#{jJTeststepexecutionBean.quitTab()}"
									style="float: right;"
									disabled="#{jJTeststepexecutionBean.disabledTestcase}" />
							</p:column>

							<p:column>
								<p:commandButton id="nextButton" value="Next"
									icon="ui-icon-circle-arrow-e"
									update="teststepTabView testcaseexecutionStatus quitButton nextButton"
									process="@widgetVar(name) @widgetVar(description)"
									actionListener="#{jJTeststepexecutionBean.nextTab()}"
									style="float: right;"
									disabled="#{jJTeststepexecutionBean.disabledNext}" />
							</p:column>
						</p:row>
					</p:panelGrid>


				</h:form>

			</p:outputPanel>


		</p:dialog>

	</ui:define>
</ui:composition>
</html>