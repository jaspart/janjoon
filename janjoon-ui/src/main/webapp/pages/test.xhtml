<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="../templates/layout.xhtml">
	<ui:define name="content">

		<h:form id="msgForm">
			<p:messages id="msgs" />
		</h:form>

		<h:form id="dataForm">

			<h:panelGrid id="mainPanelGrid" columns="2">


				<h:panelGrid id="leftPanelGrid" columns="1" cellpadding="3">


					<p:outputLabel value="Build :" />
					<p:selectOneMenu id="buildSelectOneMenu"
						value="#{jJBuildBean.jJBuild}" panelStyle="width:150px"
						effect="fade" style="width:160px" filter="true"
						filterMatchMode="startsWith">

						<f:converter
							converterId="com.funder.janjoonweb.ui.mb.converter.JJBuildConverter" />

						<f:selectItem itemLabel="#{jJBuildBean.jJBuild.name}"
							itemValue="#{jJBuildBean.jJBuild}" />
						<f:selectItems value="#{jJBuildBean.jJBuildList}" var="b"
							itemLabel="#{b.name}" itemValue="#{b}" />

						<p:ajax process="@this" partialSubmit="true"
							listener="#{jJBuildBean.handleSelectBuild(JJTestcaseexecutionBean,JJTeststepexecutionBean)}" />
					</p:selectOneMenu>



					<p:commandButton id="runButton" value="Run" icon="ui-icon-play"
						disabled="#{jJTestcaseBean.disabled}"
						actionListener="#{jJTestcaseBean.createTabs}"
						update=":runForm:tabView" process="@this" partialSubmit="true"
						oncomplete="testcaseExecution.show()" />


					<p:contextMenu for="testCaseTreeSingle">

						<p:menuitem id="newTestcase" value="New"
							icon="ui-icon-circle-plus"
							actionListener="#{jJTestcaseBean.newTestcase(jJTeststepBean)}"
							process="@parent" update=":msgForm:msgs :dataForm" />
						<p:menuitem id="editTestcase" value="Edit"
							actionListener="#{jJTestcaseBean.editTestcase(jJTeststepBean)}"
							icon="ui-icon-pencil" process="@parent" update=":dataForm" />
						<p:menuitem id="deleteTestcase" value="Delete"
							icon="ui-icon-close"
							actionListener="#{jJTestcaseBean.deleteTestcase(jJTeststepBean)}"
							process="@parent" update=":msgForm:msgs :dataForm" />
					</p:contextMenu>


					<p:tree id="testCaseTreeSingle" value="#{jJTestcaseBean.rootNode}"
						var="node" selectionMode="single"
						selection="#{jJTestcaseBean.selectedNode}" dynamic="true">
						<p:ajax event="select" update=":msgForm:msgs :dataForm:runButton"
							listener="#{jJTestcaseBean.onNodeSelect}" />
						<p:treeNode>
							<h:outputText value="#{node}" />
						</p:treeNode>
					</p:tree>

				</h:panelGrid>

				<h:panelGrid id="centerPanelGrid" columns="1" cellpadding="3">

					<h:panelGrid id="testCasePanelGrid" columns="3" cellpadding="3">
						<p:inputText id="name" value="#{jJTestcaseBean.jJTestCase.name}"
							label="Name" required="true">
							<f:validateLength minimum="2" />

						</p:inputText>
						<p:message for="name" id="msgName" display="icon" />
						<p:watermark for="name" value="Name *" />


						<p:inputText id="description"
							value="#{jJTestcaseBean.jJTestCase.description}"
							label="Description" required="true">
							<f:validateLength minimum="2" />

						</p:inputText>
						<p:message for="description" id="msgDescription" display="icon" />
						<p:watermark for="description" value="Description *" />
					</h:panelGrid>

					<p:panel id="testStepPanel" style="width:600px">

						<p:messages id="testStepMsgs" />
						<h:panelGrid id="testStepPanelGrid" columns="1" cellpadding="3">
							<h:panelGrid columns="7" cellpadding="3">
								<p:inputText id="action"
									value="#{jJTeststepBean.jJTeststep.actionstep}" label="Action"
									required="true">
									<f:validateLength minimum="2" maximum="100" />

								</p:inputText>
								<p:message for="action" id="msgAction" display="icon" />
								<p:watermark for="action" value="Action *" />


								<p:inputText id="result"
									value="#{jJTeststepBean.jJTeststep.resultat}" label="Result"
									required="true">
									<f:validateLength minimum="2" maximum="100" />

								</p:inputText>
								<p:message for="result" id="msgResult" display="icon" />
								<p:watermark for="result" value="Result *" />

								<p:commandButton id="addTestStep" update="testStepPanel"
									actionListener="#{jJTeststepBean.addTestStep}"
									icon="ui-icon-circle-plus" process="@this,action,result" />

							</h:panelGrid>

							<p:dataTable id="testStepDataTable" var="ts"
								value="#{jJTeststepBean.testStepList}" scrollRows="5"
								scrollable="true" scrollHeight="115" style="width:550px"
								rowKey="#{ts.ordering}" editable="true">

								<p:ajax event="rowEdit"
									listener="#{jJTeststepBean.editTestStep}"
									update=":dataForm:testStepMsgs" process="@this" />
								<p:ajax event="rowEditCancel"
									listener="#{jJTeststepBean.cancelEditTestStep}"
									update=":dataForm:testStepMsgs" process="@this" />

								<f:facet name="header">  
            						Test Steps  
        						</f:facet>

								<p:column headerText="" style="width:9%">
									<h:outputText value="#{ts.ordering}" />
								</p:column>

								<p:column headerText="Action" style="width:33%">
									<p:cellEditor>
										<f:facet name="output">
											<h:outputText value="#{ts.actionstep}" />
										</f:facet>
										<f:facet name="input">
											<p:inputText id="actionInput" value="#{ts.actionstep}"
												style="width:90%" required="true" label="Action Input"
												widgetVar="actionInput">
												<f:validateLength minimum="2" maximum="100" />
											</p:inputText>
										</f:facet>
									</p:cellEditor>
								</p:column>

								<p:column headerText="Result" style="width:33%">
									<p:cellEditor>
										<f:facet name="output">
											<h:outputText value="#{ts.resultat}" />
										</f:facet>
										<f:facet name="input">
											<p:inputText id="resultInput" value="#{ts.resultat}"
												style="width:90%" required="true" label="Result Input"
												widgetVar="resultInput">
												<f:validateLength minimum="2" maximum="100" />
											</p:inputText>
										</f:facet>
									</p:cellEditor>
								</p:column>

								<p:column headerText="">
									<p:commandButton id="insertTestStep"
										icon="ui-icon-circle-triangle-n" process="@this"
										action="#{jJTeststepBean.insertTestStep}"
										update="testStepDataTable :dataForm:testStepMsgs"
										style="align:center">

										<f:setPropertyActionListener value="#{ts}"
											target="#{jJTeststepBean.insertedjJTeststep}" />
									</p:commandButton>
									<p:tooltip for="insertTestStep" value="Insert a Test Step"
										showEffect="fade" hideEffect="fade" />

									<p:commandButton id="deleteTestStep"
										icon="ui-icon-circle-minus" process="@this"
										oncomplete="deleteTestStep.show()" style="align:center">
										<f:setPropertyActionListener value="#{ts}"
											target="#{jJTeststepBean.deletedjJTeststep}" />
									</p:commandButton>

									<p:tooltip for="deleteTestStep"
										value="#{messages.label_delete} a Test Step" showEffect="fade"
										hideEffect="fade" />


								</p:column>
								<p:column style="width:10%">
									<p:rowEditor />
								</p:column>

							</p:dataTable>


						</h:panelGrid>
					</p:panel>

				</h:panelGrid>

				<h:panelGrid id="SouthPanelGrid" columns="1" cellpadding="3">
					<p:commandButton id="btn" value="Save"
						update=":msgForm:msgs :dataForm"
						actionListener="#{jJTestcaseBean.persistTestCase(jJTeststepBean)}"
						icon="ui-icon-disk"
						process="@this,name,description @widgetVar(actionInput) @widgetVar(resultInput)" />
				</h:panelGrid>

			</h:panelGrid>

		</h:form>

		<p:confirmDialog id="deleteTestStepDialog" widgetVar="deleteTestStep"
			message="#{messages.label_delete_record}" showEffect="fade"
			hideEffect="explode" header="#{messages.label_confirm_deletion}"
			severity="alarm">
			<p:outputPanel id="deleteTestStepPanel">
				<h:form id="deleteTestStepForm">
					<p:commandButton id="deleteYesButton" value="#{messages.label_yes}"
						action="#{jJTeststepBean.deleteTestStep}"
						update=":dataForm:testStepMsgs  :dataForm:testStepDataTable"
						oncomplete="deleteTestStep.hide()" process="@this" />
					<p:commandButton id="deleteNoButton" value="#{messages.label_no}"
						onclick="deleteTestStep.hide()" type="button" />
				</h:form>
			</p:outputPanel>
		</p:confirmDialog>


		<p:confirmDialog id="deleteTestCaseDialog" widgetVar="deleteTestCase"
			message="#{messages.label_delete_record}" showEffect="fade"
			hideEffect="explode" header="#{messages.label_confirm_deletion}"
			severity="alarm">
			<p:outputPanel id="deleteTestCasePanel">
				<h:form id="deleteTestCaseForm">
					<p:commandButton id="deleteYesButton" value="#{messages.label_yes}"
						action="#{jJTestcaseBean.deleteNode()}"
						update=":msgForm:msgs :dataForm:testCaseTreeSingle"
						oncomplete="deleteTestCase.hide()" />
					<p:commandButton id="deleteNoButton" value="#{messages.label_no}"
						onclick="deleteTestCase.hide()" type="button" />
				</h:form>
			</p:outputPanel>
		</p:confirmDialog>

		<p:dialog id="runTestcaseDialog" header="Test Case Execution"
			widgetVar="testcaseExecution" maximizable="true" minimizable="false"
			showEffect="fade" hideEffect="fade" dynamic="true" style="width:400px">
			<h:form id="runForm">
				<h:panelGrid columns="1">
					<p:tabView id="tabView" var="teststep"
						value="#{jJTestcaseBean.jJTeststepList}"
						widgetVar="teststepTabView"
						activeIndex="#{jJTestcaseBean.tabIndex}" dynamic="true">
					
						<p:tab title="#{teststep.ordering}">
							<h:panelGrid columns="2">
								<p:panel>
									<h:outputText value="#{teststep.actionstep}" />
								</p:panel>
								<p:panel>
									<h:outputText value="#{teststep.resultat}" />
								</p:panel>
							</h:panelGrid>
						</p:tab>
					</p:tabView>
					<p:commandButton id="nextButton" value="Next"
						icon="ui-icon-arrowthick-1-e"
						actionListener="#{jJTestcaseBean.incrementTabIndex}"
						update=":runForm:tabView" />
				</h:panelGrid>
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>
</html>