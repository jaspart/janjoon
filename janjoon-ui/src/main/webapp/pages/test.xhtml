<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="../templates/layout.xhtml">
	<ui:define name="content">

		<h:form id="msgForm">
			<p:messages id="msgs" />
		</h:form>

		<h:form id="testForm">
			<f:event type="preRenderComponent"
				listener="#{jJTestcaseBean.load(jJProjectBean,jJTeststepBean,jJChapterBean,jJProductBean,jJBugBean)}" />
			<h:panelGrid id="mainPanelGrid" columns="2">


				<h:panelGrid id="leftPanelGrid" columns="1" cellpadding="3">


					<p:outputLabel value="Build :" />
					<p:selectOneMenu id="buildSelectOneMenu"
						value="#{jJBuildBean.jJBuild}" panelStyle="width:150px"
						effect="fade" style="width:160px" filter="true"
						filterMatchMode="startsWith">

						<f:converter
							converterId="com.starit.janjoonweb.ui.mb.converter.JJBuildConverter" />

						<f:selectItem itemValue="#{null}" itemLabel="-- select one --" />
						<f:selectItems value="#{jJBuildBean.jJBuildList}" var="b"
							itemLabel="#{b.name}" itemValue="#{b}" />

						<p:ajax
							listener="#{jJBuildBean.handleSelectBuild(jJTestcaseexecutionBean,jJTeststepexecutionBean,jJTestcaseBean)}" />
					</p:selectOneMenu>



					<p:commandButton id="runButton" value="Run" icon="ui-icon-play"
						disabled="#{jJTestcaseBean.disabled}"
						actionListener="#{jJTestcaseBean.createTabs(jJTestcaseexecutionBean,jJTeststepexecutionBean,jJBugBean)}"
						update=":runForm:tabView :runForm:passedButton :runForm:quitButton :runForm:commentBug"
						process="@this" partialSubmit="true"
						oncomplete="testcaseExecution.show()" />


					<p:contextMenu for="testCaseTreeSingle">
						<p:menuitem id="editTestcase" value="Edit"
							actionListener="#{jJTestcaseBean.editTestcase(jJTeststepBean)}"
							icon="ui-icon-pencil" process="@parent"
							update=":testForm:centerPanelGrid" />
						<p:menuitem id="deleteTestcase" value="Delete"
							icon="ui-icon-close"
							actionListener="#{jJTestcaseBean.deleteTestcase(jJTeststepBean)}"
							process="@parent" update=":msgForm:msgs :testForm" />
					</p:contextMenu>


					<p:tree id="testCaseTreeSingle" value="#{jJTestcaseBean.rootNode}"
						var="node" selectionMode="single"
						selection="#{jJTestcaseBean.selectedNode}" dynamic="true">
						<p:ajax event="select"
							update=":msgForm:msgs :testForm:newTestcase :testForm:runButton :testForm:centerPanelGrid"
							listener="#{jJTestcaseBean.onNodeSelect}" />
						<p:treeNode>
							<h:outputText value="#{node}" />
						</p:treeNode>
					</p:tree>

					<p:commandButton id="newTestcase" value="New Testcase"
						disabled="#{jJTestcaseBean.disabledNewTestcase}"
						icon="ui-icon-circle-plus"
						actionListener="#{jJTestcaseBean.processNewTestcase(jJTeststepBean)}"
						update=":msgForm:msgs :testForm:centerPanelGrid" />


				</h:panelGrid>

				<h:panelGrid id="centerPanelGrid" columns="1" cellpadding="3">

					<h:panelGrid id="statisticPanelGrid" columns="1" cellpadding="3">

						<f:facet name="header">Statistique</f:facet>

					</h:panelGrid>

					<h:panelGrid id="testCasePanelGrid" columns="3" cellpadding="3"
						rendered="#{jJTestcaseBean.rendered}">
						<p:inputText id="name" value="#{jJTestcaseBean.jJTestCase.name}"
							label="Name" required="true">
							<f:validateLength minimum="2" />

						</p:inputText>
						<p:message for="name" id="msgName" display="icon" />
						<p:watermark for="name" value="Name *" />


						<p:inputText id="description"
							value="#{jJTestcaseBean.jJTestCase.description}"
							label="Description" required="true">
							<f:validateLength minimum="2" />

						</p:inputText>
						<p:message for="description" id="msgDescription" display="icon" />
						<p:watermark for="description" value="Description *" />

						<h:outputText value="Selected Requirement : " />

						<h:outputText id="selectedTitle"
							value="#{jJTestcaseBean.selectedTitle}" />

						<h:panelGrid columns="1" style="margin-bottom:10px"
							cellpadding="5">
							<p:dataTable id="requirements" var="req"
								value="#{jJTestcaseBean.reqListModel}"
								selection="#{jJTestcaseBean.selectedReq}" paginator="true"
								rows="3" widgetVar="requirementTable">

								<p:ajax event="rowSelectRadio"
									listener="#{jJTestcaseBean.onRowSelect}"
									update=":testForm:selectedTitle" />

								<f:facet name="header">
								Requirements List Based Selection
								</f:facet>

								<p:column id="selectColumn" selectionMode="single"
									style="width:2%" />


								<p:column id="nameColumn" filterBy="name" headerText="Name"
									filterMatchMode="startsWith" style="width:25%">
									<h:outputText value="#{req.name}" />
								</p:column>

								<p:column id="categoryColumn" filterBy="category"
									headerText="Category"
									filterOptions="#{jJTestcaseBean.categoryOptions}"
									filterMatchMode="exact">
									<h:outputText value="#{req.category.name}" />
								</p:column>

							</p:dataTable>


						</h:panelGrid>


					</h:panelGrid>

					<p:panel id="testStepPanel" style="width:600px"
						rendered="#{jJTestcaseBean.rendered}">

						<p:messages id="testStepMsgs" />
						<h:panelGrid id="testStepPanelGrid" columns="1" cellpadding="3">
							<h:panelGrid columns="7" cellpadding="3">
								<p:inputText id="action"
									value="#{jJTeststepBean.jJTeststep.actionstep}" label="Action"
									required="true">
									<f:validateLength minimum="2" maximum="100" />

								</p:inputText>
								<p:message for="action" id="msgAction" display="icon" />
								<p:watermark for="action" value="Action *" />


								<p:inputText id="result"
									value="#{jJTeststepBean.jJTeststep.resultat}" label="Result"
									required="true">
									<f:validateLength minimum="2" maximum="100" />

								</p:inputText>
								<p:message for="result" id="msgResult" display="icon" />
								<p:watermark for="result" value="Result *" />

								<p:commandButton id="addTestStep" update="testStepPanel"
									actionListener="#{jJTeststepBean.addTestStep}"
									icon="ui-icon-circle-plus" process="@this,action,result" />

							</h:panelGrid>

							<p:dataTable id="testStepDataTable" var="ts"
								value="#{jJTeststepBean.testStepList}" scrollRows="5"
								scrollable="true" scrollHeight="115" style="width:550px"
								rowKey="#{ts.ordering}" editable="true">

								<p:ajax event="rowEdit"
									listener="#{jJTeststepBean.editTestStep}"
									update=":testForm:testStepMsgs" process="@this" />
								<p:ajax event="rowEditCancel"
									listener="#{jJTeststepBean.cancelEditTestStep}"
									update=":testForm:testStepMsgs" process="@this" />

								<f:facet name="header">  
            						Test Steps  
        						</f:facet>

								<p:column headerText="" style="width:9%">
									<h:outputText value="#{ts.ordering}" />
								</p:column>

								<p:column headerText="Action" style="width:33%">
									<p:cellEditor>
										<f:facet name="output">
											<h:outputText value="#{ts.actionstep}" />
										</f:facet>
										<f:facet name="input">
											<p:inputText id="actionInput" value="#{ts.actionstep}"
												style="width:90%" required="true" label="Action Input"
												widgetVar="actionInput">
												<f:validateLength minimum="2" maximum="100" />
											</p:inputText>
										</f:facet>
									</p:cellEditor>
								</p:column>

								<p:column headerText="Result" style="width:33%">
									<p:cellEditor>
										<f:facet name="output">
											<h:outputText value="#{ts.resultat}" />
										</f:facet>
										<f:facet name="input">
											<p:inputText id="resultInput" value="#{ts.resultat}"
												style="width:90%" required="true" label="Result Input"
												widgetVar="resultInput">
												<f:validateLength minimum="2" maximum="100" />
											</p:inputText>
										</f:facet>
									</p:cellEditor>
								</p:column>

								<p:column headerText="">
									<p:commandButton id="insertTestStep"
										icon="ui-icon-circle-triangle-n" process="@this"
										action="#{jJTeststepBean.insertTestStep}"
										update="testStepDataTable :testForm:testStepMsgs"
										style="align:center">

										<f:setPropertyActionListener value="#{ts}"
											target="#{jJTeststepBean.insertedjJTeststep}" />
									</p:commandButton>
									<p:tooltip for="insertTestStep" value="Insert a Test Step"
										showEffect="fade" hideEffect="fade" />

									<p:commandButton id="deleteTestStep"
										icon="ui-icon-circle-minus" process="@this"
										oncomplete="deleteTestStep.show()" style="align:center">
										<f:setPropertyActionListener value="#{ts}"
											target="#{jJTeststepBean.deletedjJTeststep}" />
									</p:commandButton>

									<p:tooltip for="deleteTestStep"
										value="#{messages.label_delete} a Test Step" showEffect="fade"
										hideEffect="fade" />


								</p:column>
								<p:column style="width:10%">
									<p:rowEditor />
								</p:column>

							</p:dataTable>


						</h:panelGrid>
					</p:panel>

					<h:panelGrid id="SouthPanelGrid" columns="1" cellpadding="3"
						rendered="#{jJTestcaseBean.rendered}">
						<p:commandButton id="btn" value="Save"
							update=":msgForm:msgs :testForm"
							actionListener="#{jJTestcaseBean.persistTestCase(jJTeststepBean)}"
							icon="ui-icon-disk"
							process="@this,name,description @widgetVar(actionInput) @widgetVar(resultInput) @widgetVar(requirementTable) " />
					</h:panelGrid>

				</h:panelGrid>



			</h:panelGrid>

		</h:form>

		<p:confirmDialog id="deleteTestStepDialog" widgetVar="deleteTestStep"
			message="#{messages.label_delete_record}" showEffect="fade"
			hideEffect="explode" header="#{messages.label_confirm_deletion}"
			severity="alarm">
			<p:outputPanel id="deleteTestStepPanel">
				<h:form id="deleteTestStepForm">
					<p:commandButton id="deleteYesButton" value="#{messages.label_yes}"
						action="#{jJTeststepBean.deleteTestStep}"
						update=":testForm:testStepMsgs  :testForm:testStepDataTable"
						oncomplete="deleteTestStep.hide()" process="@this" />
					<p:commandButton id="deleteNoButton" value="#{messages.label_no}"
						onclick="deleteTestStep.hide()" type="button" />
				</h:form>
			</p:outputPanel>
		</p:confirmDialog>


		<p:confirmDialog id="deleteTestCaseDialog" widgetVar="deleteTestCase"
			message="#{messages.label_delete_record}" showEffect="fade"
			hideEffect="explode" header="#{messages.label_confirm_deletion}"
			severity="alarm">
			<p:outputPanel id="deleteTestCasePanel">
				<h:form id="deleteTestCaseForm">
					<p:commandButton id="deleteYesButton" value="#{messages.label_yes}"
						action="#{jJTestcaseBean.deleteNode()}"
						update=":msgForm:msgs :testForm:testCaseTreeSingle"
						oncomplete="deleteTestCase.hide()" />
					<p:commandButton id="deleteNoButton" value="#{messages.label_no}"
						onclick="deleteTestCase.hide()" type="button" />
				</h:form>
			</p:outputPanel>
		</p:confirmDialog>

		<p:dialog id="runTestcaseDialog" header="Test Case Execution"
			widgetVar="testcaseExecution" showEffect="fade" hideEffect="fade"
			dynamic="true" style="width:400px">
			<h:form id="runForm">
				<h:panelGrid columns="1" cellpadding="3">
					<p:tabView id="tabView" var="teststepexecution"
						value="#{jJTeststepexecutionBean.jJTeststepexecutionList}"
						widgetVar="teststepTabView"
						activeIndex="#{jJTestcaseBean.tabIndex}" dynamic="true">
						<p:ajax event="tabChange"
							listener="#{jJTestcaseBean.onTabChange(jJTeststepexecutionBean,jJBugBean)}"
							update=":runForm:passedButton :runForm:quitButton :runForm:commentBug" />
						<p:tab title="#{teststepexecution.teststep.ordering}">
							<h:panelGrid columns="2">
								<p:panel>
									<h:outputText value="#{teststepexecution.teststep.actionstep}" />
								</p:panel>
								<p:panel>
									<h:outputText value="#{teststepexecution.teststep.resultat}" />
								</p:panel>
							</h:panelGrid>
						</p:tab>
					</p:tabView>
					<h:panelGrid columns="2" cellpadding="3">

						<p:selectBooleanButton id="passedButton"
							value="#{jJTestcaseBean.passed}" onLabel="Passed"
							offLabel="Failed" onIcon="ui-icon-circle-check"
							offIcon="ui-icon-alert">
							<p:ajax
								listener="#{jJTestcaseBean.onChangeValue(jJTeststepexecutionBean,jJBugBean)}"
								update="quitButton,commentBug" />
						</p:selectBooleanButton>

						<p:commandButton id="quitButton" value="Quit"
							icon="ui-icon-circle-close"
							actionListener="#{jJTestcaseBean.quitRun(jJTestcaseexecutionBean,jJTeststepexecutionBean,jJBugBean)}"
							oncomplete="testcaseExecution.hide()"
							disabled="#{jJTestcaseBean.passed}" />

						<p:inputText id="commentBug"
							value="#{jJBugBean.jJBug.description}"
							disabled="#{jJTestcaseBean.passed}" />

						<p:commandButton id="nextButton" value="Next"
							icon="ui-icon-circle-arrow-e"
							actionListener="#{jJTestcaseBean.nextTabIndex(jJTestcaseexecutionBean,jJTeststepexecutionBean,jJBugBean)}"
							update=":runForm:tabView,passedButton,quitButton,commentBug" />
					</h:panelGrid>
				</h:panelGrid>
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>
</html>