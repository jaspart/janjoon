<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<ui:composition template="../templates/layout.xhtml">
	<ui:define name="content">
		<p:growl id="notif" showDetail="true" life="2000" />
		<p:growl id="dev" showDetail="true" life="2000" />

		<!--p:panel id="mainPanel" toggleable="true" toggleSpeed="250">
			<f:facet name="header">
				<h:outputFormat value="#{messages.main_welcome_title}">
					<f:param value="#{messages.label_appName}" />
				</h:outputFormat>
			</f:facet>
			<p />
			<h:outputText id="welcomeText" value="#{messages.label_welcome_text}" />
			<p />
		</p:panel>
		<br /-->

		<p:panel id="dataPanel" rendered="#{loginBean.enable}"
			header="#{messages.main_communication_title}"
			styleClass="customTitleBar"
			style="height: 400px;background: #DDEEFF;">
			<f:event listener="#{jJMessageBean.initJJmessageTable}"
				type="preRenderView"/>

			<h:form id="messageForm">
				<p:dataTable id="MessageTable2" sortMode="multiple"
					value="#{jJMessageBean.mainMessages}" rowKey="#{mes.id}" var="mes"
					widgetVar="messageTable" paginator="true" rows="4"
					paginatorPosition="bottom" sortBy="#{mes.creationDate}"
					sortOrder="ASCENDING"
					paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
					lazy="true" emptyMessage="#{messages.label_notFound}"
					rowClasses="order-table-odd-row,order-table-even-row">
					<!--f:facet name="header">
						<p:outputPanel>
							<h:outputText value="#{messages.main_communication_search_label}" />
							<p:inputText id="globalFilter"
								onkeyup="PF('messageTable').filter()" style="width:200px"
								placeholder="#{messages.main_communication_search_watermark}" />
						</p:outputPanel>
					</f:facet-->
					<p:column style="width: 70px !important;text-align: center;">
						<f:facet name="header">
							<p:commandButton id="createButton" icon="ui-icon-plusthick"
								update=":messageDialogForm"
								oncomplete="PF('messageDialog').show();" />
							<!-- 							<p:tooltip for="createButton" value="#{messages.label_create}" -->
							<!-- 								showEffect="fade" hideEffect="fade" /> -->
						</f:facet>
						<p:graphicImage styleClass="avatar" value="#{imageStreamer.image}">
							<f:param name="contactId" value="#{mes.createdBy.id}" />
						</p:graphicImage>

					</p:column>
					<p:column style="width: 10%;min-width: 200px !important; ">
						<h:outputText
							value="#{mes.createdBy.firstname} #{mes.createdBy.name}"
							style="font-weight: bold;color: #3b5998;" />
						<br />
						<h:outputText value="#{mes.creationDate}"
							style="color: #9197a3;font-size: 10px;">
							<f:converter converterId="extendedDateTimeConverter" />
							<f:attribute name="pattern" value="dd/MM/yyyy HH:mm:ss" />
							<f:attribute name="timeZone" value="UCL" />
						</h:outputText>
						<br />
						<h:outputText value="#{mes.project.name} / #{mes.product.name}"
							style="font-weight: bold;color: #9197a3;font-size: 10px;" />
					</p:column>
					<p:column headerText="#{messages.main_communication_message_title}"
						filterBy="#{mes.message}" filterMatchMode="contains"
						sortBy="#{mes.message}" filterStyle="width: 85%;"
						style="width: 65%;min-width: 200px">
						<h:outputText
							style="width: 100% !important;color: #22222222;font-size: 14px;"
							value="#{mes.message}" />
					</p:column>
					<p:column style="width:5% !important;">
						<p:commandButton id="resolveButton" icon="ui-icon-minus"
							oncomplete="PF('resolveDialogWidget').show()"
							title="#{messages.label_disable}">
							<!--value="#{messages.main_communication_resolve_button}"-->
							<f:setPropertyActionListener value="#{mes}"
								target="#{jJMessageBean.resolvedJJMessage}" />
						</p:commandButton>
						<p:tooltip for="resolveButton" value="#{messages.label_disable}"
							showEffect="fade" hideEffect="fade" />
					</p:column>
				</p:dataTable>
			</h:form>


			<!--h:form id="messageForm">
				<p:dataTable id="MessageTable2" sortMode="multiple" 
					value="#{jJMessageBean.mainMessages}" rowKey="#{mes.id}" var="mes"
					widgetVar="messageTable"  paginator="true" rows="6" paginatorPosition="bottom"
					paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
					lazy="true"					
					emptyMessage="#{messages.label_notFound}">
					<f:facet name="header">
						<p:outputPanel>
							<h:outputText value="#{messages.main_communication_search_label}" />
							<p:inputText id="globalFilter"
								onkeyup="PF('messageTable').filter()" style="width:200px"
								placeholder="#{messages.main_communication_search_watermark}" />
						</p:outputPanel>
					</f:facet>
					<p:column headerText="#{messages.main_communication_creator_title}"
						filterBy="createdBy.name" sortBy="createdBy.name"
						filterOptions="#{jJMessageBean.creatorOptions}"
						filterMatchMode="exact" filterStyle="width: 90%;"
						style="width: 6% !important;height: 5px !important;">
						<h:outputText value="#{mes.createdBy.firstname} #{mes.createdBy.name}" />
					</p:column>
					<p:column
						headerText="#{messages.main_communication_creation_title}"
						sortBy="creationDate"
						style="width: 6% !important;height: 5px !important;">
						<h:outputText value="#{mes.creationDate}">
							<f:converter converterId="extendedDateTimeConverter" />
							<f:attribute name="pattern" value="dd/MM/yyyy" />
							<f:attribute name="timeZone" value="UCL" />

						</h:outputText>
					</p:column>
					<p:column headerText="#{messages.main_communication_project_title}"
						filterBy="project.name" sortBy="project.name"
						filterOptions="#{jJMessageBean.projectOptions}"
						filterMatchMode="exact" filterStyle="width: 90%;"
						style="width: 6% !important;height: 5px !important;">
						<h:outputText value="#{mes.project.name}" />
					</p:column>
					<p:column headerText="#{messages.main_communication_product_title}"
						filterBy="product.name" sortBy="product.name"
						filterOptions="#{jJMessageBean.productOptions}"
						filterMatchMode="exact" filterStyle="width: 90%;"
						style="width: 6% !important;height: 5px !important;">
						<h:outputText value="#{mes.product.name}" />
					</p:column>
					<p:column headerText="#{messages.main_communication_message_title}"
						filterBy="message" filterMatchMode="contains" sortBy="message"
						filterStyle="width: 90%;"
						style="width: 10% !important;height: 5px !important;">
						<h:outputText style="width: 90% !important;"
							value="#{mes.message}" />
					</p:column-->
			<!--p:column
						headerText="#{messages.main_communication_criticity_title}"
						filterBy="criticity.name" sortBy="criticity.name"
						filterMatchMode="exact"
						style="width: 6% !important;height: 5px !important;"
						filterOptions="#{jJMessageBean.criticityOptions}"
						filterStyle="width: 90%;">
						<h:outputText value="#{mes.criticity.name}" />
					</p:column-->
			<!--p:column headerText="#{messages.main_communication_status_title}"
						sortBy="status.name" filterBy="status.name"
						filterMatchMode="exact"
						filterOptions="#{jJMessageBean.statusOptions}"
						style="width: 6% !important;height: 5px !important;"
						filterStyle="width: 90%;">
						<h:outputText value="#{mes.status.name}" />
					</p:column-->
			<!--p:column headerText="#{messages.main_communication_resolve_title}"
						style="width:5% !important;">
						<p:commandButton id="resolveButton"
							value="#{messages.main_communication_resolve_button}"
							oncomplete="PF('resolveDialogWidget').show()"
							title="#{messages.label_disable}">
							<f:setPropertyActionListener value="#{mes}"
								target="#{jJMessageBean.resolvedJJMessage}" />
						</p:commandButton>
						<p:tooltip for="resolveButton" value="#{messages.label_disable}"
							showEffect="fade" hideEffect="fade" />
					</p:column-->
			<!--/p:dataTable>
			</h:form-->
			<p:growl id="notifMPT" showDetail="true" life="2000" />
			<p:confirmDialog id="resolveDialog" widgetVar="resolveDialogWidget"
				message="#{messages.label_disable_record}" showEffect="fade"
				hideEffect="explode" header="#{messages.label_confirm_disabling}"
				severity="alarm">
				<p:outputPanel id="deletePanel">
					<h:form id="deleteForm">
						<p:commandButton id="deleteYesButton"
							value="#{messages.label_yes}"
							action="#{jJMessageBean.resolveJJMessage}"
							update=":messageForm,:notifMPT"
							oncomplete="PF('resolveDialogWidget').hide()" />
						<p:commandButton id="deleteNoButton" value="#{messages.label_no}"
							onclick="PF('resolveDialogWidget').hide()" type="button" />
					</h:form>
				</p:outputPanel>
			</p:confirmDialog>
		</p:panel>

		<p:panel id="taskPanel" rendered="#{loginBean.enable}"
			header="#{messages.main_taskPanel_header}"
			styleClass="customTitleBar">
			<f:event listener="#{jJTaskBean.initToDoTasks}"
				type="preRenderComponent" />
			<h:form id="taskForm">
				<p:dataTable id="taskTable" value="#{jJTaskBean.toDoTasks}"
					rowKey="#{task.id}" var="task" widgetVar="taskTable"
					scrollable="true" scrollHeight="200" style="table-layout: fixed;"
					emptyMessage="There is no Task to do, dee more in project View">

					<p:column headerText="Task">
						<h:outputText value="#{task}" converter="JJTaskConverter" />
					</p:column>

					<p:column headerText="Specification">
						<h:outputText value="#{task.requirement}"
							converter="JJRequirementConverter" />
					</p:column>

					<p:column headerText="Bug">
						<h:outputText value="#{task.bug}" converter="JJBugConverter" />
					</p:column>

					<p:column headerText="Project" style="width:100px;">
						<h:outputText value="#{task.requirement.project}"
							converter="JJProjectConverter"
							rendered="#{task.requirement != null}" />

						<h:outputText value="#{task.bug.project}"
							converter="JJProjectConverter"
							rendered="#{task.requirement == null and task.bug != null }" />

						<h:outputText value="#{task.sprint.project}"
							converter="JJProjectConverter"
							rendered="#{task.requirement == null and task.bug == null and task.sprint != null}" />
					</p:column>

					<p:column headerText="Start Date :" style="width:100px;">
						<h:outputText value="#{task.startDateReal}">
							<f:converter converterId="extendedDateTimeConverter" />
							<f:attribute name="pattern" value="dd/MM/yyyy" />
							<f:attribute name="timeZone" value="UCL" />
						</h:outputText>
					</p:column>


					<p:column headerText="WorkLoad" style="width:100px;">
						<h:outputText value="#{task.workloadPlanned}" />
					</p:column>

					<p:column styleClass="action-column" style="width:80px;"
						headerText="#{messages.bug_table_action_title}">
						<p:commandButton id="viewTaskButton" icon="ui-icon-zoomin"
							update=":viewTaskForm" immediate="true"
							title="#{messages.project_gantt_table_actions_viewMenuItem}"
							action="#{jJTaskBean.initiateReqTreeNode}">
							<f:setPropertyActionListener value="#{task}"
								target="#{jJTaskBean.task}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>
			</h:form>
			<p:dialog id="viewTaskDialog" header="#{messages.label_view} JJTask"
				modal="true" widgetVar="viewTaskDialogWidget" dynamic="true"
				resizable="true" maximizable="true"  showEffect="fade" 
				hideEffect="explode" draggable="false">
				<p:ajax event="close" update=":taskForm"
					listener="#{jJTaskBean.closeEvent('main')}" />
				<p:outputPanel id="viewTaskPanel">
					<h:form id="viewTaskForm" enctype="multipart/form-data">
					<p:remoteCommand name="updateForm" update=":viewTaskForm"/>
						<ui:include src="taskDialog.xhtml">
							<ui:param name="JJTask_" value="#{jJTaskBean.task}" />
						</ui:include>
						
						<p:commandButton id="updateTaskButton" update=":viewTaskForm"
							actionListener="#{jJTaskBean.updateTask(jJTaskBean.task,'main')}"
							value="#{messages.label_update} Task"
							onstart="PF('viewtaskBlockUIWidget').block()"
							style="margin-top: 5px;"
							oncomplete="PF('viewtaskBlockUIWidget').unblock();"
							process="@this,taskSprint,taskStatus,taskStartDatePlanned,taskEndDatePlanned,taskWorkload" />
							
						<p:commandButton id="viewCloseButton"
							value="#{messages.label_close}"
							style="margin-left: 20px;margin-top: 5px;"
							oncomplete="PF('blockUIWidget').unblock()"
							onstart="PF('blockUIWidget').block()"
							onclick="PF('viewTaskDialogWidget').hide()" type="button" />
					</h:form>
				</p:outputPanel>
			</p:dialog>
		</p:panel>

		<p:panel id="specpanel" header="#{messages.main_specPanel_header}"
			rendered="#{loginBean.enable and loginBean.noCouvretReq != null}"
			styleClass="customTitleBar">

			<!-- 			<f:event listener="#{loginBean.initNonCouvretSpec}" -->
			<!-- 				type="preRenderView" /> -->
			<h:form id="specForm">
				<p:dataTable id="specTable" value="#{loginBean.noCouvretReq}"
					rowKey="#{req.id}" var="req" widgetVar="taskTable"
					scrollable="true" scrollHeight="200"
					emptyMessage="There is no Requirement non couvered,See all in Spec View">

					<p:column headerText="Specification">
						<!-- 						<h:outputText value="#{req}" converter="JJRequirementConverter" /> -->
						<p:commandLink target="_blank" value="#{req.name}"
							action="#{jJRequirementBean.requirementInfo}" ajax="false">
							<f:setPropertyActionListener value="#{req}"
								target="#{jJRequirementBean.requirement}" />
						</p:commandLink>
					</p:column>

					<p:column headerText="Chapter">
						<h:outputText value="#{req.chapter}"
							converter="JJChapterConverter" />
					</p:column>

					<p:column headerText="Project">
						<h:outputText value="#{req.project}"
							converter="JJProjectConverter" />
					</p:column>

					<p:column headerText="Category">
						<h:outputText value="#{req.category}"
							converter="JJCategoryConverter" />
					</p:column>

					<p:column headerText="Version">
						<h:outputText value="#{req.versioning}"
							converter="JJVersionConverter" />
					</p:column>

					<p:column headerText="Status">
						<h:outputText value="#{req.status}" converter="JJStatusConverter" />
					</p:column>
				</p:dataTable>
			</h:form>
		</p:panel>

		<p:dialog widgetVar="messageDialog" id="messageDialog"
			header="#{messages.main_message_header}" showEffect="fade"
			dynamic="true" closable="true">
			<h:form id="messageDialogForm">
				<p:growl id="messageDialogFormGrowl" showDetail="true" life="1000" />
				<p:panelGrid columns="1">
					<p:outputLabel for="messagedsc" value="Message :" />
					<p:inputTextarea id="messagedsc" cols="40" rows="6"
						value="#{jJMessageBean.message.message}" required="true" />
					<p:panelGrid columns="2">
						<p:selectBooleanButton id="alert"
							value="#{jJMessageBean.alertOrInfo}" onLabel="Alert"
							offLabel="Info" onIcon="ui-icon-alert" offIcon="ui-icon-info">
						</p:selectBooleanButton>
						<p:commandButton id="submitMes" value="OK"
							process="@this,alert,messagedsc"
							actionListener="#{jJMessageBean.createMessage}"
							update="messageDialogForm :headerForm:communicationButton" />
					</p:panelGrid>
				</p:panelGrid>
			</h:form>
		</p:dialog>
	</ui:define>
</ui:composition>
</html>
