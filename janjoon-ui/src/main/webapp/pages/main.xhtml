<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<ui:composition template="../templates/template.xhtml">
	<ui:define name="content">
		<h:outputScript library="js" name="scrollTab.js" />
		<h:panelGroup layout="block" styleClass="Container">
			<p:layout id="layoutsGrid" fullPage="false" style="height: 1200px;"
				styleClass="Container100 Responsive100" stateful="true"
				rendered="#{loginBean.enable}">

				<p:layoutUnit resizable="true" position="north" collapsible="true">
					<f:facet name="header">
                        #{messages.main_communication_title}
                    </f:facet>
					<h:form id="messageForm">
						<p:dataTable id="MessageTable2" sortMode="multiple"
							value="#{jJMessageBean.mainMessages}" rowKey="#{mes.id}"
							var="mes" widgetVar="messageTable" paginator="true" rows="4"
							paginatorPosition="bottom" sortBy="#{mes.creationDate}"
							sortOrder="DESCENDING" selectionMode="single" 
							paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
							lazy="true" emptyMessage="#{messages.label_notFound}"
							rowClasses="order-table-odd-row,order-table-even-row">

							<p:ajax event="rowSelect" update=":viewMessagePanel"
								listener="#{jJMessageBean.onRowSelect}" immediate="true"
								oncomplete="PF('viewMessageDialogWidget').show()" />

							<p:column style="width: 70px !important;text-align: center;">
								<f:facet name="header">
									<p:commandButton id="createButton"
										icon="fa fa-plus-circle Fs20" update=":messageDialogForm"
										resetValues="true" oncomplete="PF('messageDialog').show();" />

								</f:facet>
								<p:graphicImage styleClass="avatar"
									value="#{imageStreamer.image}"
									rendered="#{mes.createdBy.picture != null}" cache="false">
									<f:param name="contactId" value="#{mes.createdBy.id}" />
								</p:graphicImage>

							</p:column>
							<p:column style="width: 10%;min-width: 200px !important;"
								priority="6">
								<h:outputText
									value="#{mes.createdBy.firstname} #{mes.createdBy.name}"
									style="font-weight: bold;color: #3b5998;" />
								<br />
								<h:outputText value="#{mes.creationDate}"
									style="color: #9197a3;font-size: 10px;">
									<f:convertDateTime type="date" locale="#{localeBean.locale}"
										pattern="dd/MM/yyyy HH:mm" />
								</h:outputText>
								<br />
								<h:outputText value="#{mes.project.name} / #{mes.product.name}"
									style="font-weight: bold;color: #9197a3;font-size: 10px;" />
								<br />
								<h:outputText value="#{mes.criticity.name}"
									styleClass="#{mes.criticity.name}" style="margin-left: 25%;" />
							</p:column>
							<p:column
								headerText="#{messages.main_communication_message_title}"
								filterBy="#{mes.message}" filterMatchMode="contains"
								sortBy="#{mes.creationDate}" filterStyle="width: 85%;"
								style="width: 65%;min-width: 200px">
								<h:outputText styleClass="Fs14" style="white-space: pre-wrap;"
									value="#{mes.message}" />
								<br />
								<br />
								<p:commandLink target="_blank"
									value="#{jJMessageBean.getObjectName(mes)}"
									rendered="#{jJMessageBean.haveObject(mes)}"
									action="#{jJMessageBean.objectInfo(mes)}" ajax="false" />
							</p:column>
							<p:column style="width:15% !important;text-align: center;">
								<p:commandButton id="resolveButton" icon="fa fa-minus Fs20"
									oncomplete="PF('resolveDialogWidget').show()"
									resetValues="true" title="#{messages.label_disable}">
									<!--value="#{messages.main_communication_resolve_button}"-->
									<f:setPropertyActionListener value="#{mes}"
										target="#{jJMessageBean.resolvedJJMessage}" />
								</p:commandButton>
							</p:column>
						</p:dataTable>
					</h:form>
				</p:layoutUnit>
				<p:layoutUnit position="center" resizable="true">
					<f:facet name="header">
                        #{messages.main_taskPanel_header}
                    </f:facet>
					<h:form id="taskForm">
						<f:event listener="#{jJTaskBean.initToDoTasks}"
							type="preRenderComponent" />
						<p:dataTable id="taskTable" value="#{jJTaskBean.toDoTasks}"
							rowKey="#{task.id}" var="task" widgetVar="taskTable"
							scrollable="true" scrollHeight="180" style="table-layout: fixed;"
							emptyMessage="#{messages.label_notRecordFound}">

							<p:column headerText="#{messages.label_task}">
								<!-- 	<p:graphicImage -->
								<!-- 		rendered="#{task.specification != null and task.specification}" -->
								<!-- 		library="images" name="doc.ico" width="16" height="16" /> -->
								<p:graphicImage rendered="#{task.taskType.name == 'specifier'}"
									library="images" name="doc.ico" width="16" height="16" />
								<p:graphicImage rendered="#{task.bug != null}" library="images"
									name="bug.ico" width="16" height="16" />
								<p:graphicImage
									rendered="#{task.bug == null and task.requirement != null}"
									library="images" name="function.ico" width="16" height="16" />
								<p:graphicImage title="TestCase"
									rendered="#{task.bug == null and task.requirement == null and task.testcase != null}"
									library="images" name="test.ico" width="16" height="16" />
								<h:outputText value="#{task}" converter="JJTaskConverter" />
							</p:column>

							<p:column headerText="#{messages.label_requirement}"
								priority="6" >
								<h:outputText value="#{task.requirement}"
									converter="JJRequirementConverter" />
							</p:column>

							<p:column headerText="Bug" priority="6" >
								<h:outputText value="#{task.bug}" converter="JJBugConverter" />
							</p:column>

							<p:column headerText="#{messages.label_project}"
								style="width:100px;" priority="6" >
								<h:outputText value="#{task.project}"
									converter="JJProjectConverter" />
							</p:column>

							<p:column headerText="#{messages.project_scrum_new_start_label}"
								style="width:100px;" priority="6" >
								<h:outputText value="#{task.startDateReal}">
									<f:convertDateTime type="date" locale="#{localeBean.locale}"
										pattern="dd/MM/yyyy" />
								</h:outputText>
							</p:column>


							<p:column
								headerText="#{messages.specification_create_workload_label}"
								style="width:100px;" priority="6" >
								<h:outputText value="#{task.workloadPlanned}" />
							</p:column>

							<p:column styleClass="action-column" style="width:80px;"
								headerText="#{messages.bug_table_action_title}">
								<p:commandButton id="viewTaskButton" icon="fa fa-eye Fs20"
									update=":viewTaskForm :viewTaskDialogHeader" immediate="true"
									resetValues="true"
									title="#{messages.project_gantt_table_actions_viewMenuItem}"
									action="#{jJTaskBean.initiateReqTreeNode}">
									<f:setPropertyActionListener value="#{task}"
										target="#{jJTaskBean.task}" />
								</p:commandButton>
							</p:column>
						</p:dataTable>
					</h:form>
				</p:layoutUnit>
				<p:layoutUnit position="south" resizable="true" collapsible="true"
					rendered="#{loginBean.noCouvretReq != null}">
					<f:facet name="header">
                       #{messages.main_specPanel_header}
                    </f:facet>
					<h:form id="specForm">
						<p:dataTable id="specTable" value="#{loginBean.noCouvretReq}"
							rowKey="#{req.id}" var="req" widgetVar="specTable"
							scrollable="true" scrollHeight="180"
							emptyMessage="#{messages.label_notRecordFound}">

							<p:column headerText="#{messages.label_requirement}">
								<p:commandLink target="_blank" value="#{req.name}"
									action="#{jJRequirementBean.requirementInfo}" ajax="false">
									<f:setPropertyActionListener value="#{req}"
										target="#{jJRequirementBean.requirement}" />
								</p:commandLink>
							</p:column>

							<p:column headerText="#{messages.label_chapter}"
								priority="6" >
								<h:outputText value="#{req.chapter}"
									converter="JJChapterConverter" />
							</p:column>

							<p:column headerText="#{messages.label_project}">
								<h:outputText value="#{req.project}"
									converter="JJProjectConverter" />
							</p:column>

							<p:column headerText="#{messages.label_category}"
								priority="6" >
								<h:outputText value="#{req.category}"
									converter="JJCategoryConverter" />
							</p:column>

							<p:column headerText="Version" priority="6" >
								<h:outputText value="#{req.versioning}"
									converter="JJVersionConverter" />
							</p:column>

							<p:column headerText="Status">
								<h:outputText value="#{loginBean.checkMessage(req.status)}" />
							</p:column>
						</p:dataTable>
					</h:form>
				</p:layoutUnit>
			</p:layout>
		</h:panelGroup>
		<!-- 			</h:panelGrid> -->
		<!-- 		</h:panelGroup> -->

		<p:confirmDialog id="resolveDialog" widgetVar="resolveDialogWidget"
			message="#{messages.label_disable_record}" showEffect="fade"
			 header="#{messages.label_confirm_disabling}"
			severity="alarm">
			<p:outputPanel id="deletePanel">
				<h:form id="deleteForm">
					<p:commandButton id="deleteYesButton" value="#{messages.label_yes}"
						action="#{jJMessageBean.resolveJJMessage}"
						update=":messageForm :growlForm :headerForm:communicationButton :communicationButton"
						oncomplete="PF('resolveDialogWidget').hide()" />
					<p:commandButton id="deleteNoButton" value="#{messages.label_no}"
						onclick="PF('resolveDialogWidget').hide()" type="button" />
				</h:form>
			</p:outputPanel>
		</p:confirmDialog>

		<p:dialog id="viewTaskDialog" modal="true" responsive="true"
			widgetVar="viewTaskDialogWidget" dynamic="true" resizable="false" 
			maximizable="false" showEffect="fade"  draggable="false">
			<p:ajax event="close" update=":taskForm"
				listener="#{jJTaskBean.closeEvent('main')}" />
			<f:facet name="header">
				<p:outputLabel id="viewTaskDialogHeader"
					value="#{messages.label_view} #{jJTaskBean.getDialogHeader(jJTaskBean.task,null)}" />
			</f:facet>
			<p:outputPanel id="viewTaskPanel">
				<h:form id="viewTaskForm" enctype="multipart/form-data">
					<p:remoteCommand name="updateForm" update=":viewTaskForm" />
					<ui:include src="taskDialog.xhtml">
						<ui:param name="JJTask_" value="#{jJTaskBean.task}" />
						<ui:param name="View" value="main" />
					</ui:include>	
				</h:form>
			</p:outputPanel>
		</p:dialog>

		<p:dialog widgetVar="messageDialog" id="messageDialog"
			responsive="true" header="#{messages.main_message_header}"
			showEffect="fade" dynamic="true" closable="true" resizable="false">
			<h:form id="messageDialogForm">
				<h:panelGroup layout="block" styleClass="Container ui-fluid BordAll" style="max-width: 300px;">
					<h:panelGroup layout="block" styleClass="Container100">
						<h:panelGroup layout="block" styleClass="ContainerIndent">
							<p:inputTextarea id="messagedsc" cols="40" rows="6"
								placeholder="Message"
								requiredMessage="#{messages.label_alert_message_null}"
								value="#{jJMessageBean.message.message}" required="true" />
						</h:panelGroup>
					</h:panelGroup>
					<h:panelGroup layout="block" styleClass="Container100">
						<h:panelGroup layout="block" styleClass="Container50">
							<h:panelGroup layout="block" styleClass="ContainerIndent TexAlCenter">
								<p:inputSwitch id="alert" value="#{jJMessageBean.alertOrInfo}"
									onLabel="Alert" offLabel="Info" />
							</h:panelGroup>
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="Container50">
							<h:panelGroup layout="block" styleClass="ContainerIndent TexAlCenter">
								<p:commandButton id="submitMes" icon="fa fa-send Fs20"
									process="@this,alert,messagedsc" value="#{messages.label_send}"
									actionListener="#{jJMessageBean.createMessage(false,null)}"
									update="messageDialogForm :headerForm:communicationButton :growlForm :communicationButton" />
							</h:panelGroup>
						</h:panelGroup>
					</h:panelGroup>
				</h:panelGroup>
			</h:form>
		</p:dialog>

	</ui:define>
</ui:composition>
</html>