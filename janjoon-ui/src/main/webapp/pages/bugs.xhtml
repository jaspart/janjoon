<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<ui:composition template="../templates/layout.xhtml">
	<ui:define name="content">
		<p:panel id="bugPanel" header="BUG" style="width: 99.5%;valign: top;">
			<f:event listener="#{jJBugBean.initJJBug}" type="preRenderView" />

			<p:commandButton id="colorBtn" icon="ui-icon-info" type="button"
				style="float: right;" />
			<p:commandButton value="#{messages.specification_video_help_title}"
				id="videoHelpBtn" icon="ui-icon-video"
				onclick="PF('videoHelpWidget').show()"
				style="float: right;position: relative;" type="button" />
			<p:overlayPanel id="colorPanel" for="colorBtn" hideEffect="fade"
				dynamic="true" style="width:600px">
				<p:panelGrid style="width: 100%;">
					<f:facet name="header">
						<p:row>
							<p:column colspan="12">Code des Couleurs</p:column>
						</p:row>
					</f:facet>
					<p:row>
						<p:column colspan="2" styleClass="NEW">
							<p:outputLabel value="#{messages.status_NEW}" />
						</p:column>

						<p:column colspan="2" styleClass="CLOSED">
							<p:outputLabel value="#{messages.status_CLOSED}" />
						</p:column>

						<p:column colspan="2" styleClass="VERIFIED">
							<p:outputLabel value="#{messages.status_VERIFIED}" />
						</p:column>

						<p:column colspan="2" styleClass="RESOLVED">
							<p:outputLabel value="#{messages.status_RESOLVED}" />
						</p:column>

						<p:column colspan="2" styleClass="DUPLICATE">
							<p:outputLabel value="#{messages.status_DUPLICATE}" />
						</p:column>

						<p:column colspan="2" styleClass="WONTFIX">
							<p:outputLabel value="#{messages.status_WONTFIX}" />
						</p:column>
					</p:row>
					<p:row>
						<p:column colspan="2" styleClass="INVALID">
							<p:outputLabel value="#{messages.status_INVALID}" />
						</p:column>

						<p:column colspan="2" styleClass="FIXED">
							<p:outputLabel value="#{messages.status_FIXED}" />
						</p:column>

						<p:column colspan="2" styleClass="READY">
							<p:outputLabel value="#{messages.status_READY}" />
						</p:column>

						<p:column colspan="2" styleClass="REOPENED">
							<p:outputLabel value="#{messages.status_REOPENED}" />
						</p:column>

						<p:column colspan="2" styleClass="ASSIGNED">
							<p:outputLabel value="#{messages.status_ASSIGNED}" />
						</p:column>
					</p:row>
				</p:panelGrid>
			</p:overlayPanel>

			<br />
			<br />
			<h:form id="bugForm">
				<f:event type="preRenderComponent"
					listener="#{bugDataTableOptions.dataTableInit(dataTable)}" />
				<pe:blockUI target="bugTable2" content="blockUIContent"
					widgetVar="blockUIWidget2" />
				<h:panelGrid id="blockUIContent" columns="2"
					style="display:none;table-layout:auto;">
					<h:graphicImage library="images" name="ajax-loader.gif"
						style="margin-right: 12px; vertical-align: middle;" />
					<h:outputText value="Please wait, data is being processed..."
						style="white-space: nowrap;" />
				</h:panelGrid>
				<p:dataTable id="bugTable2" sortMode="multiple"
					styleClass="bugDataTable" style="table-layout: fixed;"
					value="#{jJBugBean.bugList}" rowKey="#{bug.id}" var="bug"
					widgetVar="bugTable" lazy="true" binding="#{dataTable}"
					emptyMessage="#{messages.label_notRecordFound}"
					selection="#{jJBugBean.selectedBugList}" paginator="true" rows="50"
					paginatorPosition="bottom"
					paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
					rowsPerPageTemplate="50,100,200">

					<p:ajax event="rowSelectCheckbox" update="bugTable2:deleteMButton" />
					<p:ajax event="rowUnselectCheckbox"
						update="bugTable2:deleteMButton" />
					<p:ajax event="toggleSelect" update="bugTable2:deleteMButton" />
					<p:ajax event="page" onstart="PF('blockUIWidget2').block()"
						oncomplete="PF('blockUIWidget2').unblock()" />
					<p:ajax event="sort" onstart="PF('blockUIWidget2').block()"
						oncomplete="PF('blockUIWidget2').unblock()" />
					<p:ajax event="filter" onstart="PF('blockUIWidget2').block()"
						oncomplete="PF('blockUIWidget2').unblock()" />

					<f:facet name="header">
						<p:outputPanel>
							<p:row>
								<p:column colspan="1">
									<h:outputText value="#{messages.bug_table_search_label}"
										style="vertical-align: middle !important;" />
									<p:inputText id="globalFilter"
										onkeyup="PF('bugTable').filter()" style="width:200px"
										placeholder="#{messages.bug_table_search_watermark}" />
								</p:column>
								<p:column colspan="1">
									<p:commandButton id="createButton" icon="ui-icon-plusthick"
										value="#{messages.bug_table_add_label}" update=":createForm "
										style="margin-left: 20px;" resetValues="true"
										oncomplete="PF('createDialogWidget').show()"
										title="#{messages.label_create}" />									
								</p:column>
							</p:row>
						</p:outputPanel>
					</f:facet>

					<p:column selectionMode="multiple" style="width:2%" />

					<p:column headerText="#{messages.bug_table_title_title}"
						filterMatchMode="contains" sortBy="#{bug.name}"
						filterStyle="width: 90%;"
						style="width: 25% !important;height: 5px !important;">
						<h:outputText
							value="#{messages['status_'.concat(fn:replace(bug.status.name, ' ', '_'))]}"
							styleClass="#{bug.status.name}" />
						<h:outputText value=" #{bug.name}" />
					</p:column>
					<p:column headerText="#{messages.bug_table_creation_title}"
						sortBy="#{bug.creationDate}"
						style="width: 15% !important;height: 5px !important;">
						<h:outputText value="#{bug.creationDate}">
							<f:converter converterId="extendedDateTimeConverter" />
							<f:attribute name="pattern" value="dd/MM/yyyy HH:mm" />
							<f:attribute name="timeZone" value="UCL" />
						</h:outputText>
					</p:column>
					<p:column headerText="#{messages.bug_table_criticity_title}"
						sortBy="#{bug.criticity.name}" id="criticity"
						filterStyleClass="criticity"
						style="width: 10% !important;height: 5px !important;"
						filterOptions="#{jJBugBean.criticityOptions}"
						filterMatchMode="exact" filterStyle="width: 90%;"
						filterBy="#{bug.criticity.name}">
						<h:outputText value="#{bug.criticity.name}" />
					</p:column>
					<p:column headerText="#{messages.bug_table_importance_title}"
						sortBy="#{bug.importance.name}" id="importance"
						filterStyleClass="importance"
						style="width: 10% !important;height: 5px !important;"
						filterOptions="#{jJBugBean.importanceOptions}"
						filterMatchMode="exact" filterStyle="width: 90%;"
						filterBy="#{bug.importance.name}">
						<h:outputText value="#{bug.importance.name}" />
					</p:column>
					<p:column headerText="#{messages.bug_table_status_title}"
						sortBy="#{bug.status.name}" filterBy="#{bug.status.name}"
						id="status" style="width: 10% !important;height: 5px !important;"
						filterStyleClass="status"
						filterOptions="#{jJBugBean.statusOptions}" filterMatchMode="exact"
						filterStyle="width: 90%;">
						<h:outputText
							value="#{messages['status_'.concat(fn:replace(bug.status.name, ' ', '_'))]}"
							styleClass="#{bug.status.name}" />
					</p:column>
					<p:column styleClass="action-column" style="width: 100px;">
						<f:facet name="header">
							<h:outputText value="#{messages.bug_table_action_title}" />
						</f:facet>
						<p:splitButton id="viewButton" action="#{jJBugBean.bugInfo}"
							title="#{messages.specification_table_actions_viewButton}"
							value="#{messages.label_view}" ajax="false" icon="ui-icon-eye"
							onclick="target='_blank'">
							<p:menuitem id="editButton" icon="ui-icon-pencil"
								value="#{messages.label_edit}" update=":editForm"
								oncomplete="PF('editDialogWidget').show()"
								title="#{messages.label_edit}" resetValues="true">
								<f:setPropertyActionListener value="#{bug}"
									target="#{jJBugBean.JJBug_}" />
								<f:setPropertyActionListener value="#{bug.project}"
									target="#{jJBugBean.bugProjectSelected}" />
							</p:menuitem>							
							<p:menuitem id="deleteButton" icon="ui-icon-trash"
								oncomplete="PF('deleteDialogWidget').show()"
								value="#{messages.label_delete}"
								title="#{messages.label_delete}">
								<f:setPropertyActionListener value="#{bug}"
									target="#{jJBugBean.JJBug_}" />
							</p:menuitem>
							<f:setPropertyActionListener value="#{bug}"
								target="#{jJBugBean.viewBug}" />
						</p:splitButton>
					</p:column>
					<f:facet name="footer">
						<p:commandButton value="#{messages.bug_delete_button}"
							id="deleteMButton" icon="ui-icon-trash" update=":createForm"
							oncomplete="PF('deleteMDialogWidget').show()"
							disabled="#{empty jJBugBean.selectedBugList}"
							title="#{messages.label_delete}" />
					</f:facet>
				</p:dataTable>
			</h:form>
			<p:dialog id="createDialog" header="#{messages.bug_create_title}"
				draggable="false" modal="true" widgetVar="createDialogWidget"
				dynamic="true" visible="#{jJBugBean.createDialogVisible}"
				resizable="true" maximizable="true" showEffect="fade"
				hideEffect="explode">
				<p:ajax event="close" listener="#{jJBugBean.handleDialogClose}" />
				<p:outputPanel id="createPanel">
					<h:form id="createForm" enctype="multipart/form-data">
						<p:panel styleClass="panelDialog">
							<f:facet name="header">
								<p:messages id="msg" showDetail="false" closable="true" />
							</f:facet>
							<ui:include src="bugDialog.xhtml">
								<ui:param name="JJBug_" value="#{jJBugBean.JJBug_}" />
							</ui:include>
							<f:facet name="footer">
								<p:commandButton id="createSaveButton"
									onstart="PF('bugBlockUIWidget').block()"
									oncomplete="PF('bugBlockUIWidget').unblock()"
									value="#{messages.label_save}" action="#{jJBugBean.persistBug}"
									update="createPanelGrid,:bugForm :growlForm" />
								<p:commandButton id="createCloseButton"
									value="#{messages.label_close}"
									onclick="PF('createDialogWidget').hide()" type="button" />
							</f:facet>
						</p:panel>
					</h:form>
				</p:outputPanel>
			</p:dialog>

			<p:hotkey bind="esc" handler="PF('videoHelpWidget').hide()" />
			<p:dialog id="videoHelpDialog" widgetVar="videoHelpWidget"
				position="center"
				header="#{messages.specification_video_help_title}"
				style="padding:0px;" resizable="false" draggable="false"
				minHeight="500" minWidth="500" showEffect="fade" hideEffect="fade">
				<video width="100%" height="100%" controls="true">
					<source src="https://www.starit.fr/jjtraining.mp4" type="video/mp4" />
				</video>
			</p:dialog>

			<p:dialog id="editDialog" header="#{messages.bug_edit_title}"
				modal="true" widgetVar="editDialogWidget" dynamic="true"
				resizable="true" maximizable="true" showEffect="fade"
				hideEffect="explode" draggable="false">
				<p:ajax event="close" listener="#{jJBugBean.handleDialogClose}"
					immediate="true" />
				<p:outputPanel id="editPanel">
					<h:form id="editForm" enctype="multipart/form-data">
						<p:panel styleClass="panelDialog">
							<f:facet name="header">
								<p:messages id="msg" showDetail="false" closable="true" />
							</f:facet>
							<ui:include src="bugDialog.xhtml">
								<ui:param name="JJBug_" value="#{jJBugBean.JJBug_}" />
							</ui:include>
							<f:facet name="footer">
								<p:commandButton id="editSaveButton"
									onstart="PF('bugBlockUIWidget').block()"
									oncomplete="PF('bugBlockUIWidget').unblock()"
									value="#{messages.bug_edit_save_button}"
									action="#{jJBugBean.persistBug}"
									update="createPanelGrid :bugForm :growlForm" />
								<p:commandButton id="editCloseButton" immediate="true"
									value="#{messages.bug_edit_close_button}"
									onclick="PF('editDialogWidget').hide()" type="button" />
							</f:facet>
						</p:panel>
					</h:form>
				</p:outputPanel>
			</p:dialog>

			<p:confirmDialog id="deleteDialog" widgetVar="deleteDialogWidget"
				message="#{messages.bug_delete_title}" showEffect="fade"
				hideEffect="explode" header="#{messages.bug_delete_confirm_label}"
				severity="alarm">
				<p:outputPanel id="deletePanel">
					<h:form id="deleteForm">
						<p:commandButton id="deleteYesButton"
							value="#{messages.bug_delete_yes_button}"
							action="#{jJBugBean.deleteSingle}" update=":bugForm :growlForm"
							onsuccess="PF('deleteDialogWidget').hide()" />
						<p:commandButton id="deleteNoButton"
							value="#{messages.bug_delete_no_button}"
							onclick="PF('deleteDialogWidget').hide()" type="button" />
					</h:form>
				</p:outputPanel>
			</p:confirmDialog>

			<p:confirmDialog id="deleteMDialog" widgetVar="deleteMDialogWidget"
				message="#{messages.bug_mdelete_title}" showEffect="fade"
				hideEffect="explode" header="#{messages.bug_mdelete_confirm_label}"
				severity="alarm">
				<p:outputPanel id="deleteMPanel">
					<h:form id="deleteMForm">
						<p:commandButton id="deleteYesButton"
							value="#{messages.bug_delete_yes_button}"
							action="#{jJBugBean.deleteMultiple}" update=":bugForm :growlForm"
							onsuccess="PF('deleteMDialogWidget').hide()" />
						<p:commandButton id="deleteNoButton"
							value="#{messages.bug_delete_no_button}"
							onclick="PF('deleteMDialogWidget').hide()" type="button" />
					</h:form>
				</p:outputPanel>
			</p:confirmDialog>
		</p:panel>
	</ui:define>
</ui:composition>
</html>