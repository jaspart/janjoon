<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="../templates/template.xhtml">
	<ui:define name="head">
		<h:outputScript library="js" name="stats.js" />
	</ui:define>
	<ui:define name="content">
		<h:form style="width:100%;display:none;">
			<p:remoteCommand name="tabChangeHelper" update=":statsTabView"
				actionListener="#{jJStatusBean.onTabStatChange}"
				oncomplete="updateTabViewWidth();" />

			<p:remoteCommand name="sprintTabChangeHelper"
				update=":statsTabView:activeSprintIndexForm"
				actionListener="#{jJStatusBean.onTabStatChange}"
				oncomplete="updateTabViewWidth();" />
		</h:form>
		<f:event type="preRenderComponent" oncomplete="updateTabViewWidth();"
			listener="#{jJStatusBean.loadData()}" />
		<h:panelGroup layout="block" styleClass="Container ui-fluid">
			<p:tabView id="statsTabView" widgetVar="statsTabView" dynamic="false"
				activeIndex="#{jJStatusBean.activeTabIndex}"
				onTabChange="tabChangeHelper([{name: 'activeIndex', value: index}])"
				cache="true">
				<p:tab id="specTab" title="#{messages.label_requirement}">
					<p:overlayPanel id="infoPanelSpec" for="specForm:infoBtnSpec"
						hideEffect="fade">
						<p:panelGrid style="width: 100%;" columns="1">
							<ul>
								<li>#{messages.statistique_spec_projectKpi_help}</li>
								<li>#{messages.statistique_spec_pieChart_help}</li>
							</ul>
						</p:panelGrid>
						<p:panelGrid style="width: 100%;">
							<f:facet name="header">
								<p:row>
									<p:column colspan="6">Code des Couleurs</p:column>
								</p:row>
							</f:facet>
							<p:row>
								<p:column colspan="2" styleClass="DELAY">
									<p:outputLabel style="color: #fff;"
										value="#{messages.statistique_help_project_delay}" />
								</p:column>

								<p:column colspan="2" styleClass="ONTIME">
									<p:outputLabel style="color: #fff;"
										value="#{messages.statistique_help_project_time}" />
								</p:column>

								<p:column colspan="2" styleClass="INADVANCE">
									<p:outputLabel style="color: #fff;"
										value="#{messages.statistique_help_project_advance}" />
								</p:column>
							</p:row>
						</p:panelGrid>
					</p:overlayPanel>

					<h:panelGroup layout="block" styleClass="Container">
						<h:form id="specForm">
							<h:panelGroup layout="block" style="float: right !important;"
								styleClass="Container10 Responsive100 Fright">
								<p:commandButton id="infoBtnSpec"
									icon="fa fa-info-circle  Gray Fs20"
									styleClass="Fright GrayButton" type="button"
									title="#{messages.specification_video_help_title}" />
							</h:panelGroup>

							<h:panelGroup layout="block"
								styleClass="Container45 Responsive100">
								<p:chart id="custom" responsive="true"
									rendered="#{jJStatusBean.statusPieChart != null}"
									model="#{jJStatusBean.statusPieChart}" style="height:300px"
									type="pie" />
							</h:panelGroup>
							<h:panelGroup layout="block"
								styleClass="Container45 Responsive100">
								<p:chart type="metergauge" model="#{jJStatusBean.prjMetergauge}"
									style="height:300px" responsive="true"
									rendered="#{jJStatusBean.prjMetergauge != null}" />
							</h:panelGroup>
							<h:panelGroup layout="block" styleClass="Container100">
								<p:dataTable id="categoryTable" var="categoryModel"
									emptyMessage="#{messages.label_notRecordFound}"
									value="#{jJStatusBean.categoryDataModel}">
									<f:facet name="header">
										<h:outputText value="Categories stats" />
									</f:facet>
									<p:column>
										<f:facet name="header">
											<h:outputText value="#{messages.label_name}" />
										</f:facet>
										<h:outputText value="#{categoryModel.category.name}"
											style="margin: auto;" />
									</p:column>
									<p:column>
										<f:facet name="header">
											<h:outputText
												value="#{messages.specification_completion_progress}" />
										</f:facet>
										<p:chart id="coverage" responsive="true"
											model="#{categoryModel.categoryPieChart}" type="pie"
											style="height:150px;margin: auto;" />
									</p:column>
									<p:column>
										<f:facet name="header">
											<h:outputText
												value="#{messages.specification_coverage_progress}" />
										</f:facet>
										<p:progressBar style="margin: auto;"
											value="#{categoryModel.coverageProgress}"
											labelTemplate="{value}%" displayOnly="true" />
									</p:column>
								</p:dataTable>
							</h:panelGroup>
						</h:form>
					</h:panelGroup>
				</p:tab>
				<p:tab id="bugTab" title="Bug">
					<p:overlayPanel id="infoPanelBug" for="bugForm:infoBtnBug">
						<p:panelGrid style="width: 100%;" columns="1">
							<ul>
								<li>#{messages.statistique_bug_bugKpi_help}</li>
								<li>#{messages.statistique_bug_bugpieChart_help}</li>
							</ul>
						</p:panelGrid>
					</p:overlayPanel>
					<h:form id="bugForm">
						<p:remoteCommand name="updateBugTab"
							update="#{jJStatusBean.bugPieChart != null ? 'bugPieChart':''} #{jJStatusBean.bugMetergauge != null ? 'bugMetergauge':''}" />
						<h:panelGroup layout="block" styleClass="Container">
							<div class="EmptyBox1 bugTab" />
							<h:panelGroup layout="block" style="float: right !important;"
								styleClass="Container10 Responsive100 Fright">
								<p:commandButton id="infoBtnBug"
									icon="fa fa-info-circle  Gray Fs20"
									styleClass="Fright GrayButton" type="button"
									title="#{messages.specification_video_help_title}" />
							</h:panelGroup>

							<h:panelGroup layout="block"
								rendered="#{jJStatusBean.bugPieChart != null}"
								styleClass="Container45 Responsive100">
								<p:chart id="bugPieChart" responsive="true"
									rendered="#{jJStatusBean.bugPieChart != null}"
									model="#{jJStatusBean.bugPieChart}" style="height:300px"
									type="pie" />
							</h:panelGroup>

							<h:panelGroup layout="block"
								rendered="#{jJStatusBean.bugMetergauge != null}"
								styleClass="Container45 Responsive100">
								<p:chart id="bugMetergauge" type="metergauge"
									model="#{jJStatusBean.bugMetergauge}" style="height:300px"
									rendered="#{jJStatusBean.bugMetergauge != null}"
									responsive="true" />
							</h:panelGroup>
						</h:panelGroup>
					</h:form>
				</p:tab>
				<p:tab id="sprintTab" title="Sprint"
					rendered="#{!jJStatusBean.emptysprintList}">
					<h:panelGroup layout="block" styleClass="Container">
						<h:panelGroup layout="block"
							styleClass="Container100 ShowOnMobile">
							<h:form id="activeSprintIndexForm">
								<h:panelGroup layout="block" styleClass="Container30">
									<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
										<p:outputLabel for="activeSprintIndex" value="Sprint:" />
									</h:panelGroup>
								</h:panelGroup>
								<h:panelGroup layout="block" styleClass="Container70">
									<h:panelGroup layout="block" styleClass="ContainerIndent">
										<p:selectOneMenu id="activeSprintIndex"
											panelStyleClass="hideDisabled"
											value="#{jJStatusBean.activeTabSprintIndex}" effect="fade"
											onchange="PF('SprintTab').select(value);">
											<f:selectItems value="#{jJStatusBean.sprintList}"
												var="jjsprint"
												itemDisabled="#{jjsprint.sprint.name == null}"
												itemLabel="#{jjsprint.sprint.name != null ? jjsprint.sprint.name : messages.project_scrum_new_title}"
												itemValue="#{jJSprintBean.contains(jjsprint.sprint.id)}" />
										</p:selectOneMenu>
									</h:panelGroup>
								</h:panelGroup>
							</h:form>
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="Container100">
							<p:tabView id="SprintTabView" dynamic="true"
								widgetVar="SprintTab" style="max-width: 300px;display: none;"
								value="#{jJStatusBean.sprintList}" var="jjsprint"
								scrollable="true" styleClass="responsiveTabView"
								onTabChange="sprintTabChangeHelper([{name: 'activeSprintIndex', value: index}])"
								activeIndex="#{jJStatusBean.activeTabSprintIndex}">
								<p:tab title="#{jjsprint.sprint.name}"
									titletip="#{!jjsprint.render and jjsprint.chartModel == null ? messages.statistique_disabled_sprint_titletip :''}"
									disabled="#{jjsprint.render}">
									<h:panelGroup layout="block" styleClass="Container">
										<h:form id="sprintForm">
											<p:remoteCommand name="updateBarChart"
												update="#{jjsprint.chartModel != null ? ':statsTabView:SprintTabView:sprintForm:barChart':''}" />
											<h:panelGroup layout="block" styleClass="Container100">
												<h3 style="text-align: center;">#{messages.statistique_completion_progress_title}</h3>
												<h:panelGroup layout="block" styleClass="EmptyBox5" />
												<p:progressBar value="#{jjsprint.progressBarValue}"
													labelTemplate="{value}%" displayOnly="true" />
											</h:panelGroup>
											<div class="EmptyBox30 barChart"
												id="barChart_#{jjsprint.sprint.id}" />
											<h:panelGroup layout="block" styleClass="Container100">
												<p:chart id="barChart" model="#{jjsprint.chartModel}"
													type="bar" style="height:400px;" responsive="true"
													widgetVar="barChart_#{jjsprint.sprint.id}_#{jjsprint.chartModel != null}_Widget"
													rendered="#{!jjsprint.render and jjsprint.chartModel != null}" />
											</h:panelGroup>
										</h:form>
									</h:panelGroup>
								</p:tab>
							</p:tabView>
						</h:panelGroup>
					</h:panelGroup>
				</p:tab>
				<p:tab id="kpiTab" title="KPI">
					<p:overlayPanel id="infoPanelKpi" for="infoBtnKpi" style="max-width: 700px;">
						<p:panelGrid style="width: 100%;" columns="1">
							<ul>
								<li>#{messages.statistique_kpi_Kpi_help}</li>
							</ul>
							<p:panelGrid style="width: 100%;">
								<f:facet name="header">
									<p:row>
										<p:column colspan="6">Code des Couleurs</p:column>
									</p:row>
								</f:facet>
								<p:row>
									<p:column colspan="2" styleClass="DELAY"
										style="background-color : #0288D1 !important;">
										<p:outputLabel style="color: #fff;"
											value="#{messages.statistique_help_kpi_blue}" />
									</p:column>

									<p:column colspan="2" styleClass="DELAY"
										style="background-color : #5C6BC0 !important;">
										<p:outputLabel style="color: #fff;"
											value="#{messages.statistique_help_kpi_purple}" />
									</p:column>
									<p:column colspan="2" styleClass="DELAY"
										style="background-color : #59A45D !important;">
										<p:outputLabel style="color: #fff;"
											value="#{messages.statistique_help_kpi_green}" />
									</p:column>
								</p:row>
								<p:row>
									<p:column colspan="2">
										<p:outputLabel
											value="#{messages.statistique_help_kpi_blue_text}" />
									</p:column>
									<p:column colspan="2">
										<p:outputLabel
											value="#{messages.statistique_help_kpi_purple_text}" />
									</p:column>
									<p:column colspan="2">
										<p:outputLabel
											value="#{messages.statistique_help_kpi_green_text}" />
									</p:column>
								</p:row>
							</p:panelGrid>
						</p:panelGrid>
					</p:overlayPanel>
					<h:panelGroup layout="block" styleClass="Container">
						<div class="EmptyBox1 kpiTab" />
						<h:panelGroup layout="block" style="float: right !important;"
							styleClass="Container10 Responsive100 Fright">
							<p:commandButton id="infoBtnKpi"
								icon="fa fa-info-circle  Gray Fs20"
								styleClass="Fright GrayButton" type="button"
								title="#{messages.specification_video_help_title}" />
						</h:panelGroup>
						<h:form id="kpiForm">
							<p:remoteCommand name="updateKpiTab" update="@form" />
							<h:panelGroup layout="block" styleClass="Container90"
								rendered="#{jJStatusBean.kpiLineModel != null}">
								<p:chart id="kpiLineModel" type="line"
									model="#{jJStatusBean.kpiLineModel}"
									rendered="#{jJStatusBean.kpiLineModel != null}"
									responsive="true" style="height:500px;" />
							</h:panelGroup>
							<h:panelGroup layout="block" styleClass="EmptyBox20" />
							<h:panelGroup layout="block"
								rendered="#{jJStatusBean.categoryPieChart != null}"
								styleClass="Container33 Responsive50">
								<p:chart id="categoryPieChart" responsive="true"
									rendered="#{jJStatusBean.categoryPieChart != null}"
									model="#{jJStatusBean.categoryPieChart}" style="height:300px"
									type="pie" />
							</h:panelGroup>
							<h:panelGroup layout="block"
								rendered="#{jJStatusBean.projectPieChart != null}"
								styleClass="Container33 Responsive50">
								<p:chart id="projectPieChart" responsive="true"
									rendered="#{jJStatusBean.projectPieChart != null}"
									model="#{jJStatusBean.projectPieChart}" style="height:300px"
									type="pie" />
							</h:panelGroup>
							<h:panelGroup layout="block"
								rendered="#{jJStatusBean.productPieChart != null}"
								styleClass="Container33 Responsive50">
								<p:chart id="productPieChart" responsive="true"
									rendered="#{jJStatusBean.productPieChart != null}"
									model="#{jJStatusBean.productPieChart}" style="height:300px"
									type="pie" />
							</h:panelGroup>
						</h:form>
					</h:panelGroup>
				</p:tab>
			</p:tabView>
		</h:panelGroup>
		<p:hotkey bind="esc" handler="PF('videoHelpWidget').hide()" />
		<p:dialog id="videoHelpDialog" widgetVar="videoHelpWidget"
			responsive="true" position="center"
			header="#{messages.specification_video_help_title}"
			style="padding:0px;" resizable="false" draggable="false"
			minHeight="500" minWidth="500" showEffect="fade" hideEffect="fade">
			<video width="100%" height="100%" controls="controls">
				<source src="https://www.starit.fr/jjtraining.mp4" type="video/mp4" />
			</video>
		</p:dialog>
	</ui:define>
</ui:composition>
</html>