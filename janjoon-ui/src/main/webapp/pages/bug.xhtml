<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/template.xhtml">
	<ui:define name="content">
		<f:event listener="#{jJBugBean.checkBug}" type="preRenderView" />
		<h:panelGroup layout="block" styleClass="Container ui-fluid">
			<h:panelGroup layout="block"
				styleClass="Container70 MarAuto Responsive100">

				<h:panelGroup layout="block" styleClass="ContainerIndent">
					<h:form id="bugForm">
						<p:panel id="createPanelGrid" styleClass="Container100">
							<f:facet name="header">

								<p:commandLink
									actionListener="#{jJBugBean.onrate(jJBugBean.viewBug)}"
									onstart="PF('blockUIWidget').block()"
									oncomplete="PF('blockUIWidget').unblock()"
									update=":growlForm :messageCreationForm :headerForm:communicationButton :bugForm"
									rendered="#{loginBean.enable and jJBugBean.viewBug != null and jJBugBean.viewBug.id != null}">

									<p:graphicImage
										name="#{!jJBugBean.isRated(jJBugBean.viewBug) ? 'blackstar.ico' : 'yelstar.ico'}"
										width="32" height="32" cache="false" library="images"
										title="#{!jJBugBean.isRated(jJBugBean.viewBug) ? messages.requirement_subscription_rate_title : messages.requirement_subscription_cancel_rate_title}" />

								</p:commandLink>

								<p:commandButton id="createButton" style="left: 5%;"
									icon="fa fa-plus-square Fs20"
									title="#{messages.bug_table_add_label}" update=":createForm "
									resetValues="true" immediate="true"
									oncomplete="PF('createDialogWidget').show()" />

								<h:outputText value="BUG ID=#{jJBugBean.viewBug.id} #{messages.label_createdBy} #{jJBugBean.viewBug.createdBy.firstname} #{jJBugBean.viewBug.createdBy.name}"
									styleClass="Fright" />
							</f:facet>

							<h:panelGroup layout="block"
								styleClass="Container100 Responsive100">
								<h:panelGroup layout="block" styleClass="ContainerIndent">

									<p:inputTextarea id="jJbugName"
										value="#{jJBugBean.viewBug.name}"
										requiredMessage="#{messages.label_name_required_alert}"
										cols="65" rows="1" required="true"
										placeholder="#{messages.label_name}">
										<f:validateLength maximum="100" />
									</p:inputTextarea>
								</h:panelGroup>
							</h:panelGroup>

							<h:panelGroup layout="block"
								styleClass="Container33 Responsive50">
								<h:panelGroup layout="block" styleClass="Container40">
									<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
										<p:outputLabel for="jJbugProject" value="Project : " />
									</h:panelGroup>
								</h:panelGroup>
								<h:panelGroup layout="block" styleClass="Container60">
									<h:panelGroup layout="block" styleClass="ContainerIndent">
										<p:selectOneMenu id="jJbugProject"
											value="#{jJBugBean.viewBug.project}"
											converter="com.starit.janjoonweb.ui.mb.converter.JJProjectConverter">
											<f:selectItem itemValue="#{null}" itemLabel="AnyProject" />
											<f:selectItems value="#{jJProjectBean.projectList}" var="p"
												itemLabel="#{p.name}" itemValue="#{p}" />
										</p:selectOneMenu>
									</h:panelGroup>
								</h:panelGroup>
							</h:panelGroup>
							<h:panelGroup layout="block"
								styleClass="Container33 Responsive50">
								<h:panelGroup layout="block" styleClass="Container40">
									<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
										<p:outputLabel for="jJbugVersion" value="Version : " />
									</h:panelGroup>
								</h:panelGroup>
								<h:panelGroup layout="block" styleClass="Container60">
									<h:panelGroup layout="block" styleClass="ContainerIndent">
										<p:autoComplete id="jJbugVersion" scrollHeight="200"
											onchange="jJbugBuild.val('');"
											value="#{jJBugBean.viewBug.versioning}"
											styleClass="bugAutoComplete"
											itemLabel="#{version != null ? version.name.concat(' : ').concat(version.product.name) : messages.label_select}"
											itemValue="#{version}"
											converter="com.starit.janjoonweb.ui.mb.converter.JJVersionConverter"
											dropdown="true" var="version"
											completeMethod="#{jJBugBean.completeVersioningBug}">
											<p:ajax event="itemSelect" update="jJbugVersion jJbugBuild"
												listener="#{jJBugBean.changeEvent('version',jJBugBean.viewBug)}" />
										</p:autoComplete>
									</h:panelGroup>
								</h:panelGroup>
							</h:panelGroup>

							<h:panelGroup layout="block"
								styleClass="Container33 Responsive50">
								<h:panelGroup layout="block" styleClass="Container40">
									<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
										<p:outputLabel for="jJbugBuild" value="Build : " />
									</h:panelGroup>
								</h:panelGroup>
								<h:panelGroup layout="block" styleClass="Container60">
									<h:panelGroup layout="block" styleClass="ContainerIndent">
										<p:autoComplete id="jJbugBuild" scrollHeight="200"
											styleClass="bugAutoComplete" widgetVar="jJbugBuild"
											value="#{jJBugBean.viewBug.build}"
											itemLabel="#{build != null ? build.name : messages.label_select}"
											itemValue="#{build}"
											converter="com.starit.janjoonweb.ui.mb.converter.JJBuildConverter"
											dropdown="true" var="build"
											completeMethod="#{jJBugBean.completeBuildBug}">
											<f:attribute name="version"
												value="#{jJBugBean.viewBug.versioning}" />
											<f:validator validatorId="bugValidator" />
											<f:attribute name="jJbugVersion"
												value="#{jJBugBean.viewBug.versioning}" />
										</p:autoComplete>
									</h:panelGroup>
								</h:panelGroup>
							</h:panelGroup>
							<h:panelGroup layout="block" styleClass="EmptyBox5 ShowOnDesktop" />
							<h:panelGroup layout="block"
								styleClass="Container33 Responsive50">
								<h:panelGroup layout="block" styleClass="Container40">
									<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
										<p:outputLabel for="jJbugCriticity" value="Criticity : " />
									</h:panelGroup>
								</h:panelGroup>
								<h:panelGroup layout="block" styleClass="Container60">
									<h:panelGroup layout="block" styleClass="ContainerIndent">
										<p:autoComplete id="jJbugCriticity" scrollHeight="200"
											styleClass="bugAutoComplete"
											value="#{jJBugBean.viewBug.criticity}"
											itemLabel="#{criticity != null ? criticity.name :  messages.label_select}"
											itemValue="#{criticity}"
											converter="com.starit.janjoonweb.ui.mb.converter.JJCriticityConverter"
											dropdown="true" var="criticity"
											completeMethod="#{jJBugBean.completeCriticityBug}" />
									</h:panelGroup>
								</h:panelGroup>
							</h:panelGroup>

							<h:panelGroup layout="block"
								styleClass="Container33 Responsive50">
								<h:panelGroup layout="block" styleClass="Container40">
									<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
										<p:outputLabel for="jJbugImportance" value="Importance : " />
									</h:panelGroup>
								</h:panelGroup>
								<h:panelGroup layout="block" styleClass="Container60">
									<h:panelGroup layout="block" styleClass="ContainerIndent">
										<p:autoComplete id="jJbugImportance" scrollHeight="200"
											styleClass="bugAutoComplete"
											value="#{jJBugBean.viewBug.importance}"
											itemLabel="#{importance != null ? importance.name : messages.label_select}"
											itemValue="#{importance}"
											converter="com.starit.janjoonweb.ui.mb.converter.JJImportanceConverter"
											dropdown="true" var="importance"
											completeMethod="#{jJBugBean.completeImportance}" />
									</h:panelGroup>
								</h:panelGroup>
							</h:panelGroup>

							<h:panelGroup layout="block"
								styleClass="Container33 Responsive50">
								<h:panelGroup layout="block" styleClass="Container40">
									<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
										<p:outputLabel for="jJbugStatus" value="Status : " />
									</h:panelGroup>
								</h:panelGroup>
								<h:panelGroup layout="block" styleClass="Container60">
									<h:panelGroup layout="block" styleClass="ContainerIndent">
										<p:autoComplete id="jJbugStatus"
											value="#{jJBugBean.viewBug.status}"
											itemLabel="#{loginBean.checkMessage(status)}"
											itemValue="#{status}" styleClass="bugAutoComplete"
											scrollHeight="200"
											converter="com.starit.janjoonweb.ui.mb.converter.JJStatusConverter"
											dropdown="true" var="status"
											completeMethod="#{jJBugBean.completeStatusBug}" />
									</h:panelGroup>
								</h:panelGroup>
							</h:panelGroup>

							<h:panelGroup layout="block" styleClass="Container100"
								style="min-height: 220px;" rendered="#{!loginBean.mobile}">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:outputLabel value="Description" for="jJBugDescription" />

									<pe:ckEditor id="jJBugDescription"
										toolbar="#{imageStreamer.ckEditorToolBar}"
										rendered="#{!loginBean.mobile}" width="100%;"
										customConfig="#{request.contextPath}/resources/js/ckEditor.js"
										value="#{jJBugBean.viewBug.description}" required="true"
										requiredMessage="#{messages.label_desc_required_alert}" />
								</h:panelGroup>
							</h:panelGroup>

							<h:panelGroup layout="block" rendered="#{loginBean.mobile}"
								styleClass="Container100 Responsive100">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:inputTextarea id="jJBugMobileDescription"
										rendered="#{loginBean.mobile}"
										value="#{jJBugBean.viewBug.description}" required="true"
										requiredMessage="#{messages.label_desc_required_alert}" />
								</h:panelGroup>
							</h:panelGroup>

							<h:panelGroup layout="block"
								styleClass="Container50 Responsive50">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:commandButton id="editSaveButton"
										onstart="PF('bugBlockUIWidget').block()"
										oncomplete="PF('bugBlockUIWidget').unblock()"
										value="#{messages.bug_edit_save_button}"
										action="#{jJBugBean.persistviewBug}"
										update=":bugForm :growlForm" />
								</h:panelGroup>
							</h:panelGroup>

							<h:panelGroup layout="block"
								styleClass="Container50 Responsive50">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:commandButton title="#{messages.label_cancel}"
										value="#{messages.label_cancel}" styleClass="GrayBack"
										action="/pages/bugs.jsf?faces-redirect=true" />
								</h:panelGroup>
							</h:panelGroup>
						</p:panel>
					</h:form>
				</h:panelGroup>
			</h:panelGroup>

			<h:panelGroup layout="block"
				styleClass="Container30 MarAuto Responsive100">

				<h:panelGroup layout="block" styleClass="ContainerIndent">
					<h:form id="linkForm">
						<p:panel styleClass="Container100"
							header="#{messages.bug_headerTable_link}">

							<h:panelGroup layout="block" styleClass="Container100">
								<h:panelGroup layout="block" styleClass="Container40">
									<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
										<p:outputLabel for="bugReq"
											value="#{messages.label_requirement} :" />
									</h:panelGroup>
								</h:panelGroup>
								<h:panelGroup layout="block" styleClass="Container60">
									<h:panelGroup layout="block" styleClass="ContainerIndent">

										<p:autoComplete id="bugReq" scrollHeight="200"
											value="#{jJBugBean.viewBug.requirement}"
											widgetVar="jJbugRequirement" 
											disabled="#{jJBugBean.viewBug.project == null}"
											itemLabel="#{requirement != null ? requirement.name : messages.label_select}"
											itemValue="#{requirement}"
											converter="com.starit.janjoonweb.ui.mb.converter.JJRequirementConverter"
											dropdown="true" var="requirement"
											onchange="jJbugTeststep.val('');"
											completeMethod="#{jJBugBean.completeReqBug}">
											<p:ajax event="itemSelect"
												listener="#{jJBugBean.persistJJBug}"
												onstart="PF('blockUIWidget').block()"
												oncomplete="PF('blockUIWidget').unblock()"
												update=":bugForm :growlForm :linkForm" />
												<p:column>
												<h:outputText value="#{fn:substring(requirement.name,0,30)}" escape="false" />
											</p:column>
											<f:attribute name="project"
												value="#{jJBugBean.viewBug.project}" />
										</p:autoComplete>
									</h:panelGroup>
								</h:panelGroup>
							</h:panelGroup>

							<h:panelGroup layout="block" styleClass="Container100">
								<h:panelGroup layout="block" styleClass="Container40">
									<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
										<p:outputLabel for="bugTest"
											value="#{messages.label_testcase} :" />
									</h:panelGroup>
								</h:panelGroup>
								<h:panelGroup layout="block" styleClass="Container60">
									<h:panelGroup layout="block" styleClass="ContainerIndent">
										<p:autoComplete id="bugTest" scrollHeight="200"
											widgetVar="jJbugTeststep"
											value="#{jJBugBean.viewBug.teststep}" itemValue="#{teststep}"
											converter="com.starit.janjoonweb.ui.mb.converter.JJTeststepConverter"
											disabled="#{jJBugBean.viewBug.project == null and jJBugBean.viewBug.requirement==null}"
											dropdown="true" var="teststep"
											itemLabel="#{teststep != null ? teststep.name :  messages.label_select}"
											completeMethod="#{jJBugBean.completeTestStepsBug}">
											<p:column>
												<h:outputText value="#{fn:substring(teststep.name,0,30)}" escape="false" />
											</p:column>
											<p:ajax event="itemSelect"
												listener="#{jJBugBean.persistJJBug}"
												onstart="PF('blockUIWidget').block()"
												oncomplete="PF('blockUIWidget').unblock()"
												update=":bugForm :growlForm :linkForm" />
											<f:attribute name="requirement"
												value="#{jJBugBean.viewBug.requirement}" />
											<f:attribute name="project"
												value="#{jJBugBean.viewBug.project}" />
										</p:autoComplete>
									</h:panelGroup>
								</h:panelGroup>
							</h:panelGroup>

							<h:panelGroup layout="block" styleClass="Container100">
								<!-- 								<p:dataList id="bugTasks" value="#{jJBugBean.viewBugTasks}" emptyMessage="#{messages.label_notRecordFound}" -->
								<!-- 									var="task"> -->

								<!-- 										 #{task.name} -->
								<!-- 									</p:dataList> -->
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:dataTable id="bugTasks" tableStyleClass="ui-table-columntoggle"
										emptyMessage="#{messages.label_notRecordFound}"
										value="#{jJBugBean.viewBugTasks}" var="task" scrollable="true"
										scrollHeight="150">
										<f:facet name="header">
											#{messages.label_task}
										</f:facet>
										<p:column
											headerText="#{messages.project_gantt_table_name_title}"
											width="70%">
											<h:outputText
												value="#{task.id}-#{task.name}" />
										</p:column>
										<p:column
											headerText="#{messages.project_gantt_table_assigned_title}"
											width="30%">
											<h:outputText value="#{task.assignedTo}"
												converter="JJContactConverter" />
										</p:column>
									</p:dataTable>
								</h:panelGroup>
							</h:panelGroup>
						</p:panel>
					</h:form>
				</h:panelGroup>
			</h:panelGroup>

			<h:panelGroup layout="block" styleClass="EmptyBox20" />
			<h:panelGroup id="container" layout="block"
				styleClass="Container100 MarAuto Responsive100"
				rendered="#{loginBean.enable and jJBugBean.viewBug != null and jJBugBean.viewBug.id != null}">
				<ui:include src="/pages/communication.xhtml">
					<ui:param name="communicationList"
						value="#{jJBugBean.communicationMessages}" />
					<ui:param name="field" value="#{jJBugBean.viewBug}" />
					<ui:param name="cols" value="120" />
				</ui:include>
			</h:panelGroup>
		</h:panelGroup>

		<p:dialog id="createDialog" header="#{messages.bug_create_title}"
			draggable="false" modal="true" widgetVar="createDialogWidget"
			dynamic="true" resizable="false" maximizable="false" showEffect="fade"
			hideEffect="explode">
			<p:ajax event="close" listener="#{jJBugBean.handleDialogClose}" />
			<p:outputPanel id="createPanel">
				<h:form id="createForm" enctype="multipart/form-data">
					<h:panelGroup id="createPanelGrid" layout="block"
						styleClass="Container ui-fluid BorderAll" style="max-width: 750px;">
						<ui:include src="bugDialog.xhtml">
							<ui:param name="JJBug_" value="#{jJBugBean.JJBug_}" />
						</ui:include>
						<h:panelGroup layout="block"
							styleClass="Container50 Responsive50 ">
							<h:panelGroup layout="block" styleClass="ContainerIndent">
								<p:commandButton id="createSaveButton"
									onstart="PF('bugBlockUIWidget').block()"
									oncomplete="PF('bugBlockUIWidget').unblock()"
									value="#{messages.label_save}" action="#{jJBugBean.persistBug}"
									update="createPanelGrid,:growlForm" />
							</h:panelGroup>
						</h:panelGroup>
						<h:panelGroup layout="block"
							styleClass="Container50 Responsive50 ">
							<h:panelGroup layout="block" styleClass="ContainerIndent">
								<p:commandButton id="createCloseButton"
									value="#{messages.label_cancel}" styleClass="GrayBack"
									onclick="PF('createDialogWidget').hide()" type="button" />
							</h:panelGroup>
						</h:panelGroup>
					</h:panelGroup>
				</h:form>
			</p:outputPanel>
		</p:dialog>
	</ui:define>
</ui:composition>
</html>