<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/template.xhtml">
	<ui:define name="head">
		<h:outputStylesheet library="css" name="planningStyle.css" />
		<h:outputScript library="js" name="scrollDataTable.js" />
	</ui:define>
	<ui:define name="content">
		<h:form id="formId" style="width:100%;display:none;">
			<p:remoteCommand update=":projecttabview:SprintTabView :growlForm"
				name="updateTabSprint" />
			<p:remoteCommand onstart="PF('blockUIWidget').block()"
				name="tabChangeHelper"
				actionListener="#{jJSprintBean.onTabSprintChange}"
				oncomplete="PF('blockUIWidget').unblock()" />
		</h:form>
		<h:form id="projectForm" rendered="#{jJProjectBean.project != null}">
			<h:panelGroup styleClass="Container ui-fluid">
				<h:panelGroup layout="block" styleClass="Container10 Responsive50">
					<h:panelGroup layout="block" styleClass="ContainerIndent">
						<p:outputLabel
							value="#{messages.label_project}: #{jJProjectBean.project.name}" />
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup layout="block" styleClass="Container30 Responsive50">
					<h:panelGroup layout="block" styleClass="Container40">
						<h:panelGroup layout="block" styleClass="ContainerIndent">
							<p:outputLabel for="projectSD"
								value="#{messages.admin_project_new_startDate_label}:" />
						</h:panelGroup>
					</h:panelGroup>
					<h:panelGroup layout="block" styleClass="Container60">
						<p:calendar id="projectSD" navigator="true" effect="slideDown"
							pattern="dd/MM/yyyy" required="true"
							readonly="#{!loginBean.authorisationService.adminProject}"
							binding="#{startDateProjectEdition}"
							requiredMessage="#{messages.admin_project_new_startDate_alert}"
							value="#{jJProjectBean.project.startDate}" />
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup layout="block" styleClass="Container30 Responsive50">
					<h:panelGroup layout="block" styleClass="Container40">
						<h:panelGroup layout="block" styleClass="ContainerIndent">
							<p:outputLabel for="projectED"
								value="#{messages.admin_project_new_endDate_label}:" />
						</h:panelGroup>
					</h:panelGroup>
					<h:panelGroup layout="block" styleClass="Container60">
						<p:calendar id="projectED" navigator="true" effect="slideDown"
							pattern="dd/MM/yyyy" required="true"
							readonly="#{!loginBean.authorisationService.adminProject}"
							requiredMessage="#{messages.admin_project_new_endDate_alert}"
							value="#{jJProjectBean.project.endDate}">
							<f:validator validatorId="dateRangeValidator" />
							<f:attribute name="startDateComponent"
								value="#{startDateProjectEdition}" />
						</p:calendar>
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup layout="block" styleClass="Container30 Responsive50">
					<h:panelGroup layout="block" styleClass="EmptyBox10 Container20" />
					<h:panelGroup layout="block" styleClass="Container60">
						<p:commandButton id="submitButton"
							onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()" icon="fa fa-save"
							disabled="#{!loginBean.authorisationService.adminProject}"
							value="#{messages.admin_project_new_save_button}"
							update=":projectForm :headerForm :growlForm"
							action="#{jJProjectBean.savePlanning}" />
					</h:panelGroup>
					<h:panelGroup layout="block" styleClass="EmptyBox10 Container20" />
				</h:panelGroup>
			</h:panelGroup>
		</h:form>
		<h:panelGroup layout="block" styleClass="EmptyBox10" />
		<p:tabView id="projecttabview" widgetVar="projectTabView"
			activeIndex="#{jJSprintBean.activeTabGantIndex}"
			onTabChange="tabChangeHelper([{name: 'activeGantIndex', value: index}])"
			dynamic="false" cache="true" style="width: 100% !important;">

			<p:tab title="#{loginBean.planningConfiguration.firstPageHeader}">
				<h:panelGrid columns="1" cellpadding="3"
					style="width:100% !important;">
					<ui:insert>
						<ui:include src="#{loginBean.planningConfiguration.firstPage}" />
					</ui:insert>
				</h:panelGrid>
			</p:tab>
			<p:tab title="#{loginBean.planningConfiguration.secondPageHeader}"
				rendered="#{loginBean.planningConfiguration.render}">
				<h:panelGrid columns="1" cellpadding="3"
					style="width:100% !important;">
					<ui:insert>
						<ui:include src="#{loginBean.planningConfiguration.secondPage}" />
					</ui:insert>
				</h:panelGrid>
			</p:tab>
		</p:tabView>
		<p:hotkey bind="esc" handler="PF('videoHelpWidget').hide()" />
		<p:dialog id="videoHelpDialog" widgetVar="videoHelpWidget"
			position="center" header="#{messages.specification_video_help_title}"
			style="padding:0px;" resizable="false" draggable="false"
			minHeight="500" minWidth="500" showEffect="fade" hideEffect="fade">
			<video width="100%" height="100%" controls="true">
				<source src="https://www.starit.fr/jjtraining.mp4" type="video/mp4" />
			</video>
		</p:dialog>
		<p:confirmDialog id="deleteDialog" widgetVar="deleteDialogWidget"
			message="#{messages.task_delete_title}" showEffect="fade"
			hideEffect="explode" header="#{messages.task_delete_confirm_label}"
			severity="alarm">
			<p:outputPanel id="deletePanel">
				<h:form id="deleteForm">
					<p:commandButton id="deleteYesPlanning"
						value="#{messages.bug_delete_yes_button}"
						action="#{jJTaskBean.deleteTaskData}"
						update=":projecttabview :growlForm"
						onstart="saveScrollPos();PF('blockUIWidget').block()"
						oncomplete="autoScroll();PF('blockUIWidget').unblock()" />
					<p:commandButton id="deleteNoButton"
						value="#{messages.bug_delete_no_button}"
						onclick="PF('deleteDialogWidget').hide()" type="button" />
				</h:form>
			</p:outputPanel>
		</p:confirmDialog>
		<p:dialog id="taskImportDialog"
			header="#{messages.project_gantt_import_button}" modal="true"
			draggable="false" styleClass="disable-scroll"
			widgetVar="taskImportDialogWidget" dynamic="true" resizable="false">
			<p:ajax event="close" update=":projecttabview"
				onstart="PF('blockUIWidget').block()"
				oncomplete="PF('blockUIWidget').unblock()"
				listener="#{jJTaskBean.closeDialogImport}" />
			<p:outputPanel id="importTaskDialogPanel">
				<ui:insert name="importTask">
					<ui:include src="importTask.xhtml" />
				</ui:insert>
			</p:outputPanel>
		</p:dialog>

		<p:dialog id="viewTaskDialog" modal="true" draggable="false" resizable="false"
			widgetVar="viewTaskDialogWidget" dynamic="true" 
			showEffect="fade" hideEffect="explode">
			<p:ajax event="close" update=":projecttabview"
				onstart="#{jJTaskBean.mode eq 'planning' ? 'saveScrollPos()' : ''};PF('blockUIWidget').block()"
				oncomplete="#{jJTaskBean.mode eq 'planning' ? 'autoScroll()' : ''};PF('blockUIWidget').unblock()"
				listener="#{jJTaskBean.closeEvent('planning')}" />
			<f:facet name="header">
				<p:outputLabel id="viewTaskDialogHeader"
					value="#{messages.label_view} #{jJTaskBean.getDialogHeader(jJTaskBean.task,null)}" />
			</f:facet>
			<p:outputPanel id="viewTaskPanel">
				<h:form id="viewTaskForm" enctype="multipart/form-data">
					<ui:include src="taskDialog.xhtml">
						<ui:param name="JJTask_" value="#{jJTaskBean.task}" />
						<ui:param name="View" value="planning" />
					</ui:include>
				</h:form>
			</p:outputPanel>
		</p:dialog>
		
		<p:dialog id="editBugDialog" header="#{messages.label_edit} Bug"
			modal="true" widgetVar="editBugDialogWidget" dynamic="true"
			resizable="true" maximizable="true" showEffect="fade"
			draggable="false" hideEffect="explode">
			<p:outputPanel id="editBugPanel">
				<h:form id="editBugForm" enctype="multipart/form-data">
					<p:panelGrid columns="2">
						<p:outputLabel value="BUG :" for="taskBugName" />
						<p:inputText id="taskBugName" readonly="true"
							converter="JJBugConverter" value="#{jJSprintBean.bug}" />
						<p:outputLabel for="taskBugStatus" value="Status : " />
						<p:autoComplete id="taskBugStatus"
							value="#{jJSprintBean.bug.status}"
							itemLabel="#{loginBean.checkMessage(status)}"
							itemValue="#{status}" scrollHeight="200"
							converter="com.starit.janjoonweb.ui.mb.converter.JJStatusConverter"
							dropdown="true" var="status" style="width:200px;"
							completeMethod="#{jJBugBean.completeStatusBug}" />
						<p:commandButton id="taskBugSaveButton"
							value="#{messages.bug_edit_save_button}"
							action="#{jJSprintBean.persistBugTask}"
							update=":projecttabview :growlForm"
							onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()"
							onsuccess="PF('editBugDialogWidget').hide()">
						</p:commandButton>
						<p:commandButton id="taskBugCloseButton"
							value="#{messages.bug_edit_close_button}"
							oncomplete="PF('blockUIWidget').unblock()"
							onclick="PF('editBugDialogWidget').hide()" type="button" />
					</p:panelGrid>
				</h:form>
			</p:outputPanel>
		</p:dialog>
	</ui:define>
</ui:composition>
</html>