<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/template.xhtml">
	<ui:define name="head">		 
		<h:outputStylesheet  library="css" name="planningStyle.css" />
		<h:outputScript library="js" name="scrollDataTable.js" />
	</ui:define>
	<ui:define name="content">
		<h:form id="formId" style="width:100%;display:none;">
			<p:remoteCommand update=":projecttabview:SprintTabView:sprintForm"
				name="updateTabSprint" />
			<p:remoteCommand name="tabChangeHelper" update=":projecttabview"
				actionListener="#{jJSprintBean.onTabSprintChange}"
				oncomplete="updateTabViewWidth();" />

			<p:remoteCommand name="sprintTabChangeHelper"
				update="projecttabview:activeSprintIndexForm"
				actionListener="#{jJSprintBean.onTabSprintChange}"
				oncomplete="updateTabViewWidth();" />

		</h:form>
		<h:panelGroup layout="block" styleClass="Container ui-fluid">
			<h:form id="projectForm" rendered="#{jJProjectBean.project != null}">
				<h:panelGroup layout="block" styleClass="Container80 Responsive100">
					<h:panelGroup layout="block" styleClass="Container15 Responsive50">
						<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
							<p:outputLabel
								value="#{messages.label_project}: #{jJProjectBean.project.name}" />
						</h:panelGroup>
					</h:panelGroup>
					<h:panelGroup layout="block" styleClass="Container30 Responsive50">
						<h:panelGroup layout="block" styleClass="Container50">
							<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
								<p:outputLabel for="projectSD"
									value="#{messages.admin_project_new_startDate_label}:" />
							</h:panelGroup>
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="Container50">
							<h:panelGroup layout="block" styleClass="ContainerIndent">
								<p:calendar id="projectSD" navigator="true" effect="slideDown"
									pattern="dd/MM/yyyy" required="true" readonlyInput="true"
									readonly="#{!loginBean.authorisationService.adminProject}"
									binding="#{startDateProjectEdition}"
									requiredMessage="#{messages.admin_project_new_startDate_alert}"
									value="#{jJProjectBean.project.startDate}" />
							</h:panelGroup>
						</h:panelGroup>
					</h:panelGroup>
					<h:panelGroup layout="block" styleClass="Container30 Responsive50">
						<h:panelGroup layout="block" styleClass="Container50">
							<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
								<p:outputLabel for="projectED"
									value="#{messages.admin_project_new_endDate_label}:" />
							</h:panelGroup>
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="Container50">
							<h:panelGroup layout="block" styleClass="ContainerIndent">
								<p:calendar id="projectED" navigator="true" effect="slideDown"
									pattern="dd/MM/yyyy" required="true" readonlyInput="true"
									readonly="#{!loginBean.authorisationService.adminProject}"
									requiredMessage="#{messages.admin_project_new_endDate_alert}"
									value="#{jJProjectBean.project.endDate}">
									<f:validator validatorId="dateRangeValidator" />
									<f:attribute name="startDateComponent"
										value="#{startDateProjectEdition}" />
								</p:calendar>
							</h:panelGroup>
						</h:panelGroup>
					</h:panelGroup>
					<h:panelGroup layout="block" styleClass="Container25 Responsive50">
						<h:panelGroup layout="block" styleClass="ContainerIndent">
							<p:commandButton id="submitButton" icon="fa fa-save"
								disabled="#{!loginBean.authorisationService.adminProject}"
								value="#{messages.admin_project_new_save_button}"
								update=":projectForm :headerForm:projectSelectOneMenu :growlForm"
								action="#{jJProjectBean.savePlanning}" />
						</h:panelGroup>
					</h:panelGroup>
				</h:panelGroup>
			</h:form>
			<h:panelGroup layout="block" styleClass="EmptyBox10" />
			<h:panelGroup layout="block" styleClass="Container100">
				<p:tabView id="projecttabview" widgetVar="projectTabView"
					activeIndex="#{jJSprintBean.activeTabGantIndex}" style="border: 0px;"
					onTabChange="tabChangeHelper([{name: 'activeGantIndex', value: index}]);"
					dynamic="false" cache="true">
					<p:tab title="#{loginBean.planningConfiguration.firstPageHeader}">
						<ui:insert>
							<ui:include src="#{loginBean.planningConfiguration.firstPage}" />
						</ui:insert>
					</p:tab>
					<p:tab title="#{loginBean.planningConfiguration.secondPageHeader}"
						rendered="#{loginBean.planningConfiguration.render}">
						<ui:insert>
							<ui:include src="#{loginBean.planningConfiguration.secondPage}" />
						</ui:insert>
					</p:tab>
					<p:tab title="Kanban" rendered="#{loginBean.planningConfiguration.renderKanban}">
						<ui:insert>
							<ui:include src="kanban.xhtml" />
						</ui:insert>
					</p:tab><p:tab title="#{messages.project_simulator_menuitem}" rendered="#{loginBean.planningConfiguration.renderSimulator}">
						<ui:insert>
							<ui:include src="simulator.xhtml" />
						</ui:insert>
					</p:tab>
				</p:tabView>
			</h:panelGroup>
		</h:panelGroup>
		<p:hotkey bind="esc" handler="PF('videoHelpWidget').hide()" />
		<p:dialog id="videoHelpDialog" widgetVar="videoHelpWidget"
			position="center" header="#{messages.specification_video_help_title}"
			style="padding:0px;" resizable="false" draggable="false"
			responsive="true" minHeight="500" minWidth="500" showEffect="fade"
			hideEffect="fade">
			<video width="100%" height="100%" controls="controls" >
				<source src="https://www.starit.fr/jjtraining.mp4" type="video/mp4" />
			</video>
		</p:dialog>
		<p:confirmDialog id="deleteDialog" widgetVar="deleteDialogWidget"
			message="#{messages.task_delete_title}" showEffect="fade"
			header="#{messages.task_delete_confirm_label}" severity="alarm">
			<p:outputPanel id="deletePanel">
				<h:form id="deleteForm">
					<p:commandButton id="deleteYesPlanning"
						value="#{messages.bug_delete_yes_button}"
						action="#{jJTaskBean.deleteTaskData}"
						update=":projecttabview :growlForm"
						onstart="saveScrollPos()"
						oncomplete="autoScroll();updateTabViewWidth();" />
					<p:commandButton id="deleteNoButton"
						value="#{messages.bug_delete_no_button}"
						onclick="PF('deleteDialogWidget').hide()" type="button" />
				</h:form>
			</p:outputPanel>
		</p:confirmDialog>
		<p:dialog id="taskImportDialog" responsive="true"
			header="#{messages.project_gantt_import_button}" modal="true"
			draggable="false" styleClass="disable-scroll"
			widgetVar="taskImportDialogWidget" dynamic="true" resizable="false">
			<p:ajax event="close" oncomplete="updateTabViewWidth();" listener="#{jJTaskBean.closeDialogImport}" />
			<p:outputPanel id="importTaskDialogPanel">
				<ui:insert name="importTask">
					<ui:include src="importTask.xhtml" />
				</ui:insert>
			</p:outputPanel>
		</p:dialog>

		<p:dialog id="viewTaskDialog" modal="true" draggable="false"
			resizable="false" widgetVar="viewTaskDialogWidget" dynamic="true"
			showEffect="fade" responsive="true">
			<p:ajax event="close" 
				onstart="#{jJTaskBean.mode eq 'planning' ? 'saveScrollPos()' : ''};"
				oncomplete="#{jJTaskBean.mode eq 'planning' ? 'autoScroll()' : ''};updateTabViewWidth();"
				listener="#{jJTaskBean.closeEvent('planning')}" />
			<f:facet name="header">
				<p:outputLabel id="viewTaskDialogHeader"
					value="#{messages.label_view} #{jJTaskBean.getDialogHeader(jJTaskBean.task,null)}" />
			</f:facet>
			<p:outputPanel id="viewTaskPanel">
				<h:form id="viewTaskForm" enctype="multipart/form-data">
					<ui:include src="taskDialog.xhtml">
						<ui:param name="JJTask_" value="#{jJTaskBean.task}" />
						<ui:param name="View" value="planning" />
					</ui:include>
				</h:form>
			</p:outputPanel>
		</p:dialog>

		<p:dialog id="importSimulatorDialog"
			header="#{messages.project_scrum_new_title}" modal="true"
			widgetVar="sprintDialogWidget" dynamic="true"
			resizable="false" maximizable="false" showEffect="fade"
			draggable="false" responsive="true">
			<p:outputPanel id="importSimulatorDialogPanel">
				<ui:insert name="importSimulator">
					<ui:include src="sprintDialog.xhtml" />
				</ui:insert>
			</p:outputPanel>
		</p:dialog>

		<p:dialog id="editBugDialog" header="#{messages.label_edit} Bug"
			modal="true" widgetVar="editBugDialogWidget" dynamic="true"
			resizable="false" maximizable="false" showEffect="fade"
			draggable="false" responsive="true">
			<p:outputPanel id="editBugPanel">
				<h:form id="editBugForm" enctype="multipart/form-data">
					<h:panelGroup layout="block" styleClass="Container ui-fluid"
						style="max-width: 300px;">
						<h:panelGroup layout="block"
							styleClass="Container100 Responsive50">
							<h:panelGroup layout="block" styleClass="Container30">
								<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
									<p:outputLabel value="BUG :" for="taskBugName" />
								</h:panelGroup>
							</h:panelGroup>
							<h:panelGroup layout="block" styleClass="Container70">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:inputTextarea id="taskBugName" readonly="true" rows="2"
										converter="JJBugConverter" value="#{jJSprintBean.bug}" />
								</h:panelGroup>
							</h:panelGroup>
						</h:panelGroup>
						<h:panelGroup layout="block"
							styleClass="Container100 Responsive50">
							<h:panelGroup layout="block" styleClass="Container30">
								<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
									<p:outputLabel for="taskBugStatus" value="Status : " />
								</h:panelGroup>
							</h:panelGroup>
							<h:panelGroup layout="block" styleClass="Container70">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:autoComplete id="taskBugStatus"
										value="#{jJSprintBean.bug.status}"
										itemLabel="#{loginBean.checkMessage(status)}"
										itemValue="#{status}" scrollHeight="200"
										converter="com.starit.janjoonweb.ui.mb.converter.JJStatusConverter"
										dropdown="true" var="status" style="width:200px;"
										completeMethod="#{jJBugBean.completeStatusBug}" />
								</h:panelGroup>
							</h:panelGroup>
						</h:panelGroup>
						<h:panelGroup layout="block"
							styleClass="Container50 Responsive50 ">
							<h:panelGroup layout="block" styleClass="ContainerIndent">
								<p:commandButton id="taskBugSaveButton"
									value="#{messages.bug_edit_save_button}"
									icon="fa fa-save Fs16"
									action="#{jJSprintBean.persistBugTask}"
									update=":projecttabview :growlForm"
									oncomplete="updateTabViewWidth();"
									onsuccess="PF('editBugDialogWidget').hide()" />
							</h:panelGroup>
						</h:panelGroup>
						<h:panelGroup layout="block"
							styleClass="Container50 Responsive50 ">
							<h:panelGroup layout="block" styleClass="ContainerIndent">
								<p:commandButton id="taskBugCloseButton" styleClass="GrayButton"
									value="#{messages.bug_edit_close_button}"
									onclick="PF('editBugDialogWidget').hide()" type="button" />
							</h:panelGroup>
						</h:panelGroup>
					</h:panelGroup>
				</h:form>
			</p:outputPanel>
		</p:dialog>
	</ui:define>
</ui:composition>
</html>