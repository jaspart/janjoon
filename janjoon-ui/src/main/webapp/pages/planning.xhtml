<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/layout.xhtml">
	<ui:define name="content">
		<p:tabView id="projecttabview" widgetVar="projectTabView"
			dynamic="false" cache="true" style="width:100% !important;"
			activeIndex="#{loginBean.activeTabProjectIndex}">

			<p:ajax event="tabChange"
				listener="#{jJSprintBean.onTabSprintChange}"
				onstart="PF('blockUIWidget').block()"
				oncomplete="PF('blockUIWidget').unblock()" />
			<p:tab id="tabPlanning" title="#{messages.project_gantt_menuitem}">
				<h:panelGrid id="projectpanel" columns="1" cellpadding="3"
					style="width:100% !important;">
					<ui:insert name="gantt">
						<ui:include src="gantt.xhtml" />
					</ui:insert>
				</h:panelGrid>
			</p:tab>
			<p:tab title="#{messages.project_scrum_menuitem}">
				<h:panelGrid columns="1" cellpadding="3">
					<ui:insert name="scrum">
						<ui:include src="scrum.xhtml" />
					</ui:insert>
				</h:panelGrid>
			</p:tab>
		</p:tabView>
		<p:hotkey bind="esc" handler="PF('videoHelpWidget').hide()" />
		<p:dialog id="videoHelpDialog" widgetVar="videoHelpWidget"
			position="center" header="#{messages.specification_video_help_title}"
			style="padding:0px;" resizable="false" draggable="false"
			minHeight="500" minWidth="500" showEffect="fade" hideEffect="fade">
			<video width="100%" height="100%" controls="true">
				<source src="https://www.starit.fr/jjtraining.mp4" type="video/mp4" />
			</video>
		</p:dialog>
		<p:confirmDialog id="deleteDialog" widgetVar="deleteDialogWidget"
			message="#{messages.task_delete_title}" showEffect="fade"
			hideEffect="explode" header="#{messages.task_delete_confirm_label}"
			severity="alarm">
			<p:outputPanel id="deletePanel">
				<h:form id="deleteForm">
					<p:commandButton id="deleteYesPlanning"
						value="#{messages.bug_delete_yes_button}"
						action="#{jJTaskBean.deleteTaskData}" update=":projecttabview" 
						onstart="PF('blockUIWidget').block()"
						oncomplete="PF('blockUIWidget').unblock();"/>
					<p:commandButton id="deleteNoButton"
						value="#{messages.bug_delete_no_button}"
						oncomplete="PF('blockUIWidget').unblock()"
						onclick="PF('deleteDialogWidget').hide()" type="button" />
				</h:form>
			</p:outputPanel>
		</p:confirmDialog>
		<p:dialog id="taskImportDialog" header="Import Tasks" modal="true"
			draggable="false" styleClass="disable-scroll"
			widgetVar="taskImportDialogWidget" dynamic="true" resizable="false">
			<p:ajax event="close" update=":projecttabview"
				listener="#{jJTaskBean.closeDialogImport}" />
			<p:outputPanel id="importTaskDialogPanel">
				<ui:insert name="importTask">
					<ui:include src="importTask.xhtml" />
				</ui:insert>
			</p:outputPanel>
		</p:dialog>

		<p:dialog id="viewTaskDialog" header="#{messages.label_view} JJTask"
			modal="true" widgetVar="viewTaskDialogWidget" dynamic="true"
			resizable="true" maximizable="true" showEffect="fade"
			hideEffect="explode" draggable="#{jJTaskBean.mode eq 'planning'}">
			<p:ajax event="close" update=":projecttabview" listener="#{jJTaskBean.closeEvent('planning')}"/>
			<p:outputPanel id="viewTaskPanel">
				<h:form id="viewTaskForm" enctype="multipart/form-data" >
					<ui:include src="taskDialog.xhtml">
						<ui:param name="JJTask_" value="#{jJTaskBean.task}" />
					</ui:include>					
					<p:commandButton id="updateTaskButton"  update=":viewTaskForm"
						actionListener="#{jJTaskBean.updateTask(jJTaskBean.task,'planning')}" value="#{messages.label_update} Task"
						process="@this,taskSprint,taskStatus,taskStartDatePlanned,taskEndDatePlanned,taskWorkload"
						onstart="PF('viewtaskBlockUIWidget').block()" style="margin-top: 5px;"
						oncomplete="PF('viewtaskBlockUIWidget').unblock();"/>						
						
					<p:commandButton id="viewCloseButton"
						value="#{messages.label_close}" style="margin-left: 20px;margin-top: 5px;"
						oncomplete="PF('blockUIWidget').unblock()" onstart="PF('blockUIWidget').block()"
						onclick="PF('viewTaskDialogWidget').hide()" type="button" />
					
				</h:form>
			</p:outputPanel>
		</p:dialog>
		<p:dialog id="editBugDialog" header="#{messages.label_edit} JJBug"
			modal="true" widgetVar="editBugDialogWidget" dynamic="true"
			resizable="true" maximizable="true" showEffect="fade"
			draggable="false" hideEffect="explode">
			<p:outputPanel id="editBugPanel">
				<h:form id="editBugForm" enctype="multipart/form-data">
					<p:panelGrid columns="2">
						<p:outputLabel value="BUG :" for="taskBugName" />
						<p:inputText id="taskBugName" readonly="true"
							converter="JJBugConverter" value="#{jJSprintBean.bug}" />
						<p:outputLabel for="taskBugStatus" value="Status : " />
						<p:autoComplete id="taskBugStatus"
							value="#{jJSprintBean.bug.status}" itemLabel="#{status.name}"
							itemValue="#{status}" scrollHeight="200"
							converter="com.starit.janjoonweb.ui.mb.converter.JJStatusConverter"
							dropdown="true" var="status" style="width:200px;"
							completeMethod="#{jJBugBean.completeStatusBug}" />
						<p:commandButton id="taskBugSaveButton"
							value="#{messages.bug_edit_save_button}"
							action="#{jJSprintBean.persistBugTask}" update=":projecttabview"
							oncomplete="PF('blockUIWidget').unblock()"
							onsuccess="PF('editBugDialogWidget').hide()">
						</p:commandButton>
						<p:commandButton id="taskBugCloseButton"
							value="#{messages.bug_edit_close_button}"
							oncomplete="PF('blockUIWidget').unblock()"
							onclick="PF('editBugDialogWidget').hide()" type="button" />
					</p:panelGrid>
				</h:form>
			</p:outputPanel>
		</p:dialog>
	</ui:define>
</ui:composition>
</html>