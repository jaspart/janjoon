<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<ui:composition template="../templates/template.xhtml">
	<ui:define name="head">
		<style type="text/css">
/* .ui-datalist-data { */
/* 	-webkit-padding-start: 2px; */
/* } */

/* .ui-datalist .ui-datalist-header { */
/* 	background-color: #d1d3d4; */
/* 	color: #0288d1; */
/* } */
/* .ui-editor { */
/* 	height: 150px !important; */
/* } */

/* .cke_chrome { */
/* 	visibility: inherit; */
/* 	width: 730px !important; */
/* } */
.testCaseDataTable {
	
}

.customPanelGrid {
	/* 	float: left; */
	/* 	margin-left: 10px; */
	/* 	width: 67%; */
	
}

.customPanelGrid .ui-panelgrid-cell {
	
}

.testCaseDataTable tbody td {
	padding: 0px 0px;
	overflow: hidden;
	border-width: 1px;
	border-style: none;
}

.reqTree {
	height: 400px;	
	overflow-y: auto;
	overflow-x: hidden;
	border: rgba(255, 0, 0, 0);
	padding: 2px;
}

.reqTree .ui-tree-container {
	width: 100%;
}

.customPanel {
	/* 	height: 400px; */
	/* 	width: 100%; */
	/* 	float: left; */
	/* 	margin-top: 10px; */
	
}

.customPanel .ui-panel-titlebar {
	text-align: center;
}

/* .cke_contents { */
/* 	height: 150px !important; */
/* } */
</style>
		<h:outputScript library="js" name="scrollTab.js" />
	</ui:define>
	<ui:define name="content">
		<f:event listener="#{requirementBean.checkRequirement}"
			type="preRenderView" />
		<h:panelGroup layout="block" styleClass="Container">
			<h:form id="treeForm">
				<p:remoteCommand name="updateTree" update="@form" />

				<p:overlayPanel id="colorPanel" for="colorBtn" hideEffect="fade"
					styleClass="Container50 Responsive50 ShowOnDesktop">
					<p:panelGrid>
						<f:facet name="header">
							<p:row>
								<p:column colspan="12">#{messages.specification_color_title}</p:column>
							</p:row>
						</f:facet>
						<p:row>
							<p:column styleClass="UnLinked Wid20">
								<p:outputLabel style="color: #fff;"
									value="#{messages.specification_color_RequirementNotLinked_label}" />
							</p:column>
							<p:column styleClass="Specified Wid20">
								<p:outputLabel style="color: #fff;"
									value="#{messages.specification_color_RequirementNoTask_label}" />
							</p:column>
							<p:column styleClass="Progress Wid20">
								<p:outputLabel style="color: #fff;"
									value="#{messages.specification_color_RequirementInProcess_label}" />
							</p:column>
							<p:column styleClass="InTesting Wid20">
								<p:outputLabel style="color: #fff;"
									value="#{messages.specification_color_RequirementFinishedTestProcess_label}" />
							</p:column>
							<p:column styleClass="Finished Wid20">
								<p:outputLabel style="color: #fff;"
									value="#{messages.specification_color_RequirementFinishedSuccessed_label}" />
							</p:column>
						</p:row>
					</p:panelGrid>
				</p:overlayPanel>

				<h:panelGroup id="treePanelGrid" layout="block"
					styleClass="Container30 MarAuto Responsive100">

					<h:panelGroup layout="block" styleClass="ContainerIndent">
						<p:panelGrid styleClass="Container100">
							<f:facet name="header">
								<p:row>
									<p:column colspan="2" style="text-align: left;">

										<p:commandLink id="rate"
											actionListener="#{requirementBean.onrate}"
											update=":growlForm :messageCreationForm :headerForm:communicationButton :treeForm:rate"
											rendered="#{requirementBean.requirement != null}"
											onstart="PF('blockUIWidget').block()"
											oncomplete="PF('blockUIWidget').unblock()">
											<p:graphicImage
												name="#{!requirementBean.rated ? 'blackstar.ico' : 'yelstar.ico'}"
												width="32" height="32" cache="false" library="images"
												title="#{!requirementBean.rated ? messages.requirement_subscription_rate_title : messages.requirement_subscription_cancel_rate_title}" />
										</p:commandLink>
										<p:commandButton id="colorBtn" icon="fa fa-info-circle Fs20"
											type="button" styleClass="ShowOnDesktop"
											style="margin-left: 1%;" />

										<p:commandButton id="manageChapterButton" resetValues="true"
											icon="fa fa-folder Fs20" title="#{jJChapterBean.warnMessage}"
											update=":chapterDialogPanel" style="margin-left: 1%;"
											disabled="#{jJChapterBean.disabledChapter or jJProjectBean.project == null or requirementBean.category == null}"
											actionListener="#{jJChapterBean.loadData(requirementBean.category.id)}"
											onstart="PF('blockUIWidget').block()"
											oncomplete="PF('blockUIWidget').unblock();PF('chapterDialogWidget').show()" />

										<p:commandButton id="newRequirementButton"
											icon="fa fa-plus-square Fs20" style="margin-left: 1%;"
											title="#{loginBean.authorisationService.wRequiementMSG}"
											disabled="#{jJRequirementBean.disabledRequirement or !loginBean.authorisationService.wRequiement or requirementBean.category == null}"
											actionListener="#{jJRequirementBean.newRequirement(requirementBean.category.id)}"
											update=":requirementDialogPanel :requirementDialogHeader"
											resetValues="true" onstart="PF('blockUIWidget').block()"
											oncomplete="PF('blockUIWidget').unblock();PF('requirementDialogWidget').show()" />

										<p:selectOneMenu id="category"
											value="#{requirementBean.category}" effect="fade"
											style="text-transform: uppercase;margin-left: 3%;"
											converter="com.starit.janjoonweb.ui.mb.converter.JJCategoryConverter">

											<f:selectItems value="#{requirementBean.categories}"
												var="cat" itemLabel="#{loginBean.checkMessage(cat)}"
												itemValue="#{cat}" />
											<p:ajax onstart="PF('blockUIWidget').block()" event="change"
												listener="#{requirementBean.categorySelectionChanged}"
												update=":treeForm"
												oncomplete="PF('blockUIWidget').unblock();" />

										</p:selectOneMenu>
									</p:column>
								</p:row>
							</f:facet>
							<p:row>
								<p:column colspan="2"
									style="padding-left: 0px !important;padding-right: 0px !important;padding-top: 0px !important;padding-bottom: 0px !important;">
									<p:accordionPanel id="accordionTreePanel"
										activeIndex="#{requirementBean.activeIndex}"
										styleClass="accordionTreePanel">
										<p:tab title="#{messages.specification_tree_panel_header}">
											<p:tree id="reqTree" value="#{requirementBean.rootNode}"
												var="node" selectionMode="single"
												styleClass="reqTree Container95"
												selection="#{requirementBean.selectedNode}" dynamic="true">
												<p:ajax event="select"
													listener="#{requirementBean.onNodeSelect}"
													onstart="PF('blockUIWidget').block()"
													oncomplete="PF('blockUIWidget').unblock()" />

												<p:treeNode type="projet">
													<h:outputText value="P-#{node.id}-#{node.name}" />
												</p:treeNode>
												<p:treeNode type="chapter">
													<h:outputText value="CH-#{node.id}-#{node.name}" />
												</p:treeNode>
												<p:treeNode type="category">
													<h:outputText
														value="C-#{node.id}-#{loginBean.checkMessage(node)}" />
												</p:treeNode>
												<p:treeNode type="Requirement">
													<h:outputText style="#{requirementBean.underligne(node)}"
														value="R-#{node.requirement.id}-#{fn:substring(node.requirement.name,0,25)}"
														styleClass="#{node.style}" />
												</p:treeNode>
											</p:tree>
										</p:tab>
									</p:accordionPanel>
								</p:column>
							</p:row>

						</p:panelGrid>
					</h:panelGroup>

				</h:panelGroup>
			</h:form>
			<h:panelGroup layout="block"
				styleClass="Container70 MarAuto Responsive100">

				<h:panelGroup layout="block" styleClass="ContainerIndent">
					<h:form id="requirementForm">
						<p:panel id="requirementFormPanelGrid"
							rendered="#{requirementBean.requirement != null}"
							styleClass="Container100 ui-fluid">
							<f:facet name="header">
								<h:outputText style="float: left;" styleClass="Fs18"
									value="ID:#{requirementBean.requirement.id}" />
								<h:outputText id="nombres" styleClass="Fs18"
									value="#{loginBean.checkMessage(requirementBean.requirement.category)}"
									style="text-transform: uppercase;float: right;" />
							</f:facet>
							<h:panelGroup layout="block"
								styleClass="Container50 Responsive100">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:inputText id="nameReq" label="#{messages.label_name}"
										title="#{messages.label_name}"
										value="#{requirementBean.requirement.name}" required="true"
										requiredMessage="#{messages.specification_create_name_alert}">
										<f:validateLength maximum="100" />
									</p:inputText>
								</h:panelGroup>
							</h:panelGroup>
							<h:panelGroup layout="block"
								styleClass="Container50 Responsive100">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:autoComplete id="chapter" scrollHeight="200"
										value="#{requirementBean.requirement.chapter}"
										itemLabel="#{chapter != null ? chapter.name : messages.label_selectChapter}"
										itemValue="#{chapter}"
										title="#{messages.specification_create_chapter_label}"
										converter="com.starit.janjoonweb.ui.mb.converter.JJChapterConverter"
										dropdown="true" var="chapter"
										completeMethod="#{requirementBean.completeChapterRequirement}" />
								</h:panelGroup>
							</h:panelGroup>
							<h:panelGroup layout="block" style="height: 220px;"
								rendered="#{!loginBean.mobile}"
								styleClass="Container100 Responsive100">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<pe:ckEditor id="description"
										toolbar="#{imageStreamer.ckEditorToolBar}" width="100%;"
										customConfig="#{request.contextPath}/resources/js/ckEditor.js"
										value="#{requirementBean.requirement.description}"
										required="true" rendered="#{!loginBean.mobile}"
										requiredMessage="#{messages.specification_create_description_alert}" />
									<p:message for="description" rendered="#{!loginBean.mobile}" />
								</h:panelGroup>
							</h:panelGroup>
							<h:panelGroup layout="block" rendered="#{loginBean.mobile}"
								styleClass="Container100 Responsive100">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:inputTextarea id="descriptionMobile"
										value="#{requirementBean.requirement.description}"
										required="true" rendered="#{loginBean.mobile}"
										requiredMessage="#{messages.specification_create_description_alert}" />
									<p:message for="descriptionMobile"
										rendered="#{loginBean.mobile}" />
								</h:panelGroup>
							</h:panelGroup>
							<h:panelGroup layout="block"
								styleClass="Container100 Responsive100">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:inputTextarea id="note" rows="3" cols="100"
										placeholder="#{messages.specification_create_note_watermark}"
										value="#{requirementBean.requirement.note}" autoResize="false"
										style="resize: none;margin-left:auto; margin-right:auto;" />
								</h:panelGroup>
							</h:panelGroup>
							<h:panelGroup layout="block"
								styleClass="Container50 Responsive50 GrayBack">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:commandButton onstart="PF('blockUIWidget').block()"
										action="#{requirementBean.save(jJRequirementBean)}"
										oncomplete="PF('blockUIWidget').unblock()" update=":growlForm"
										value="#{messages.specification_create_save_button}" />
								</h:panelGroup>
							</h:panelGroup>
							<h:panelGroup layout="block"
								styleClass="Container50 Responsive50 GrayBack">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:commandButton title="#{messages.label_cancel}"
										value="#{messages.label_cancel}" styleClass="BoldGrayBack"
										action="/pages/specifications.jsf?faces-redirect=true" />
								</h:panelGroup>
							</h:panelGroup>
						</p:panel>
					</h:form>
				</h:panelGroup>
			</h:panelGroup>
			<h:panelGroup layout="block" styleClass="EmptyBox20" />
			<h:form>
				<p:panel styleClass="customPanel Container100 Responsive100"
					rendered="#{requirementBean.requirement != null}">
					<f:facet name="header">
						<h:outputText styleClass="Fs18"
							value="#{messages.specification_link_panel_header}" />
					</f:facet>

					<ui:repeat var="categorieRequirement"
						value="#{requirementBean.categorieRequirements}">
						<h:panelGroup layout="block"
							styleClass="#{requirementBean.containerType} MarAuto Responsive">
							<h:panelGroup layout="block" styleClass="ContainerIndent">
								<p:dataTable value="#{categorieRequirement.requirements}"
									var="req" paginatorPosition="bottom"
									styleClass="link-datatable" scrollable="true"
									scrollHeight="200"
									emptyMessage="#{messages.label_notRecordFound}">
									<f:facet name="header">
										<p:commandButton id="createButton" style="width: 100%;"
											icon="fa fa-plus-square Fs20" resetValues="true"
											actionListener="#{requirementBean.loadData(categorieRequirement)}"
											onstart="PF('blockUIWidget').block()" update=":linkForm"
											oncomplete="PF('blockUIWidget').unblock();PF('linkDialogWidget').show()" />
										#{loginBean.checkMessage(categorieRequirement.category)}									
								</f:facet>
									<p:column>
										<p:commandLink
											value="[#{req.id}]-#{fn:substring(req.name,0,25)}"
											action="#{jJRequirementBean.requirementInfo}" ajax="false">
											<f:setPropertyActionListener value="#{req}"
												target="#{jJRequirementBean.requirement}" />
										</p:commandLink>
									</p:column>
								</p:dataTable>
							</h:panelGroup>

						</h:panelGroup>
					</ui:repeat>
				</p:panel>
			</h:form>
			<h:panelGroup layout="block"
				rendered="#{requirementBean.requirement != null}"
				styleClass="Container50 MarAuto Responsive50">
				<h:panelGroup layout="block" styleClass="ContainerIndent">
					<p:dataTable id="taskDatalist" style="width: 100%;"
						emptyMessage="#{messages.label_notRecordFound}"
						value="#{requirementBean.requirementTasks}" var="task"
						scrollable="true" scrollHeight="160">
						<f:facet name="header">
							#{messages.label_task}
						</f:facet>
						<p:column headerText="#{messages.project_gantt_table_name_title}"
							width="70%">
							<h:outputText value="#{task.id}-#{fn:substring(task.name,0,30)}" />
						</p:column>
						<p:column
							headerText="#{messages.project_gantt_table_assigned_title}"
							width="30%">
							<h:outputText value="#{task.assignedTo}"
								converter="JJContactConverter" />
						</p:column>
					</p:dataTable>
				</h:panelGroup>
			</h:panelGroup>
			<h:panelGroup layout="block"
				rendered="#{requirementBean.requirement != null}"
				styleClass="Container50 MarAuto Responsive50">
				<h:panelGroup layout="block" styleClass="ContainerIndent">
					<h:form id="testCaseForm">
						<p:dataTable id="testCaseDataTable" var="testCaseModel"
							selection="#{requirementBean.reqSelectedtestCases}"
							rowKey="#{testCaseModel.id}" styleClass="testCaseDataTable"
							emptyMessage="#{messages.label_notRecordFound}" scrollable="true"
							scrollHeight="100" style="width: 100%;"
							value="#{requirementBean.reqtestCases}">
							<p:column selectionMode="multiple"
								style="width:30%;text-align:center;" />
							<p:column style="width:70%"
								headerText="#{messages.label_testcase}s">
								<h:outputText value="#{testCaseModel.name}" />
							</p:column>


							<f:facet name="footer">
								<p:commandButton onstart="PF('blockUIWidget').block()"
									oncomplete="PF('blockUIWidget').unblock()" id="update"
									disabled="#{empty requirementBean.reqtestCases}"
									update="testCaseDataTable :growlForm"
									value="#{messages.label_update}" process="testCaseDataTable"
									action="#{requirementBean.updateReqTestCases(jJTestcaseBean)}" />
								<h:panelGroup layout="block" styleClass="EmptyBox10" />
								<p:inputText id="testcase" style="width:50%;"
									placeholder="#{messages.label_name}"
									value="#{requirementBean.testCaseName}"
									label="#{messages.label_name}">
									<f:validateLength maximum="100" />
									<p:ajax event="keyup" update="addTestCase" />
								</p:inputText>
								<p:commandButton id="addTestCase"
									onstart="PF('blockUIWidget').block()"
									oncomplete="PF('blockUIWidget').unblock()"
									style="font-size: 1.0em !important;float:right;top: -3px;"
									update="@form :growlForm"
									disabled="#{empty requirementBean.testCaseName}"
									action="#{requirementBean.addTestCase(jJTestcaseBean)}"
									value="#{messages.test_new_addtest_label}" />
							</f:facet>
						</p:dataTable>
					</h:form>
				</h:panelGroup>
			</h:panelGroup>

			<h:panelGroup layout="block" styleClass="EmptyBox20" />

			<h:panelGroup id="container" layout="block"
				styleClass="Container100 MarAuto Responsive100"
				rendered="#{loginBean.enable and requirementBean.requirement != null}">
				<ui:include src="communication.xhtml">
					<ui:param name="communicationList"
						value="#{requirementBean.communicationMessages}" />
					<ui:param name="field" value="#{requirementBean.requirement}" />					
				</ui:include>
			</h:panelGroup>
		</h:panelGroup>
		<p:dialog id="requirementDialog" draggable="false" responsive="true"
			widgetVar="requirementDialogWidget" dynamic="true" resizable="false">
			<p:ajax event="close"
				listener="#{jJRequirementBean.closeDialog(false,false)}"
				onstart="PF('requirementBlockUIWidget').block()"
				oncomplete="PF('requirementBlockUIWidget').unblock();updateTree()" />
			<f:facet name="header">
				<p:outputLabel id="requirementDialogHeader"
					value="#{messages[jJRequirementBean.message]}" />
			</f:facet>
			<p:outputPanel id="requirementDialogPanel">
				<ui:include src="requirementDialog.xhtml" />
			</p:outputPanel>

		</p:dialog>

		<p:dialog id="linkDialog" draggable="false" appendTo="@(body)" responsive="true"
			header="#{messages.requirement_dialog_linkHeader}" modal="true"
			widgetVar="linkDialogWidget" dynamic="true" resizable="false">
			<p:ajax event="close" update=":linkForm"
				onstart="PF('blockUIWidget').block()"
				oncomplete="PF('blockUIWidget').unblock()"
				listener="#{requirementBean.closeLinkDialog}" />
			<p:outputPanel>
				<pe:blockUI widgetVar="requirementBlockUIWidget"
					target="requirementDialogPanel">
					<h:panelGrid columns="2">
						<p:graphicImage name="images/preloader.gif" library="rioLayout"
							style="vertical-align: middle;" />
						<h:outputText value="#{messages.label_refresh}"
							style="white-space: nowrap;" />
					</h:panelGrid>
				</pe:blockUI>
				<h:form id="linkForm">
					<p:dataTable id="linkDataTable" var="req"
						selection="#{requirementBean.linkReq}" rowKey="#{req.id}"
						emptyMessage="#{messages.label_notRecordFound}" scrollable="true"
						style="width:350px;" scrollHeight="200"
						value="#{requirementBean.linkReqList}">
						<p:column selectionMode="multiple"
							style="width:20%;text-align:center" />
						<p:column style="width:80%"
							headerText="#{messages.label_requirement}">
							<h:outputText value="#{req.id}-#{req.name}" />
						</p:column>
						<f:facet name="footer">
							<p:commandButton value="#{messages.label_update}"
								action="#{requirementBean.updateRequirementLinks(jJRequirementBean)}"
								onstart="PF('requirementBlockUIWidget').block()"
								oncomplete="PF('requirementBlockUIWidget').unblock()"
								disabled="#{empty requirementBean.linkReqList}" />
							<br />
						</f:facet>
					</p:dataTable>
				</h:form>
			</p:outputPanel>
		</p:dialog>


		<p:dialog id="chapterDialog" draggable="false" appendTo="@(body)" responsive="true"
			header="#{messages.specification_chapter_header}" modal="true"
			widgetVar="chapterDialogWidget" dynamic="true" resizable="false">
			<p:ajax event="close" update=":treeForm"
				onstart="PF('blockUIWidget').block()"
				oncomplete="PF('blockUIWidget').unblock();"
				listener="#{jJChapterBean.closeDialog}" />
			<p:outputPanel id="chapterDialogPanel">
				<ui:include src="chapterDialog.xhtml" />
			</p:outputPanel>
		</p:dialog>
	</ui:define>
</ui:composition>
</html>