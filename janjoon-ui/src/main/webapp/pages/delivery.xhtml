<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<ui:composition template="../templates/template.xhtml">
	<ui:define name="content">
		<style type="text/css">
.ui-datatable .ui-row-toggler {
	float: left;
}
</style>
		<h:form style="width:100%;display:none;">
			<p:remoteCommand onstart="PF('blockUIWidget').block()"
				name="tabChangeHelper" update=":versionTabView:deliveryForm"
				oncomplete="PF('blockUIWidget').unblock()" />
		</h:form>
		<p:tabView id="versionTabView" widgetVar="versionTab"
			style="width: 1400px;" dynamic="true" cache="false"
			onTabChange="tabChangeHelper([{name: 'activeScrumIndex', value: index}])"
			scrollable="#{jJVersionBean.scrollable}"
			value="#{jJVersionBean.versionDataModelList}" var="versionDataModel">
			<p:tab>

				<f:facet name="title">
					<h:outputText rendered="#{versionDataModel.version != null}"
						value="#{versionDataModel.version.product.name}/#{versionDataModel.version.name}" />
					<h:outputText rendered="#{versionDataModel.version == null}"
						value="No Version" />
				</f:facet>

				<h:form id="deliveryForm">
					<h:panelGrid columns="3" style="margin-top: 10px;"
						columnClasses="twentyFivePercent,thirtyPercent" border="0">
						<!-- 						<c:forEach items="#{jJBuildBean.buildDataModelList}" -->
						<!-- 							var="buildDataModel" varStatus="loop"> -->

						<!-- 							<p:fieldset -->
						<!-- 								legend="#{buildDataModel.version.product.name}/#{buildDataModel.version.name}" -->
						<!-- 								id="buildFieldSet"> -->
						<p:dataTable id="buildDataTable" scrollable="true"
							scrollHeight="250" var="build" value="#{versionDataModel.builds}"
							rowKey="#{build.id}"
							rendered="#{versionDataModel.version != null}"
							emptyMessage="#{messages.label_notRecordFound}">
							<!-- 							<p:column headerText="Project"> -->
							<!-- 								<h:outputText value="#{build.name}" /> -->
							<!-- 							</p:column> -->
							<f:facet name="header">
										ChangeLog
									</f:facet>
							<p:ajax event="rowToggle" listener="#{jJBuildBean.rowToggle}"
								update="buildDataTable"
								onstart="updateRowExapansion();PF('blockUIWidget').block()"
								oncomplete="PF('blockUIWidget').unblock()" />
							<p:column style="width:20%;">
								<p:rowToggler />
								<p:commandLink target="_blank" style="float: right;"
									action="#{jJBuildBean.getZipFile(build)}" ajax="false"
									disabled="#{jJBuildBean.haveUrl(build)}" title="Download">
									<p:graphicImage name="download.ico" library="images" width="14"
										height="14" />
								</p:commandLink>
							</p:column>
							<p:column headerText="Build">
								<h:outputText value="#{build.name}" />
							</p:column>
							<p:column headerText="Status">
								<p:autoComplete id="status" dropdown="true"
									value="#{build.status}"
									itemLabel="#{loginBean.checkMessage(status)}"
									itemValue="#{status}" var="status" size="10"
									converter="com.starit.janjoonweb.ui.mb.converter.JJStatusConverter"
									completeMethod="#{jJBuildBean.completeStatus}">
									<p:ajax event="itemSelect"
										onstart="PF('blockUIWidget').block()"
										oncomplete="PF('blockUIWidget').unblock()"
										listener="#{jJBuildBean.changeEvent(build,versionDataModel)}"
										update="buildDataTable :growlForm" />
								</p:autoComplete>
							</p:column>
							<p:rowExpansion styleClass="rowExpansion">
								<!-- 									<f:event type="preRenderComponent" update="versionDataTable" -->
								<!-- 										onstart="PF('versionBlockUIWidget').block()" -->
								<!-- 										oncomplete="PF('versionBlockUIWidget').unblock()" -->
								<!-- 										listener="#{jJBuildBean.loadingRowExpansion(versionModel.version)}" /> -->

								<p:dataTable id="taskDataTable" var="task" style="width:90%;"
									rowKey="#{task.id}"
									emptyMessage="#{messages.label_notRecordFound}"
									value="#{build.tasks}">

									<p:column style="width:25%">
										<f:facet name="header">
											<p:row>
												<p:column>
													<h:outputText value="#{messages.label_task} Id" />
												</p:column>
											</p:row>
										</f:facet>
										<h:outputText value="#{task.id}" />
									</p:column>

									<p:column style="width:75%">
										<f:facet name="header">
											<p:row>
												<p:column>
													<h:outputText value="#{messages.label_task}:" />
												</p:column>
											</p:row>
										</f:facet>
										<!-- 										<p:graphicImage -->
										<!-- 											rendered="#{task.specification != null and task.specification}" -->
										<!-- 											library="images" name="doc.ico" width="16" height="16" /> -->
										<p:graphicImage
											rendered="#{task.taskType.name == 'specifier'}"
											library="images" name="doc.ico" width="16" height="16" />
										<p:graphicImage rendered="#{task.bug != null}"
											library="images" name="bug.ico" width="16" height="16" />
										<p:graphicImage
											rendered="#{task.bug == null and task.requirement != null}"
											library="images" name="function.ico" width="16" height="16" />
										<p:graphicImage title="TestCase"
											rendered="#{task.bug == null and task.requirement == null and task.testcase != null}"
											library="images" name="test.ico" width="16" height="16" />
										<h:outputText value="#{task.name}" />
									</p:column>
								</p:dataTable>
							</p:rowExpansion>
						</p:dataTable>
						<!-- 							</p:fieldset> -->
						<!-- 						</c:forEach> -->

						<p:dataTable id="specTable"
							value="#{versionDataModel.requirementRoadMap}" rowKey="#{req.id}"
							var="req" widgetVar="specTable" scrollable="true"
							scrollHeight="250"
							emptyMessage="#{messages.label_notRecordFound}">
							<f:facet name="header">
										#{messages.label_requirement} RoadMap
									</f:facet>
							<p:column id="reqName" headerText="#{messages.label_requirement}">
								<p:commandLink target="_blank" value="#{req.name}"
									action="#{jJRequirementBean.requirementInfo}" ajax="false">
									<f:setPropertyActionListener value="#{req}"
										target="#{jJRequirementBean.requirement}" />
								</p:commandLink>
							</p:column>

							<p:column id="reqCategory"
								headerText="#{messages.label_category}">
								<h:outputText value="#{req.category}"
									converter="JJCategoryConverter" />
							</p:column>

							<p:column id="reqStatus" headerText="Status">
								<h:outputText
									value="#{loginBean.checkMessage(req.status)}" />
							</p:column>
						</p:dataTable>
						<p:dataTable id="bugTable" value="#{versionDataModel.bugRoadMap}"
							rowKey="#{bug.id}" var="bug" widgetVar="bugTable"
							scrollable="true" scrollHeight="250"
							emptyMessage="#{messages.label_notRecordFound}">
							<f:facet name="header">
										Bug RoadMap
									</f:facet>
							<p:column id="bugName"
								headerText="#{messages.bug_table_title_title}" width="35%">
								<p:commandLink target="_blank" value="#{bug.name}"
									action="#{jJBugBean.bugInfo}" ajax="false">
									<f:setPropertyActionListener value="#{bug}"
										target="#{jJBugBean.viewBug}" />
								</p:commandLink>
							</p:column>
							<p:column id="bugDate"
								headerText="#{messages.bug_table_creation_title}" width="35%">
								<h:outputText value="#{bug.creationDate}">
									<f:convertDateTime type="date" locale="#{localeBean.locale}"
										pattern="dd/MM/yyyy HH:mm" />
								</h:outputText>
							</p:column>
							<p:column id="bugImportance"
								headerText="#{messages.bug_table_importance_title}" width="15%">
								<h:outputText value="#{bug.importance.name}" />
							</p:column>
							<p:column id="bugStatus"
								headerText="#{messages.bug_table_status_title}" width="15%">
								<h:outputText
									value="#{loginBean.checkMessage(bug.status)}"
									styleClass="#{bug.status.name}" />
							</p:column>
						</p:dataTable>
					</h:panelGrid>
				</h:form>
			</p:tab>
		</p:tabView>

		<p:hotkey bind="esc" handler="PF('videoHelpWidget').hide()" />
		<p:dialog id="videoHelpDialog" widgetVar="videoHelpWidget" responsive="true"
			position="center" header="#{messages.specification_video_help_title}"
			style="padding:0px;" resizable="false" draggable="false"
			minHeight="500" minWidth="500" showEffect="fade" hideEffect="fade">
			<video width="100%" height="100%" controls="true">
				<source src="https://www.starit.fr/jjtraining.mp4" type="video/mp4" />
			</video>
		</p:dialog>
	</ui:define>
</ui:composition>
</html>