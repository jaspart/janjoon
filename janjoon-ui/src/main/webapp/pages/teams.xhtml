<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<ui:composition template="../templates/layout.xhtml">
	<ui:define name="content">
		<h:form style="width:100%;display:none;">
			<p:remoteCommand onstart="PF('blockUIWidget').block()"
				name="tabChangeHelper" update=":teamTabView"
				actionListener="#{jJTaskBean.onTabTeamChange}"
				oncomplete="PF('blockUIWidget').unblock()" />
		</h:form>
		<p:tabView id="teamTabView" widgetVar="teamTabView"
			activeIndex="#{jJTaskBean.activeTabTeamIndex}"
			onTabChange="tabChangeHelper([{name: 'activeTeamIndex', value: index}])">
			<p:tab title="Imputation Schedule">
				<h:form id="imputationForm">
					<p:schedule value="#{jJTaskBean.lazyEventModel}" draggable="true"
						clientTimeZone="local" locale="#{localBean.locale}" tooltip="true"
						resizable="true" initialDate="#{jJTaskBean.scheduleInitialDate}"
						view="#{jJTaskBean.scheduleInitialView}" timeFormat="HH:mm">
						<p:ajax event="eventSelect" listener="#{jJTaskBean.onEventSelect}"
							update=":viewTaskForm :viewTaskDialog" immediate="true"
							resetValues="true" onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()" />
						<p:ajax event="viewChange" listener="#{jJTaskBean.onViewChange}"
							onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()" />
						<p:ajax event="eventMove" listener="#{jJTaskBean.onEventMove}"
							onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()" update=":growlForm" />
						<p:ajax event="eventResize" listener="#{jJTaskBean.onEventResize}"
							onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()" update=":growlForm" />
					</p:schedule>
				</h:form>
			</p:tab>
			<p:tab title="Team Imputation Schedule"
				rendered="#{loginBean.authorisationService.viewTeamImputation}">
				<h:form id="teamImputationForm">
					<p:schedule value="#{jJTaskBean.lazyEventModelAll}"
						draggable="true" clientTimeZone="local" tooltip="true"
						locale="#{localBean.locale}" resizable="true"
						initialDate="#{jJTaskBean.scheduleInitialDateAll}"
						view="#{jJTaskBean.scheduleInitialViewAll}" timeFormat="HH:mm">
						<p:ajax event="eventSelect"
							listener="#{jJTaskBean.onEventSelectAll}"
							update=":viewTaskForm :viewTaskDialog" immediate="true"
							resetValues="true" onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()" />
						<p:ajax event="viewChange"
							listener="#{jJTaskBean.onViewChangeAll}"
							onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()" />
						<p:ajax event="eventMove" listener="#{jJTaskBean.onEventMove}"
							onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()"
							update=":growlForm :teamTabView" />
						<p:ajax event="eventResize" listener="#{jJTaskBean.onEventResize}"
							onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()"
							update=":growlForm :teamTabView" />
					</p:schedule>
				</h:form>
			</p:tab>
		</p:tabView>

		<p:dialog id="viewTaskDialog"
			header="#{messages.label_view} #{jJTaskBean.getDialogHeader(jJTaskBean.task,null)}"
			modal="true" widgetVar="viewTaskDialogWidget" dynamic="true"
			resizable="true" maximizable="true" showEffect="fade"
			hideEffect="explode" draggable="false">
			<p:ajax event="close" update=":teamTabView"
				listener="#{jJTaskBean.closeEvent('team')}" />
			<p:outputPanel id="viewTaskPanel">
				<h:form id="viewTaskForm" enctype="multipart/form-data">
					<p:remoteCommand name="updateForm" update=":viewTaskForm" />

					<p:panel styleClass="panelDialog">
						<f:facet name="header">
							<p:messages id="msg" closable="true" />
						</f:facet>
						<ui:include src="taskDialog.xhtml">
							<ui:param name="JJTask_" value="#{jJTaskBean.task}" />
						</ui:include>
						<f:facet name="footer">
							<p:commandButton id="updateTaskButton" update=":viewTaskForm"
								actionListener="#{jJTaskBean.updateTask('main')}"
								value="#{messages.label_update}"
								onstart="PF('viewtaskBlockUIWidget').block()"
								style="margin-top: 5px;"
								oncomplete="PF('viewtaskBlockUIWidget').unblock();"
								process="@this,taskSprint,taskStatus,taskStartDatePlanned,taskEndDatePlanned,taskWorkload,taskAssignedTo,taskSpec" />
							<p:commandButton id="viewCloseButton"
								value="#{messages.label_close}"
								style="margin-left: 20px;margin-top: 5px;"
								oncomplete="PF('blockUIWidget').unblock()"
								onstart="PF('blockUIWidget').block()"
								onclick="PF('viewTaskDialogWidget').hide()" type="button" />
						</f:facet>
					</p:panel>
				</h:form>
			</p:outputPanel>
		</p:dialog>

	</ui:define>
</ui:composition>
</html>