<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<ui:composition template="../templates/template.xhtml">
	<ui:define name="content">
		<h:form style="width:100%;display:none;">
			<p:remoteCommand name="tabChangeHelper" update=":teamTabView"
				actionListener="#{jJTaskBean.onTabTeamChange}" />
		</h:form>
		<p:tabView id="teamTabView" widgetVar="teamTabView"
			activeIndex="#{jJTaskBean.activeTabTeamIndex}"
			onTabChange="tabChangeHelper([{name: 'activeTeamIndex', value: index}])">
			<p:tab title="Imputation Schedule">
				<h:form id="imputationForm">
					<p:schedule value="#{jJTaskBean.lazyEventModel}" draggable="true"
						clientTimeZone="local" locale="#{localBean.locale}" tooltip="true"
						resizable="true" initialDate="#{jJTaskBean.scheduleInitialDate}"
						view="#{jJTaskBean.scheduleInitialView}" timeFormat="HH:mm">
						<p:ajax event="eventSelect" listener="#{jJTaskBean.onEventSelect}"
							update=":viewTaskForm :viewTaskDialogHeader" immediate="true"
							resetValues="true" />
						<p:ajax event="viewChange" listener="#{jJTaskBean.onViewChange}" />
						<p:ajax event="eventMove" listener="#{jJTaskBean.onEventMove}"
							update=":growlForm" />
						<p:ajax event="eventResize" listener="#{jJTaskBean.onEventResize}"
							update=":growlForm" />
					</p:schedule>
				</h:form>
			</p:tab>
			<p:tab title="Team Imputation Schedule"
				rendered="#{loginBean.authorisationService.viewTeamImputation}">
				<h:form id="teamImputationForm">
					<p:schedule value="#{jJTaskBean.lazyEventModelAll}"
						draggable="true" clientTimeZone="local" tooltip="true"
						locale="#{localBean.locale}" resizable="true"
						initialDate="#{jJTaskBean.scheduleInitialDateAll}"
						view="#{jJTaskBean.scheduleInitialViewAll}" timeFormat="HH:mm">
						<p:ajax event="eventSelect"
							listener="#{jJTaskBean.onEventSelectAll}"
							update=":viewTaskForm :viewTaskDialogHeader" immediate="true"
							resetValues="true" />
						<p:ajax event="viewChange"
							listener="#{jJTaskBean.onViewChangeAll}" />
						<p:ajax event="eventMove" listener="#{jJTaskBean.onEventMove}"
							update=":growlForm :teamTabView" />
						<p:ajax event="eventResize" listener="#{jJTaskBean.onEventResize}"
							update=":growlForm :teamTabView" />
					</p:schedule>
				</h:form>
			</p:tab>
		</p:tabView>

		<p:dialog id="viewTaskDialog" responsive="true" modal="true"
			widgetVar="viewTaskDialogWidget" dynamic="true" resizable="false"
			maximizable="false" showEffect="fade" draggable="false">
			<p:ajax event="close" update=":teamTabView"
				listener="#{jJTaskBean.closeEvent('team')}" />
			<f:facet name="header">
				<p:outputLabel id="viewTaskDialogHeader"
					value="#{messages.label_view} #{jJTaskBean.getDialogHeader(jJTaskBean.task,null)}" />
			</f:facet>
			<p:outputPanel id="viewTaskPanel">
				<h:form id="viewTaskForm" enctype="multipart/form-data">
					<p:remoteCommand name="updateForm" update=":viewTaskForm" />
					<ui:include src="taskDialog.xhtml">
						<ui:param name="JJTask_" value="#{jJTaskBean.task}" />
						<ui:param name="View" value="main" />
					</ui:include>
				</h:form>
			</p:outputPanel>
		</p:dialog>

	</ui:define>
</ui:composition>
</html>