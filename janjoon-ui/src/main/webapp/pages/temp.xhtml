<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/layout.xhtml">
	<ui:define name="content">
		<p:layout styleClass="content" style="min-height:500px;"
			stateful="true">
			<f:event type="preRenderComponent"
				listener="#{jJTestcaseBean.loadData()}" />

			<p:layoutUnit position="west"
				style="min-width:200px;min-height:500px;" resizable="true">
				<h:form id="testFormWest">
					<p:panelGrid style="margin-top:10px">
						<p:row>
							<p:column>
								<h:outputText for="build" value="Build:" />
								<p:selectOneMenu id="build" value="#{jJBuildBean.build}"
									panelStyle="width:150px" effect="fade" style="width:150px"
									filter="true" filterMatchMode="startsWith">
									<f:converter
										converterId="com.starit.janjoonweb.ui.mb.converter.JJBuildConverter" />
									<f:selectItem itemValue="#{null}" itemLabel="-- Select One --" />
									<f:selectItems value="#{jJBuildBean.buildList}" var="c"
										itemLabel="#{c.name}" itemValue="#{c}" />
									<p:ajax process="@this" partialSubmit="true"
										update=":testFormCenter" />
								</p:selectOneMenu>
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<p:tree id="testCaseTree" value="#{jJTestcaseBean.rootNode}"
									var="node" selectionMode="single"
									selection="#{jJTestcaseBean.selectedNode}" dynamic="true">
									<p:ajax event="select"
										listener="#{jJTestcaseBean.onNodeSelect}"
										update=":testFormCenter" />
									<p:treeNode>
										<h:outputText value="#{node}" />
									</p:treeNode>
								</p:tree>
							</p:column>
						</p:row>
					</p:panelGrid>
				</h:form>
			</p:layoutUnit>
			<p:layoutUnit position="center" resizable="true"
				style="min-height:500px;">
				<h:form id="testFormCenter">
					<p:dataTable id="testcaseRecapDataTable" var="testcaseRecap"
						value="#{jJTestcaseBean.testCaseRecaps}" paginator="true"
						rows="15" style="width:550px"
						rowKey="#{testcaseRecap.testcase.id}"
						rendered="#{jJTestcaseBean.rendredTestCaseRecaps}">
						<f:facet name="header">
							<p:row>
								<p:column colspan="3">
									<h:outputText value="#{jJTestcaseBean.chapter.name}" />
								</p:column>
							</p:row>
						</f:facet>
						<p:column>
							<f:facet name="header">
								<h:outputText value="Testcase" />
							</f:facet>
							<h:outputText value="#{testcaseRecap.testcase.name}" />
						</p:column>
						<p:column>
							<f:facet name="header">
								<h:outputText value="Status" />
							</f:facet>
							<h:outputText value="#{testcaseRecap.status}" />
						</p:column>

						<p:column styleClass="action-column">
							<f:facet name="header">
								<h:outputText value="Actions" />
							</f:facet>
							<p:commandButton id="runButton" icon="ui-icon-pencil"
								disabled="#{testcaseRecap.rendered}">
								<!-- 								<f:setPropertyActionListener value="#{contact}" -->
								<!-- 									target="#{jJContactBean.contactAdmin}" /> -->
							</p:commandButton>
							<p:tooltip for="runButton"
								value="Run #{testcaseRecap.testcase.name}" showEffect="fade"
								hideEffect="fade" />
						</p:column>
						<f:facet name="footer">
							<p:commandButton value="New testcase" id="newTestcase"
								actionListener="#{jJTestcaseBean.newTestcase(jJTeststepBean)}"
								update=":testcaseDialog"
								oncomplete="testcaseDialogWidget.show()"
								icon="ui-icon-circle-plus" />
						</f:facet>
					</p:dataTable>
				</h:form>
			</p:layoutUnit>
		</p:layout>

		<p:dialog id="testcaseDialog" header="#{jJTestcaseBean.message}"
			modal="true" widgetVar="testcaseDialogWidget" dynamic="true"
			resizable="false">
			<p:ajax event="close" update=":testFormCenter :testFormWest"
				listener="#{jJTestcaseBean.closeDialog(jJTeststepBean)}" />
			<p:outputPanel id="testcaseDialogPanel">
				<h:form id="testcaseDialogForm">
					<p:growl id="msg" />
					<p:panel style="margin-top:10px">
						<p:row>
							<p:column>
								<p:panelGrid style="margin-top:10px">
									<p:row>
										<p:column>
											<p:inputText id="name"
												value="#{jJTestcaseBean.testcase.name}" required="true"
												widgetVar="nameWidget" label="Testcase Name"
												requiredMessage="Testcase Name is a required value"
												disabled="#{jJTestcaseBean.disabled}">
											</p:inputText>
											<p:watermark for="name" value="Name *" />
											<p:message for="name" id="msgName" />
										</p:column>
										<p:column>
											<h:outputText for="requirement" value="Requirement: *" />
											<p:selectOneMenu id="requirement"
												disabled="#{jJTestcaseBean.disabled}"
												value="#{jJTestcaseBean.requirement}"
												panelStyle="width:150px" effect="fade" style="width:150px"
												filter="true" required="true" filterMatchMode="startsWith"
												widgetVar="requirementWidget"
												requiredMessage="Testcase Requirement is a required value">
												<f:converter
													converterId="com.starit.janjoonweb.ui.mb.converter.JJRequirementConverter" />
												<f:selectItem value="#{jJTestcaseBean.requirement}" var="c"
													itemLabel="#{c.name}" itemValue="#{c}" />
												<f:selectItems value="#{jJTestcaseBean.requirements}"
													var="c" itemLabel="#{c.name}" itemValue="#{c}" />
											</p:selectOneMenu>
											<p:message for="requirement" id="msgRequirement" />
										</p:column>
									</p:row>
									<p:row>
										<p:column colspan="2">
											<h:outputText value="Description : *" />
											<p:editor id="description" widgetVar="descriptionWidget"
												style="width:680px" disabled="#{jJTestcaseBean.disabled}"
												value="#{jJTestcaseBean.testcase.description}"
												required="true"
												requiredMessage="Testcase Description is a required value" />
											<p:message for="description" id="msgDescription" />
										</p:column>
									</p:row>

									<p:row>
										<p:column colspan="2">
											<p:commandButton value="Save" id="saveTestcase"
												disabled="#{jJTestcaseBean.disabled}"
												actionListener="#{jJTestcaseBean.save(jJTeststepBean)}"
												process="@widgetVar(nameWidget) @widgetVar(requirementWidget) @widgetVar(descriptionWidget)"
												update="testcaseDialogForm" icon="ui-icon-circle-plus" />
										</p:column>
									</p:row>
									<p:row>
										<p:column>
											<p:inputText id="action"
												value="#{jJTeststepBean.teststep.action}"
												label="Teststep Action" required="true"
												requiredMessage="Teststep Action is a required value"
												maxlength="100" widgetVar="actionWidget">
											</p:inputText>
											<p:message for="action" id="msgAction" />
											<p:watermark for="action" value="Action: *" />

										</p:column>
										<p:column>
											<p:inputText id="resultat"
												value="#{jJTeststepBean.teststep.resultat}"
												label="Teststep Resultat" required="true"
												requiredMessage="Teststep Resultat is a required value"
												maxlength="100" widgetVar="resultatWidget">
											</p:inputText>
											<p:message for="resultat" id="msgResultat" />
											<p:watermark for="resultat" value="Resultat *" />
										</p:column>

										<p:column>
											<p:commandButton id="saveTestStep" value="New Teststep"
												icon="ui-icon-circle-plus" update="action resultat"
												process="@widgetVar(actionWidget) @widgetVar(resultatWidget)" />
										</p:column>

									</p:row>
								</p:panelGrid>
							</p:column>
						</p:row>

						<f:facet name="footer">
							<p:row>
								<p:column colspan="3">
									<p:commandButton id="resetButton" value="Reset"
										update="testcaseDialogForm" process="@none"
										action="#{jJTestcaseBean.newTestcase(jJTeststepBean)}" />
								</p:column>
							</p:row>
						</f:facet>
					</p:panel>
				</h:form>
			</p:outputPanel>
		</p:dialog>

	</ui:define>
</ui:composition>
</html>