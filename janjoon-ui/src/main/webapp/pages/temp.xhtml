<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="../templates/layout.xhtml">

	<ui:define name="content">
		<h:form id="specForm">
			<f:event type="preRenderComponent"
				listener="#{jJRequirementBean.load(jJProjectBean,jJProductBean,jJVersionBean,jJChapterBean)}" />
			<table>
				<tr>
					<ui:repeat value="#{jJRequirementBean.categoryList}" var="button">
						<p:commandButton id="input#{button.name}" value="#{button.name}"
							actionListener="#{jJRequirementBean.updateTemplate(button.id)}"
							update=":specForm" />
					</ui:repeat>
				</tr>
				<tr />
				<tr>
					<td><h:outputLabel for="template" value="Template: " /> <h:outputText
							id="template" value="#{jJRequirementBean.outputTemplateHeader}" /></td>
				</tr>
				<tr />
				<tr>
					<ui:repeat value="#{jJRequirementBean.tableDataModelList}"
						var="tableDataModel">
						<td><p:dataTable id="input#{tableDataModel.idDataModel}"
								selectionMode="single" var="requirement"
								value="#{tableDataModel}" paginator="true" rows="10"
								selection="#{jJRequirementBean.selectedRequirement}"
								style="width:410px">
								<f:facet name="header">  
          							#{tableDataModel.idDataModel}
          							<p:panelGrid>
										<f:facet name="header">
											<p:row>
												<p:column colspan="1">
													<p:commandButton id="manageChapterButton"
														icon="ui-icon-document"
														title="Manage Chapter and Document"
														disabled="#{tableDataModel.disabled}"
														actionListener="#{jJChapterBean.initChapterBean(tableDataModel.categoryId)}"
														update=":chapterDialogForm"
														oncomplete="chapterDialogWidget.show()" />
												</p:column>
												<p:column colspan="1">
													<p:commandButton id="releaseRequirementButton"
														icon=".ui-icon-carat-2-n-s"
														title="Release All Requirements"
														disabled="#{tableDataModel.disabled}" />
												</p:column>
												<p:column colspan="4">
													<p:inputText id="globalFilter" style="width:120px"
														disabled="#{tableDataModel.disabled}" />
												</p:column>
												<p:column colspan="1">
													<p:commandButton id="newRequirementButton"
														icon="ui-icon-plus" title="New Requirement"
														disabled="#{tableDataModel.disabled}"
														actionListener="#{jJRequirementBean.newRequirement(tableDataModel.categoryId)}"
														update=":requirementDialog"
														oncomplete="requirementDialogWidget.show()" />
												</p:column>
												<p:column colspan="1">
													<p:commandButton id="exportButton" icon="ui-icon-clipboard"
														type="button" ajax="false"
														disabled="#{tableDataModel.disabled}" />
													<p:menu overlay="true" trigger="exportButton" my="left top"
														at="left bottom">
														<p:menuitem>
															<h:commandLink id="pdf">
																<p:graphicImage value="/resources/images/pdf.png" />
																<h:outputLabel for="pdf" value="export in pdf" />
																<p:dataExporter type="pdf"
																	target="input#{tableDataModel.idDataModel}"
																	fileName="requirements"
																	preProcessor="#{jJChapterBean.preProcessPDF}" />
															</h:commandLink>
														</p:menuitem>
													</p:menu>
												</p:column>
											</p:row>
										</f:facet>
									</p:panelGrid>
								</f:facet>

								<p:column headerText="Name" style="width:25%">  
            						#{requirement.name}  
        						</p:column>

								<p:column headerText="Project" style="width:25%">  
            						#{requirement.name}  
        						</p:column>

								<p:column headerText="Chapter" style="width:25%">  
            						#{requirement.name}  
        						</p:column>
							</p:dataTable></td>
					</ui:repeat>
				</tr>
			</table>
		</h:form>

		<p:dialog id="requirementDialog" header="#{jJRequirementBean.message}"
			modal="true" widgetVar="requirementDialogWidget" maximizable="false"
			minimizable="false" dynamic="true" resizable="false">
			<p:ajax event="close" update=":specForm"
				listener="#{jJRequirementBean.closeDialog}" />
			<p:outputPanel id="requirementDialogPanel">
				<h:form id="requirementDialogForm">
					<p:growl id="msg" />
				</h:form>
			</p:outputPanel>
		</p:dialog>




		<p:dialog id="chapterDialog" header="Chapter" modal="true"
			widgetVar="chapterDialogWidget" maximizable="false"
			minimizable="false" dynamic="true" resizable="false">
			<p:ajax event="close" update=":specForm"
				listener="#{jJChapterBean.closeDialog}" />
			<p:outputPanel id="chapterDialogPanel">
				<h:form id="chapterDialogForm">
					<p:growl id="msg" />
					<p:panelGrid style="margin-top:10px">
						<p:row>
							<p:column colspan="2">
								<p:inputText id="name" value="#{jJChapterBean.chapter.name}"
									required="true" widgetVar="nameWidget" label="Chapter Name"
									requiredMessage="Chapter Name is a required value">
								</p:inputText>
								<p:message for="name" id="msgName" />
								<p:watermark for="name" value="Name *" />
							</p:column>
							<p:column colspan="2">
								<h:outputText for="parent" value="Parent Chapter:" />
								<p:selectOneMenu id="parent"
									value="#{jJChapterBean.parentChapter}" panelStyle="width:150px"
									effect="fade" style="width:160px" filter="true"
									filterMatchMode="startsWith">
									<f:converter
										converterId="com.funder.janjoonweb.ui.mb.converter.JJChapterConverter" />
									<f:selectItem itemLabel="#{jJChapterBean.parentChapter.name}"
										itemValue="#{jJChapterBean.parentChapter}" />
									<f:selectItems value="#{jJChapterBean.chapterList}" var="c"
										itemLabel="#{c.name}" itemValue="#{c}" />
									<p:ajax process="@this" partialSubmit="true"
										listener="#{jJChapterBean.handleSelectParentChapter()}" />
								</p:selectOneMenu>
							</p:column>
						</p:row>
						<p:row>
							<p:column colspan="2">
								<h:outputText value="Description : *" />
								<p:editor id="description" widgetVar="descriptionWidget"
									style="width:388px"
									value="#{jJChapterBean.chapter.description}" required="true"
									requiredMessage="Chapter Description is a required value">
								</p:editor>
							</p:column>
							<p:column colspan="2">
								<p:contextMenu for="chapterTreeSingle">
									<p:menuitem value="Edit"
										actionListener="#{jJChapterBean.editChapter()}"
										process="@this" icon="ui-icon-pencil"
										update="chapterDialogForm" />
									<p:menuitem value="Delete"
										actionListener="#{jJChapterBean.deleteChapter()}"
										process="@this" icon="ui-icon-close"
										update="chapterDialogForm" />
								</p:contextMenu>
								<h:outputText value="Chapters Tree" />
								<p:tree id="chapterTreeSingle"
									value="#{jJChapterBean.chapterRoot}" var="nodeChapter"
									selectionMode="single"
									selection="#{jJChapterBean.selectedChapterNode}" dynamic="true"
									cache="false">
									<p:ajax event="select" listener="#{jJChapterBean.onNodeSelect}" />
									<p:treeNode>
										<h:outputText value="#{nodeChapter}" />
									</p:treeNode>
								</p:tree>
							</p:column>
						</p:row>

						<f:facet name="footer">
							<p:row>
								<p:column colspan="3">
									<p:commandButton value="Save" action="#{jJChapterBean.save()}"
										process="@form" update="chapterDialogForm" />
								</p:column>
							</p:row>
						</f:facet>
					</p:panelGrid>
					<p:panelGrid>
						<p:row>
							<p:column colspan="3">
								<p:tree id="leftTreeIncorporated"
									value="#{jJChapterBean.leftRoot}" var="nodeLeft"
									selectionMode="single"
									selection="#{jJChapterBean.selectedLeftNode}" draggable="true"
									droppable="true" dragdropScope="demo" cache="false">
									<p:ajax event="dragdrop" listener="#{jJChapterBean.onDragDrop}"
										update=":chapterDialogForm" />
									<p:treeNode>
										<h:outputText value="#{nodeLeft}" />
									</p:treeNode>
								</p:tree>
							</p:column>
							<p:column colspan="3">
								<p:graphicImage alt="Transfer" library="images"
									name="transfer.png" />
							</p:column>
							<p:column colspan="3">
								<p:tree id="RightTreeIncorporated"
									value="#{jJChapterBean.rightRoot}" var="nodeRight"
									selectionMode="single"
									selection="#{jJChapterBean.selectedRightNode}" draggable="true"
									droppable="true" dragdropScope="demo" cache="false">
									<p:ajax event="dragdrop" listener="#{jJChapterBean.onDragDrop}"
										update=":chapterDialogForm" />
									<p:treeNode>
										<h:outputText value="#{nodeRight}" />
									</p:treeNode>
								</p:tree>
							</p:column>
						</p:row>
					</p:panelGrid>

				</h:form>
			</p:outputPanel>
		</p:dialog>
	</ui:define>
</ui:composition>
</html>