<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">
<ui:composition>
	<h:form id="productForm">
		<h:panelGroup layout="block" styleClass="Container ui-fluid">
			<h:panelGroup layout="block" styleClass="Container60 Responsive100">
				<p:dataTable id="productDataTable" var="product" lazy="true"
					widgetVar="productDataTableWV" sortMode="multiple"
					value="#{jJProductBean.productListTable}" paginator="true"
					rows="15" rowKey="#{product.id}" paginatorPosition="bottom"
					emptyMessage="#{messages.label_notRecordFound}">
					<f:facet name="header">
						<h:panelGroup layout="block" styleClass="Container">
							<h:panelGroup layout="block" style="float: right !important;"
								styleClass="Container40 Responsive100 Fs20">
								<h:outputText style="font-family: 'roboto_condensedlight';"
									value="#{messages.admin_product_table_title}" />
							</h:panelGroup>
							<h:panelGroup layout="block"
								styleClass="Container60 Responsive100">
								<p:inputText id="globalFilter"
									onkeyup="PF('productDataTableWV').filter()"
									placeholder="#{messages.bug_table_search_watermark}" />
							</h:panelGroup>
						</h:panelGroup>
					</f:facet>
					<p:column style="width: 70px !important;text-align: center;">
						<p:graphicImage styleClass="avatar" cache="false"
							rendered="#{product.logo != null}"
							value="#{imageStreamer.imageProd}">
							<f:param name="ProdId" value="#{product.id}" />
						</p:graphicImage>
						<p:graphicImage styleClass="avatar" library="images"
							name="empty_company.png" rendered="#{product.logo == null}" />
					</p:column>
					<p:column sortBy="#{product.name}">
						<f:facet name="header">
							<h:outputText value="#{messages.admin_product_table_name_label}" />
						</f:facet>
						<h:outputText value="#{product.name}" />
					</p:column>
					<p:column sortBy="#{product.extname}" priority="6">
						<f:facet name="header">
							<h:outputText
								value="#{messages.admin_product_table_extname_label}" />
						</f:facet>
						<h:outputText value="#{product.extname}" />
					</p:column>
					<p:column sortBy="#{product.manager.company.name}" id="company"
						filterMatchMode="exact" priority="6"
						filterBy="#{product.manager.company.name}">
						<f:facet name="header">
							<h:outputText value="#{messages.admin_company_menuitem}" />
						</f:facet>
						<f:facet name="filter">
							<p:selectOneMenu var="type"
								style="padding-right: 35px !important;"
								panelStyleClass="specSelectOneMenuPanel"
								styleClass="specSelectOneMenu Fs14"
								onchange="PF('productDataTableWV').filter()">
								<f:selectItems value="#{jJCompanyBean.companyOptions}" />
								<p:column>
									<h:outputText value="#{type}" />
								</p:column>
							</p:selectOneMenu>
						</f:facet>
						<h:outputText value="#{product.manager.company.name}" />
					</p:column>
					<p:column styleClass="action-column" style="width: 15%;">
						<f:facet name="header">
							<h:outputText styleClass="ShowOnDesktop"
								value="#{messages.admin_product_table_action_label}" />
						</f:facet>
						<p:commandButton id="viewButton" type="button"
							icon="fa fa-list Fs20" styleClass="BlueButton littleButton" />
						<p:menu overlay="true" trigger="viewButton" my="right top"
							at="right bottom">
							<p:menuitem id="editButton" icon="fa fa-pencil Fs16"
								oncomplete="PF('productDialogWidget').show()" resetValues="true"
								value="#{messages.label_edit}" title="#{messages.label_edit}"
								action="#{jJProductBean.editProduct(jJVersionBean)}"
								update=":tabview:productDialogHeader :tabview:productDialogForm">
								<f:setPropertyActionListener value="#{product}"
									target="#{jJProductBean.productAdmin}" />
							</p:menuitem>
							<p:menuitem id="deleteButton" icon="fa fa-trash Fs16"
								resetValues="true"
								oncomplete="PF('productDeleteDialogWidget').show()"
								title="#{messages.label_delete}"
								value="#{messages.label_delete}">
								<f:setPropertyActionListener value="#{product}"
									target="#{jJProductBean.productAdmin}" />
							</p:menuitem>
						</p:menu>
					</p:column>
					<f:facet name="footer">
						<h:panelGroup layout="block" styleClass="Container">
							<h:panelGroup layout="block"
								styleClass="Container50 Responsive50">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:commandButton
										value="#{messages.admin_product_table_new_label}"
										id="newProduct" resetValues="true"
										actionListener="#{jJProductBean.newProduct(jJVersionBean)}"
										update=":tabview:productDialogHeader :tabview:productDialogForm"
										oncomplete="PF('productDialogWidget').show()"
										icon="fa fa-plus Fs20" />
								</h:panelGroup>
							</h:panelGroup>
						</h:panelGroup>
					</f:facet>
				</p:dataTable>
			</h:panelGroup>
		</h:panelGroup>
	</h:form>
	<p:dialog id="productDialog" draggable="false" responsive="true"
		modal="true" widgetVar="productDialogWidget" dynamic="true"
		showEffect="fade" resizable="false">
		<p:ajax event="close" update=":tabview:productForm :headerForm"
			listener="#{jJProductBean.closeDialog(jJVersionBean,jJBuildBean)}" />
		<f:facet name="header">
			<p:outputLabel id="productDialogHeader"
				value="#{messages[jJProductBean.message]}" />
		</f:facet>
		<pe:blockUI widgetVar="versionBlockUIWidget"
			target="productDialogPanel">
			<h:panelGrid columns="2" layout="grid">
				<p:graphicImage name="images/preloader.gif" library="rioLayout"
					style="vertical-align: middle;" />
				<h:outputText value="#{messages.label_refresh}"
					style="white-space: nowrap;" />
			</h:panelGrid>
		</pe:blockUI>
		<h:panelGroup id="productDialogPanel" layout="block"
			styleClass="Container BorderAll" style="max-width:700px;">
			<h:form id="productDialogForm" enctype="multipart/form-data" >
				<h:panelGroup layout="block" styleClass="ui-fluid Container100">
					<p:messages id="msg" showDetail="false" closable="true" />
				</h:panelGroup>
				<h:panelGroup layout="block" styleClass="ui-fluid Container100">
					<h:panelGroup layout="block" styleClass="ContainerIndent">
						<p:inputText id="name"
							placeholder="#{messages.admin_product_new_name_watermark}"
							disabled="#{jJProductBean.disabledProductMode}"
							value="#{jJProductBean.productAdmin.name}"
							label="#{messages.admin_product_new_name_title}" required="true"
							widgetVar="nameWidget">
							<f:validateLength maximum="100" />
							<p:ajax event="blur" update="prodLogo" />
						</p:inputText>
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup layout="block"
					styleClass="ui-fluid Container40 Responsive100">
					<h:panelGroup layout="block" styleClass="ContainerIndent">
						<p:inputText id="extname"
							placeholder="#{messages.admin_product_new_extname_waternmark}"
							disabled="#{jJProductBean.disabledProductMode}"
							value="#{jJProductBean.productAdmin.extname}"
							label="#{messages.admin_product_new_extname_label}"
							required="true" widgetVar="extnameWidget">
							<f:validateLength maximum="100" />
						</p:inputText>
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup layout="block"
					styleClass="ui-fluid Container60 Responsive100">
					<h:panelGroup layout="block" styleClass="Container35">
						<h:panelGroup layout="block" styleClass="ContainerIndentLabel">
							<p:outputLabel for="productManagerSelect"
								value="#{messages.admin_product_new_manager_title}" />
						</h:panelGroup>
					</h:panelGroup>
					<h:panelGroup layout="block" styleClass="Container65">
						<h:panelGroup layout="block" styleClass="ContainerIndent">
							<p:selectOneMenu id="productManagerSelect"
								disabled="#{jJProductBean.disabledProductMode}"
								value="#{jJProductBean.productManager}" effect="fade"
								filter="#{!loginBean.mobile}" filterMatchMode="startsWith" required="true"
								requiredMessage="#{messages.admin_product_new_manager_alert}"
								widgetVar="productManagerWidget"
								label="#{messages.admin_product_new_manager_label}">
								<f:converter
									converterId="com.starit.janjoonweb.ui.mb.converter.JJContactConverter" />
								<f:selectItem itemLabel="#{messages.label_select}" itemValue="#{null}" />
								<f:selectItems value="#{jJProductBean.productManagerList}"
									var="p" itemLabel="#{p.firstname} #{p.name}" itemValue="#{p}" />
							</p:selectOneMenu>
						</h:panelGroup>
					</h:panelGroup>
				</h:panelGroup>

				<!-- 				<p:selectBooleanButton -->
				<!-- 					disabled="#{jJProductBean.disabledProductMode}" -->
				<!-- 					value="#{jJProductBean.productAdmin.enabled}" -->
				<!-- 					onLabel="#{messages.admin_product_new_active_button}" -->
				<!-- 					offLabel="#{messages.admin_product_new_inactive_button}" -->
				<!-- 					onIcon="ui-icon-check" offIcon="ui-icon-close"> -->
				<!-- 					<p:ajax update="msg" listener="#{jJProductBean.addMessage}" /> -->
				<!-- 				</p:selectBooleanButton> -->
				<h:panelGroup layout="block"
					styleClass="#{jJProductBean.disabledVersionMode ?'Container70':'Container100'} Responsive100">
					<h:panelGroup layout="block"
						styleClass="Container20 TexAlCenter BorderAll"
						style="height:100px;">
						<h:panelGroup layout="block" styleClass="ContainerIndent">
							<p:graphicImage styleClass="avatar" cache="false"
								style="margin-top: 7%;" value="#{imageStreamer.imageProd}">
								<f:param name="ProdId" value="#{jJProductBean.productAdmin.id}" />
								<f:param name="Edit" value="true" />
							</p:graphicImage>
						</h:panelGroup>
					</h:panelGroup>
					<h:panelGroup layout="block" styleClass="Container75 TexAlCenter"
						style="height:100px;">
						<h:panelGroup layout="block" styleClass="ContainerIndent">
							<p:fileUpload id="prodLogo" fileLimit="1"
								styleClass="customFileUpload"
								disabled="#{empty jJProductBean.productAdmin.name}"
								fileUploadListener="#{licenseBean.handleProdLogoUpload}"
								mode="advanced" dragDropSupport="false" update="msg"
								sizeLimit="1000000" allowTypes="/(gif|png|ico|jpeg)$/" />
						</h:panelGroup>
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup layout="block"
					rendered="#{jJProductBean.disabledVersionMode}"
					styleClass="ui-fluid Container30 Responsive50">
					<h:panelGroup layout="block" styleClass="ContainerIndent">
						<p:commandButton id="addProduct"
							value="#{messages.admin_product_new_title}"
							update="productDialogForm" icon="fa fa-plus Fs16"
							disabled="#{not jJProductBean.disabledVersionMode}"
							process="@this,name,extname,productManagerSelect"
							action="#{jJProductBean.addProduct(jJVersionBean)}" />
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup layout="block" styleClass="Separator" />
				<h:panelGroup layout="block"
					styleClass="ui-fluid Container70 Responsive100">
					<h:panelGroup layout="block" styleClass="ContainerIndent">
						<p:inputText id="version"
							placeholder="#{messages.admin_product_new_version_watermark}"
							disabled="#{jJProductBean.disabledVersionMode}"
							value="#{jJVersionBean.versionAdmin.name}" label="Version Name"
							required="true"
							requiredMessage="#{messages.label_name_required_alert}"
							widgetVar="versionWidget">
							<f:validateLength maximum="100" />
							<f:validator validatorId="unicityNameValidator" />
							<f:attribute name="product" value="#{jJProductBean.productAdmin}" />
							<f:attribute name="versionBean" value="#{jJVersionBean}" />
						</p:inputText>
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup layout="block"
					styleClass="ui-fluid Container30 Responsive100">
					<h:panelGroup layout="block" styleClass="ContainerIndent">
						<p:commandButton id="addVersion"
							onstart="PF('versionBlockUIWidget').block()"
							oncomplete="PF('versionBlockUIWidget').unblock()"
							disabled="#{jJProductBean.disabledVersionMode}"
							update="version versionDataTable msg"
							actionListener="#{jJVersionBean.addVersion}"
							icon="fa fa-plus Fs16"
							value="#{messages.admin_product_new_version_button}"
							process="@this,version" />
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup layout="block" styleClass="Separator" />
				<h:panelGroup layout="block"
					styleClass="ui-fluid Container90 Responsive100">
					<h:panelGroup layout="block" styleClass="ContainerIndent">
						<p:dataTable id="versionDataTable" var="versionModel"
							scrollable="true" scrollHeight="200"
							value="#{jJVersionBean.versionDataModel}"
							emptyMessage="#{messages.label_notRecordFound}"
							rowStyleClass="#{versionModel.old ? 'old' : null}">

							<p:ajax event="rowToggle" listener="#{jJBuildBean.rowToggle}"
								update="versionDataTable" onstart="updateRowExapansion();" />

							<!-- 							<f:facet name="header"> -->
							<!-- 								<h:outputText -->
							<!-- 									value="#{messages.admin_product_new_version_title}" /> -->
							<!-- 							</f:facet> -->

							<p:column style="width:10%" styleClass="TexAlCenter">
								<p:rowToggler />
							</p:column>
							<p:column style="width:10%" styleClass="TexAlCenter">
								<f:facet name="header">
									<p:selectBooleanCheckbox
										disabled="#{jJVersionBean.disabledCheckVersion}"
										value="#{jJVersionBean.checkVersions}">
										<p:ajax update="versionDataTable"
											listener="#{jJVersionBean.checkVersions}" />
									</p:selectBooleanCheckbox>
								</f:facet>
								<p:selectBooleanCheckbox value="#{versionModel.checkVersion}"
									disabled="#{jJVersionBean.disabledCheckVersion}">
									<p:ajax update="versionDataTable"
										listener="#{jJVersionBean.checkVersion}" />
								</p:selectBooleanCheckbox>
							</p:column>
							<p:column style="width:80%">
								<f:facet name="header">
									<p:row>
										<p:column>
											<h:outputText
												value="#{messages.admin_product_new_version_header}" />
										</p:column>
									</p:row>
								</f:facet>
								<h:outputText value="#{versionModel.version.name}" />
							</p:column>

							<p:rowExpansion styleClass="rowExpansion">
								<f:event type="preRenderComponent" update="versionDataTable"
									onstart="PF('versionBlockUIWidget').block()"
									oncomplete="PF('versionBlockUIWidget').unblock()"
									listener="#{jJBuildBean.loadingRowExpansion(versionModel.version)}" />
								<h:panelGroup layout="block" styleClass="Container">
									<h:panelGroup layout="block" styleClass="Container80 BorderAll">
										<h:panelGroup layout="block" styleClass="Container100">
											<p:dataTable id="buildDataTable" var="build"
												selection="#{jJBuildBean.buildUtils.get(jJBuildBean.index).versionSelectedBuilds}"
												rowKey="#{build.id}"
												emptyMessage="#{messages.label_notRecordFound}"
												value="#{jJBuildBean.buildUtils.get(jJBuildBean.index).versionBuilds}">

												<p:column selectionMode="multiple"
													style="width:30%;text-align:center" />
												<p:column style="width:70%">
													<f:facet name="header">
														<p:row>
															<p:column>
																<h:outputText value="Build" />
															</p:column>
														</p:row>
													</f:facet>
													<h:outputText value="#{build.name}" />
												</p:column>
												<f:facet name="footer">
													<h:panelGroup layout="block" styleClass="Container">
														<h:panelGroup layout="block" style="float:right;"
															styleClass="Container50 Responsive50">
															<h:panelGroup layout="block" styleClass="ContainerIndent">
																<p:commandButton styleClass="Fs12"
																	onstart="PF('versionBlockUIWidget').block()"
																	oncomplete="PF('versionBlockUIWidget').unblock()"
																	icon="fa fa-refresh Fs14"
																	update="buildDataTable :tabview:productDialogForm:msg"
																	process="buildDataTable"
																	value="#{messages.label_update}"
																	action="#{jJBuildBean.updateVersionBuilds(versionModel.version.id)}" />
															</h:panelGroup>
														</h:panelGroup>
													</h:panelGroup>
												</f:facet>
											</p:dataTable>
										</h:panelGroup>
										<h:panelGroup layout="block" styleClass="Container80">
											<p:inputText id="build"
												placeholder="#{messages.admin_product_new_build_text}"
												value="#{jJBuildBean.buildName}"
												label="#{messages.admin_product_new_build_text}"
												required="true"
												requiredMessage="#{messages.label_name_required_alert}">
												<f:validateLength maximum="100" />
												<f:validator validatorId="unicityNameValidator" />
												<f:attribute name="version" value="#{versionModel.version}" />
												<f:attribute name="buildBean" value="#{jJBuildBean}" />
											</p:inputText>
										</h:panelGroup>
										<h:panelGroup layout="block"
											styleClass="Container20 TexAlCenter">
											<h:panelGroup layout="block" styleClass="ContainerIndent">
												<p:commandButton id="addBuild" icon="fa fa-plus Fs16"
													onstart="PF('versionBlockUIWidget').block()"
													styleClass="littleButton"
													oncomplete="PF('versionBlockUIWidget').unblock()"
													update="build buildDataTable :tabview:productDialogForm:msg"
													action="#{jJBuildBean.addBuild(versionModel.version.id)}"
													title="#{messages.admin_product_new_build_button}"
													process="@this,build">
												</p:commandButton>
											</h:panelGroup>
										</h:panelGroup>
									</h:panelGroup>
								</h:panelGroup>
							</p:rowExpansion>
						</p:dataTable>
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup layout="block" styleClass="Separator" />
				<h:panelGroup layout="block"
					styleClass="ui-fluid Container33 Responsive50">
					<h:panelGroup layout="block" styleClass="ContainerIndent">
						<p:commandButton id="saveButton" icon="fa fa-save Fs16"
							onstart="PF('versionBlockUIWidget').block()"
							oncomplete="PF('versionBlockUIWidget').unblock()"
							disabled="#{jJProductBean.disabledVersionMode}"
							value="#{messages.admin_product_new_save_button}"
							update="productDialogForm :headerForm :growlForm"
							process="@this,name,extname,productManagerSelect"
							action="#{jJProductBean.save(jJVersionBean)}" />
					</h:panelGroup>
				</h:panelGroup>
				<h:panelGroup layout="block"
					styleClass="ui-fluid Container33 Responsive50"
					style="float: right;">
					<h:panelGroup layout="block" styleClass="ContainerIndent">
						<p:commandButton id="viewCloseButton" styleClass="GrayButton"
							value="#{messages.label_cancel}"
							oncomplete="PF('blockUIWidget').unblock()"
							onstart="PF('blockUIWidget').block()"
							onclick="PF('productDialogWidget').hide()" type="button" />
					</h:panelGroup>
				</h:panelGroup>
			</h:form>
		</h:panelGroup>
	</p:dialog>
	<p:confirmDialog id="productDeleteDialog"
		widgetVar="productDeleteDialogWidget"
		message="#{messages.admin_product_delete_label}" showEffect="fade"
		hideEffect="fade"
		header="#{messages.admin_product_delete_confirm_label}"
		severity="alarm">
		<p:outputPanel id="productDeletePanel">
			<h:form id="productDeleteForm">
				<p:commandButton id="deleteYesButton"
					value="#{messages.admin_product_new_yes_button}"
					action="#{jJProductBean.deleteProduct}"
					update=":tabview:productForm :headerForm"
					oncomplete="PF('productDeleteDialogWidget').hide()" />
				<p:commandButton id="deleteNoButton"
					value="#{messages.admin_product_new_no_button}"
					onclick="PF('productDeleteDialogWidget').hide()" type="button" />
			</h:form>
		</p:outputPanel>
	</p:confirmDialog>
</ui:composition>
</html>
