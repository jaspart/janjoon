<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/template.xhtml">
	<link type="text/css" rel="stylesheet"
		href="#{facesContext.externalContext.requestContextPath}/syntaxhighlighter/syntaxhighlighter.css" />
	<link type="text/css" rel="stylesheet"
		href="/syntaxhighlighter/standard.css" />
	<ui:define name="content">
		<style type="text/css">
.CodeMirror-scroll {
	height: 450px;
}
</style>
		<!-- 		<h:outputScript library="js" name="codeMirror.js" /> -->
		<h:form>
			<p:remoteCommand name="updateHeader"
				oncomplete="PF('blockUIWidget').unblock()"
				update=":contentPanel :growlForm" />
		</h:form>
		<br />
		<p:panel id="errorPanel"
			header="#{messages['dev.panel.error.header']}"
			style="width: 100%;valign: top;" rendered="#{!jJDevelopment.render}">
			<!-- 			<p:growl id="error" showDetail="false" life="2000" /> -->
			<H1>#{messages['dev.panel.error.title']}</H1>
		</p:panel>


		<p:panel header="#{jJDevelopment.product.name}" id="devPanel"
			style="width: 100%;valign: top;" rendered="#{jJDevelopment.render}">
			<p:commandButton value="#{messages.specification_video_help_title}"
				id="videoHelpBtn" icon="ui-icon-video"
				onclick="PF('videoHelpWidget').show()" type="button" />
			<h:form id="form">
				<table>
					<tr>
						<td><p:panelGrid style="margin-top:10px;height: 550px;">
								<p:row>
									<p:column>
										<h:outputText for="taskSelectOneMenu"
											value="#{messages['dev.taskSelectOneMenu.label']}" />

										<p:selectOneMenu id="taskSelectOneMenu" immediate="true"
											value="#{jJDevelopment.task}" panelStyle="width:150px"
											effect="fold" editable="false" style="width:160px"
											required="true" requiredMessage="Select task to commit">
											<f:selectItem itemValue="#{null}"
												itemLabel="-- #{messages['dev.taskSelectOneMenu.labelitem']} --" />
											<f:selectItems value="#{jJDevelopment.tasks}" var="t"
												itemLabel="#{t.name}" itemValue="#{t}" />
											<f:converter
												converterId="com.starit.janjoonweb.ui.mb.converter.JJTaskConverter" />

											<p:ajax update="startTaskPanel" />
										</p:selectOneMenu>
									</p:column>

									<p:column>
										<p:commandButton id="fetchFromRepo" immediate="true"
											process="@this" icon="ui-icon-refresh"
											onstart="PF('blockUIWidget').block()"
											oncomplete="PF('blockUIWidget').unblock()"
											actionListener="#{jJDevelopment.pull}"
											update=":form :growlForm" />

										<h:panelGroup id="startTaskPanel">

											<p:commandButton immediate="true" icon="ui-icon-play"
												disabled="#{jJDevelopment.task == null or jJDevelopment.task.startDateReal != null}"
												actionListener="#{jJDevelopment.startTask}"
												update=":form:taskSelectOneMenu startTaskPanel :growlForm" />

											<p:commandButton id="viewTaskButton" icon="ui-icon-zoomin"
												update=":viewTaskForm :viewTaskDialogHeader" resetValues="true"
												disabled="#{jJDevelopment.task == null}" immediate="true"
												oncomplete="PF('viewTaskDialogWidget').show()"
												actionListener="#{jJTaskBean.gettingTaskValue}"
												title="#{messages.project_gantt_table_actions_viewMenuItem}">
												<f:attribute name="taskValue" value="#{jJDevelopment.task}" />

												<!-- 												<f:setPropertyActionListener value="#{jJDevelopment.task}" -->
												<!-- 													target="#{jJTaskBean.JJTask_}" /> -->
											</p:commandButton>
											<br />
											<h:outputText
												rendered="#{jJDevelopment.task != null and jJDevelopment.task.startDateReal != null}"
												style="color:red;" />

											<h:outputText value="#{jJDevelopment.task.startDateReal}"
												rendered="#{jJDevelopment.task != null and jJDevelopment.task.startDateReal != null}"
												style="color:red;">
												<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
											</h:outputText>


										</h:panelGroup>
									</p:column>
								</p:row>
								<p:row>
									<p:column colspan="2">
										<p:message for="taskSelectOneMenu" id="taskmessage"
											closable="true" />
										<!-- 										<p:growl id="messages" showDetail="false" life="2000" /> -->
										<p:panel header="#{messages['devs.projectexplorer.label']}">

											<p:scrollPanel id="fileTreeScrollPanel" style="height:300px;"
												mode="native">
												<p:contextMenu for="fileTree" nodeType="folder">
													<p:menuitem
														value="#{messages['dev.menuitem.deleteFolder.label']}"
														icon="ui-icon-trash" immediate="true"
														update=":deletePanel" resetValues="true"
														oncomplete="PF('deleteFileDialogWidget').show()" />
													<p:menuitem
														value="#{messages['dev.menuitem.addFile.label']}"
														icon="ui-icon-document" immediate="true"
														resetValues="true" update=":createFilePanel"
														oncomplete="PF('createFileDialogWidget').show()" />
													<p:menuitem
														value="#{messages['dev.menuitem.uploadFile.label']}"
														icon="ui-icon-arrowthickstop-1-n" immediate="true"
														resetValues="true"
														oncomplete="PF('uploadFileDialogWidget').show()" />
													<p:menuitem
														value="#{messages['dev.menuitem.commit.label']}"
														icon="ui-icon-arrowthickstop-1-e" immediate="true"
														resetValues="true"
														oncomplete="PF('commitFileDialogWidget').show()" />
												</p:contextMenu>

												<p:contextMenu for="fileTree" nodeType="file">
													<p:menuitem
														value="#{messages['dev.menuitem.deleteFile.label']}"
														icon="ui-icon-trash" immediate="true"
														update=":deletePanel" resetValues="true"
														oncomplete="PF('deleteFileDialogWidget').show()" />
													<p:menuitem
														value="#{messages['dev.menuitem.commit.label']}"
														icon="ui-icon-arrowthickstop-1-e" immediate="true"
														resetValues="true"
														oncomplete="PF('commitFileDialogWidget').show()" />
												</p:contextMenu>

												<p:tree id="fileTree" value="#{jJDevelopment.tree}"
													var="file" animate="true" dynamic="true"
													selection="#{jJDevelopment.selectedTree}"
													selectionMode="single">
													<p:ajax event="select" update=":form:tabViewPanel"
														listener="#{jJDevelopment.onSelectTree}" />
													<p:treeNode type="folder"
														expandedIcon="ui-icon-folder-open"
														collapsedIcon="ui-icon-folder-collapsed">

														<h:outputText value="#{file.name}" />

													</p:treeNode>

													<p:treeNode type="file" icon="ui-icon-document">
														<h:outputText value="#{file.name}" />
													</p:treeNode>
												</p:tree>
											</p:scrollPanel>
											<p:commandButton
												value="#{messages['dev.menuitem.uploadFile.label']}"
												icon="ui-icon-arrowthickstop-1-n" immediate="true"
												resetValues="true"
												actionListener="#{jJDevelopment.addToRoot}"
												oncomplete="PF('uploadFileDialogWidget').show()" />
											<p:commandButton
												value="#{messages['dev.menuitem.addFile.label']}"
												icon="ui-icon-document" immediate="true" resetValues="true"
												update=":createFilePanel"
												actionListener="#{jJDevelopment.addToRoot}"
												oncomplete="PF('createFileDialogWidget').show()" />
										</p:panel>
									</p:column>
								</p:row>
								<p:row>
									<p:column colspan="2">
										<p:outputLabel for="textMess"
											value="#{messages['dev.comment.label']}" />
										<br />
										<p:inputTextarea id="textMess"
											value="#{jJDevelopment.comment}" required="true"
											requiredMessage="#{messages['dev.comment.requiredMessage']}"
											rows="5" cols="40" autoResize="false" />
										<p:message for="textMess" id="commentmessage" closable="true" />
									</p:column>
								</p:row>
								<p:row>
									<p:column>
										<p:selectBooleanCheckbox value="#{jJDevelopment.check}"
											id="Marcasdone" />
										<h:outputLabel value="#{messages['dev.Marcasdone.label']}"
											for="Marcasdone" />
									</p:column>
									<p:column>
										<p:commandButton value="#{messages['dev.submit.button']}"
											id="submit" icon="ui-icon-disk"
											onstart="PF('blockUIWidget').block()"
											oncomplete="PF('blockUIWidget').unblock()"
											actionListener="#{jJDevelopment.commit}"
											update=":growlForm,:form" />
									</p:column>
								</p:row>
							</p:panelGrid></td>
						<td><p:panel id="tabViewPanel"
								header="#{messages['dev.fileContent.panel']}"
								style="height:570px;width:700px;margin-top: 11px;margin-left: 20px;">
								<p:tabView id="tabView" effectDuration="fast"
									rendered="#{not empty jJDevelopment.files}"
									activeIndex="#{jJDevelopment.activeTabIndex}" effect="fade"
									scrollable="true" value="#{jJDevelopment.files}" var="tab">

									<p:ajax event="tabClose" listener="#{jJDevelopment.onCloseTab}"
										update=":form:tabViewPanel" />

									<p:ajax event="tabChange" update=":form:tabViewPanel" />

									<p:tab title="#{tab.title}" closable="true">

										<pe:codeMirror id="codeMirror" mode="#{tab.mode}"
											binding="#{codeMirror}" autoformat="true" theme="eclipse"
											value="#{tab.texte}" lineNumbers="true" tabSize="150"
											widgetVar="myCodeMirror_#{tab.index}"
											extraKeys="{ 'Ctrl-Space': function(cm) {CodeMirror.simpleHint(cm, CodeMirror.javascriptHint);}}">
											<p:ajax event="blur" update=":form:tabView:codeMirror"
												listener="#{jJDevelopment.valueChangeHandlerCodeMirror}" />

											<f:attribute name="cm" value="#{codeMirror}" />
										</pe:codeMirror>
										<!-- 										<h:panelGrid columns="3"> -->
										<!-- 											<a -->
										<!-- 												href="javascript:autoFormatSelection(PF('myCodeMirror_#{tab.index}').instance)"> -->
										<!-- 												Autoformat Selected </a> -->
										<!-- 											<a -->
										<!-- 												href="javascript:commentSelection(true,PF('myCodeMirror_#{tab.index}').instance)"> -->
										<!-- 												Comment Selected </a> -->
										<!-- 											<a -->
										<!-- 												href="javascript:commentSelection(false,PF('myCodeMirror_#{tab.index}').instance)"> -->
										<!-- 												Uncomment Selected </a> -->
										<!-- 										</h:panelGrid> -->
									</p:tab>
								</p:tabView>
							</p:panel></td>
					</tr>
				</table>


			</h:form>
			<p:confirmDialog id="deletFileDialog"
				widgetVar="deleteFileDialogWidget"
				message="#{messages['dev.deletFileDialog.title']}" showEffect="fade"
				hideEffect="explode"
				header="#{messages['dev.deletFileDialog.header']}" severity="alarm">

				<p:outputPanel id="deletePanel">
					<h:form id="deleteForm">
						<p:commandButton id="deleteYesButton"
							value="#{messages.label_yes}"
							action="#{jJDevelopment.deleteFile}"
							update=":form :growlForm :deletePanel"
							oncomplete="PF('deleteFileDialogWidget').hide()" />
						<p:commandButton id="deleteNoButton" value="#{messages.label_no}"
							onclick="PF('deleteFileDialogWidget').hide()" type="button" />
					</h:form>
				</p:outputPanel>
			</p:confirmDialog>
			<p:confirmDialog id="commitFileDialog"
				widgetVar="commitFileDialogWidget"
				message="#{messages['dev.commitFileDialog.title']}"
				showEffect="fade" hideEffect="explode"
				header="#{messages['dev.commitFileDialog.header']}" severity="alarm">
				<p:outputPanel id="commitPanel">
					<h:form id="commitForm">
						<p:commandButton id="commitYesButton"
							value="#{messages.label_yes}"
							onstart="PF('blockUIWidget').block()"
							action="#{jJDevelopment.commitFile}" update=":form :growlForm"
							oncomplete="PF('commitFileDialogWidget').hide(),PF('blockUIWidget').unblock()" />
						<p:commandButton id="commitNoButton" value="#{messages.label_no}"
							onclick="PF('commitFileDialogWidget').hide()" type="button" />
					</h:form>
				</p:outputPanel>
			</p:confirmDialog>

			<p:confirmDialog id="saveFileDialog" widgetVar="saveFileDialogWidget"
				message="#{messages['dev.saveFileDialog.title']}" showEffect="fade"
				hideEffect="explode"
				header="#{messages['dev.saveFileDialog.header']}" severity="alarm">
				<p:outputPanel id="savePanel">
					<h:form id="saveForm">
						<p:commandButton id="saveYesButton" value="#{messages.label_yes}"
							action="#{jJDevelopment.saveFile}"
							update=":form:tabViewPanel :growlForm" />
						<p:commandButton id="saveNoButton" value="#{messages.label_no}"
							action="#{jJDevelopment.notSaveFile}" update=":form:tabViewPanel" />
					</h:form>
				</p:outputPanel>
			</p:confirmDialog>

			<p:dialog id="createFileDialog" header="#{messages.label_create}"
				widgetVar="createFileDialogWidget" resizable="true"
				showEffect="fade" hideEffect="explode">
				<p:outputPanel id="createFilePanel">
					<h:form id="createFileForm">
						<h:panelGrid columns="2" styleClass="dialog">
							<p:outputLabel for="fileName" value="Nom :" />
							<p:inputText id="fileName"
								value="#{jJDevelopment.createdFileName}" required="true" />
							<p:outputLabel for="fileType" value="Type :" />
							<p:selectBooleanButton id="fileType"
								value="#{jJDevelopment.fileOrFolder}" onLabel="File"
								offLabel="Folder" onIcon="ui-icon-document"
								offIcon="ui-icon-folder-collapsed">
							</p:selectBooleanButton>
							<p:commandButton id="createSaveButton"
								value="#{messages.label_save}" update=":form,:growlForm"
								onstart="PF('blockUIWidget').block()"
								oncomplete="PF('blockUIWidget').unblock()"
								action="#{jJDevelopment.CreateFile}" />
							<p:commandButton id="createCloseButton"
								value="#{messages.label_close}"
								onclick="PF('createFileDialogWidget').hide()" type="button" />
						</h:panelGrid>
					</h:form>
				</p:outputPanel>
			</p:dialog>

			<p:dialog id="viewTaskDialog"
				modal="true" widgetVar="viewTaskDialogWidget" dynamic="true"
				resizable="true" maximizable="true" showEffect="fade"
				hideEffect="explode" draggable="false">
				<p:ajax event="close"
					update=":form:taskSelectOneMenu :form:startTaskPanel"
					listener="#{jJTaskBean.closeEvent('dev')}" />
				<f:facet name="header">
					<p:outputLabel id="viewTaskDialogHeader"
						value="#{messages.label_view} #{jJTaskBean.getDialogHeader(jJTaskBean.task,null)}" />
				</f:facet>
				<p:outputPanel id="viewTaskPanel">
					<h:form id="viewTaskForm" enctype="multipart/form-data">
						<p:panel styleClass="panelDialog">
							<f:facet name="header">
								<p:messages id="msg" closable="true" />
							</f:facet>
							<ui:include src="taskDialog.xhtml">
								<ui:param name="JJTask_" value="#{jJTaskBean.task}" />
							</ui:include>
							<f:facet name="footer">
								<p:commandButton id="updateTaskButton" update=":viewTaskForm :growlForm"
									actionListener="#{jJTaskBean.updateTask('dev')}"
									value="#{messages.label_save}"
									onstart="PF('viewtaskBlockUIWidget').block()"
									style="margin-top: 5px;"
									oncomplete="PF('viewtaskBlockUIWidget').unblock();"
									process="@this,taskSprint,taskStatus,taskStartDatePlanned,taskEndDatePlanned,taskWorkload,taskAssignedTo,taskType" />

								<p:commandButton id="viewCloseButton"
									value="#{messages.label_cancel}"
									style="margin-left: 20px;margin-top: 5px;"
									oncomplete="PF('blockUIWidget').unblock()"
									onstart="PF('blockUIWidget').block()"
									onclick="PF('viewTaskDialogWidget').hide()" type="button" />
							</f:facet>
						</p:panel>
					</h:form>
				</p:outputPanel>
			</p:dialog>

			<p:dialog id="uploadFileDialog"
				header="#{messages['dev.uploadFileDialog.title']}"
				widgetVar="uploadFileDialogWidget" resizable="true"
				showEffect="fade" hideEffect="explode">
				<p:outputPanel id="uploadFilePanel">
					<h:form id="uploadFileForm">
						<p:fileUpload id="uploadFileButton" 
							fileUploadListener="#{jJDevelopment.handleFileUpload}"
							onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()" mode="advanced"
							dragDropSupport="false" update=":form :growlForm"
							sizeLimit="1000000" fileLimit="4" />
					</h:form>
				</p:outputPanel>
			</p:dialog>

		</p:panel>
		<p:hotkey bind="esc" handler="PF('videoHelpWidget').hide()" />
		<p:dialog id="videoHelpDialog" widgetVar="videoHelpWidget"
			position="center" header="#{messages.specification_video_help_title}"
			style="padding:0px;" resizable="false" draggable="false"
			minHeight="500" minWidth="500" showEffect="fade" hideEffect="fade">
			<video width="100%" height="100%" controls="true">
				<source src="https://www.starit.fr/jjtraining.mp4" type="video/mp4" />
			</video>
		</p:dialog>
	</ui:define>
	<ui:define name="outer">
		<center>
			<ui:insert name="highlight">
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shCore.js"></script>

				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushXml.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushJava.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushCss.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushJScript.js"></script>
				<script type="text/javascript">
					dp.SyntaxHighlighter.ClipboardSwf = '\#{request.contextPath}/syntaxhighlighter/clipboard.swf';
					dp.SyntaxHighlighter.HighlightAll('code');
				</script>
			</ui:insert>
		</center>
	</ui:define>
</ui:composition>
</html>

