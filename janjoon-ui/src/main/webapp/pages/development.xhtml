<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/layout.xhtml">
	<link type="text/css" rel="stylesheet"
		href="#{facesContext.externalContext.requestContextPath}/syntaxhighlighter/syntaxhighlighter.css" />
	<link type="text/css" rel="stylesheet"
		href="/syntaxhighlighter/standard.css" />
	<ui:define name="content">
		<f:event listener="#{loginBean.loadingPage}" type="preRenderView" />
		<f:event listener="#{jJDevelopment.reloadRepository}"
			type="preRenderView" />
		<br />
		<p:panel id="errorPanel" header="Error"
			style="width: 100%;valign: top;" rendered="#{!jJDevelopment.render}">
			<p:growl id="error" showDetail="true" life="2000" />
			<H1>#{messages.label_productNotFound}</H1>
		</p:panel>


		<p:panel header="#{jJDevelopment.product.name}" id="devPanel"
			style="width: 100%;valign: top;" rendered="#{jJDevelopment.render}">
			<h:link value="TestWith TexteArea" outcome="development2" />
			<h:form id="form">
				<table>
					<tr>
						<td><p:panelGrid style="margin-top:10px">
								<p:row>
									<p:column>
										<h:outputText for="taskSelectOneMenu" value="Task :" />
										<p:selectOneMenu id="taskSelectOneMenu"
											value="#{jJDevelopment.task}" panelStyle="width:150px"
											effect="fold" editable="false" style="width:160px"
											required="true" requiredMessage="Select task to commit">
											<f:selectItem itemValue="#{null}"
												itemLabel="-- select one --" />
											<f:selectItems value="#{jJDevelopment.tasks}" var="t"
												itemLabel="#{t.name}" itemValue="#{t}" />
											<f:converter
												converterId="com.starit.janjoonweb.ui.mb.converter.JJTaskConverter" />
										</p:selectOneMenu>
									</p:column>
									<p:column>
										<p:commandButton value="UpdateToHead" id="fetchFromRepo"
											immediate="true" icon="ui-icon-disk"
											actionListener="#{jJDevelopment.pull}"
											update=":form:messages,:form:tabView,:form:fileTree,:form" />
									</p:column>
								</p:row>
								<p:row>
									<p:column colspan="2">
										<p:message for="taskSelectOneMenu" id="taskmessage"
											closable="true" />
										<p:growl id="messages" showDetail="true" life="2000" />
										<p:panel header="Project Explorer">

											<p:scrollPanel id="fileTreeScrollPanel" style="height:250px;"
												mode="native">
												<p:contextMenu for="fileTree" nodeType="folder">
													<p:menuitem value="#{messages.dev_deleteFolder}"
														icon="ui-icon-trash" immediate="true"
														oncomplete="deleteFileDialogWidget.show()" />
													<p:menuitem value="#{messages.dev_addFile}"
														icon="ui-icon-document" immediate="true"
														oncomplete="createFileDialogWidget.show()" />
													<p:menuitem value="#{messages.dev_uploadFile}"
														icon="ui-icon-arrowthickstop-1-n" immediate="true"
														oncomplete="uploadFileDialogWidget.show()" />
													<p:menuitem value="commit"
														icon="ui-icon-arrowthickstop-1-e" immediate="true"
														oncomplete="commitFileDialogWidget.show()" />
												</p:contextMenu>

												<p:contextMenu for="fileTree" nodeType="file">
													<p:menuitem value="#{messages.dev_deleteFile}"
														icon="ui-icon-trash" immediate="true"
														oncomplete="deleteFileDialogWidget.show()" />
													<p:menuitem value="commit"
														icon="ui-icon-arrowthickstop-1-e" immediate="true"
														oncomplete="commitFileDialogWidget.show()" />
												</p:contextMenu>

												<p:tree id="fileTree" value="#{jJDevelopment.tree}"
													var="file" animate="true"
													selection="#{jJDevelopment.selectedTree}"
													selectionMode="single">
													<p:ajax event="select" global="false"
														update=":form:messages,:form:tabView"
														listener="#{jJDevelopment.onSelectTree}" />
													<p:treeNode type="folder"
														expandedIcon="ui-icon-folder-open"
														collapsedIcon="ui-icon-folder-collapsed">

														<h:outputText value="#{file.name}" />

													</p:treeNode>

													<p:treeNode type="file" icon="ui-icon-document">
														<h:outputText value="#{file.name}" />
													</p:treeNode>
												</p:tree>
											</p:scrollPanel>
										</p:panel>
									</p:column>
								</p:row>
								<p:row>
									<p:column colspan="2">
										<p:outputLabel for="textMess" value="Comment : " />
										<br />
										<p:inputTextarea id="textMess"
											value="#{jJDevelopment.comment}" required="true"
											requiredMessage="Set Comment to commit" rows="5" cols="40"
											autoResize="false" />
										<p:message for="textMess" id="commentmessage" closable="true" />
									</p:column>
								</p:row>
								<p:row>
									<p:column>
										<p:selectBooleanCheckbox value="#{jJDevelopment.check}"
											id="Marcasdone" />
										<h:outputLabel value="Marc as done" for="Marcasdone" />
									</p:column>
									<p:column>
										<p:commandButton value="Commit" id="submit"
											icon="ui-icon-disk" actionListener="#{jJDevelopment.commit}"
											update=":form:messages,:form:tabView,:form:fileTree,:form:taskmessage,:form:commentmessage" />
									</p:column>
								</p:row>
							</p:panelGrid></td>
						<td><p:panel header="File Content"
								style="height:530px;width:700px;">
								<p:tabView id="tabView" effect="Fade" effectDuration="slow"
									activeIndex="#{jJDevelopment.activeTabIndex}" scrollable="true"
									value="#{jJDevelopment.files}" var="tab">
									<p:ajax event="tabClose" listener="#{jJDevelopment.onCloseTab}"
										update=":form:tabView" />
									<p:ajax event="tabChange"
										listener="#{jJDevelopment.onChangeTab}" update=":form:tabView" />
									<p:tab title="#{tab.title}" closable="true">
										<pe:codeMirror id="codeMirror1" mode="#{tab.mode}" autoformat="true"										
											widgetVar="myCodeMirror" theme="eclipse" value="#{tab.texte}"
											lineNumbers="true" tabSize="150"
											extraKeys="{ 'Ctrl-Space': function(cm) {CodeMirror.simpleHint(cm, CodeMirror.javascriptHint);}}">
											<p:ajax event="blur"
												listener="#{jJDevelopment.valueChangeHandlerCodeMirror}" />
										</pe:codeMirror>
										<table>
											<tbody>
												<tr>
													<td><a href="javascript:autoFormatSelection()">
															Autoformat Selected </a></td>
													<td><a href="javascript:commentSelection(true)">
															Comment Selected </a></td>
													<td><a href="javascript:commentSelection(false)">
															Uncomment Selected </a></td>
												</tr>
											</tbody>
										</table>
									</p:tab>
								</p:tabView>
							</p:panel></td>
					</tr>
				</table>

				<p:blockUI block="form" trigger=":form:submit">  
        				Commiting source code changes ...<br />
					<p:graphicImage library="images" name="ajax-loader.gif" />
				</p:blockUI>
				<p:blockUI block="form" trigger=":form:fetchFromRepo">  
        				Fetching source code repository ...<br />
					<p:graphicImage library="images" name="ajax-loader.gif" />
				</p:blockUI>
				<p:blockUI block="form" trigger=":headerForm:projectSelectOneMenu">
					Updating source code repository ...<br />
					<p:graphicImage library="images" name="ajax-loader.gif" />
				</p:blockUI>

			</h:form>
			<p:confirmDialog id="deletFileDialog"
				widgetVar="deleteFileDialogWidget"
				message="#{messages.label_delete_record}" showEffect="fade"
				hideEffect="explode" header="#{messages.label_confirm_deletion}"
				severity="alarm">
				<p:outputPanel id="deletePanel">
					<h:form id="deleteForm">
						<p:commandButton id="deleteYesButton"
							value="#{messages.label_yes}"
							action="#{jJDevelopment.deleteFile}" update=":form"
							oncomplete="deleteFileDialogWidget.hide()" />
						<p:commandButton id="deleteNoButton" value="#{messages.label_no}"
							onclick="deleteFileDialogWidget.hide()" type="button" />
					</h:form>
				</p:outputPanel>
			</p:confirmDialog>
			<p:confirmDialog id="commitFileDialog"
				widgetVar="commitFileDialogWidget"
				message="#{messages.label_commit_record}" showEffect="fade"
				hideEffect="explode" header="#{messages.label_confirm_commit}"
				severity="alarm">
				<p:outputPanel id="commitPanel">
					<h:form id="commitForm">
						<p:commandButton id="commitYesButton"
							value="#{messages.label_yes}"
							action="#{jJDevelopment.commitFile}" update=":form"
							oncomplete="commitFileDialogWidget.hide()" />
						<p:commandButton id="commitNoButton" value="#{messages.label_no}"
							onclick="commitFileDialogWidget.hide()" type="button" />
					</h:form>
				</p:outputPanel>
			</p:confirmDialog>

			<p:dialog id="createFileDialog" header="#{messages.label_create}"
				widgetVar="createFileDialogWidget" resizable="true"
				showEffect="fade" hideEffect="explode">
				<p:outputPanel id="createFilePanel">
					<h:form id="createFileForm">
						<h:panelGrid columns="2" styleClass="dialog">
							<p:outputLabel for="fileName" value="Nom :" />
							<p:inputText id="fileName"
								value="#{jJDevelopment.createdFileName}" required="true" />
							<p:outputLabel for="fileType" value="Type :" />
							<p:selectBooleanButton id="fileType"
								value="#{jJDevelopment.fileOrFolder}" onLabel="File"
								offLabel="Folder" onIcon="ui-icon-document"
								offIcon="ui-icon-folder-collapsed">
							</p:selectBooleanButton>
							<p:commandButton id="createSaveButton"
								value="#{messages.label_save}" update=":form,"
								action="#{jJDevelopment.CreateFile}" />
							<p:commandButton id="createCloseButton"
								value="#{messages.label_close}"
								onclick="createFileDialogWidget.hide()" type="button" />
						</h:panelGrid>
					</h:form>
				</p:outputPanel>
			</p:dialog>

			<p:dialog id="uploadFileDialog" header="Upload File"
				widgetVar="uploadFileDialogWidget" resizable="true"
				showEffect="fade" hideEffect="explode">
				<p:outputPanel id="uploadFilePanel">
					<h:form id="uploadFileForm">
						<p:fileUpload id="uploadFileButton"
							fileUploadListener="#{jJDevelopment.handleFileUpload}"
							mode="advanced" dragDropSupport="false" update=":form"
							sizeLimit="1000000" fileLimit="4" />
					</h:form>
				</p:outputPanel>
			</p:dialog>
			<p:blockUI block=":devPanel"
				trigger=":uploadFileForm:uploadFileButton">  
        				Uploading file  ...<br />
				<p:graphicImage library="images" name="ajax-loader.gif" />
			</p:blockUI>
			<p:blockUI block=":devPanel"
				trigger=":createFileForm:createSaveButton">  
        				Creating file  ...<br />
				<p:graphicImage library="images" name="ajax-loader.gif" />
			</p:blockUI>
			<p:blockUI block=":devPanel" trigger=":commitForm:commitYesButton">  
        				Commiting file changes ...<br />
				<p:graphicImage library="images" name="ajax-loader.gif" />
			</p:blockUI>
		</p:panel>
		<p:blockUI block=":devPanel"
			trigger=":headerForm:versionSelectOneMenu"
			rendered="#{jJDevelopment.render}">
			Rendering source code ...<br />
			<p:graphicImage library="images" name="ajax-loader.gif" />
		</p:blockUI>

		<p:blockUI block=":errorPanel"
			trigger=":headerForm:versionSelectOneMenu"
			rendered="#{!jJDevelopment.render}">
			Rendering source code - Error message ...<br />
			<p:graphicImage library="images" name="ajax-loader.gif" />
		</p:blockUI>

	</ui:define>
	<ui:define name="outer">
		<center>
			<ui:insert name="highlight">
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shCore.js"></script>
		
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushXml.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushJava.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushCss.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushJScript.js"></script>
				<script type="text/javascript">
					dp.SyntaxHighlighter.ClipboardSwf = '\#{request.contextPath}/syntaxhighlighter/clipboard.swf';
					dp.SyntaxHighlighter.HighlightAll('code');
				</script>
			</ui:insert>
		</center>
	</ui:define>
</ui:composition>
</html>

