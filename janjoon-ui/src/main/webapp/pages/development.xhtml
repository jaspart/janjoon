<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/template.xhtml">
	<ui:define name="head">
		<style type="text/css">
.CodeMirror-scroll {
	height: 450px;
}

.reqTree {
	height: 300px;
	overflow-y: auto;
	overflow-x: hidden;
	border: rgba(255, 0, 0, 0);
	padding: 2px;
}
</style>
		<h:outputScript library="js" name="dev.js" />
	</ui:define>
	<ui:define name="content">
		<h:form>
			<p:remoteCommand name="updateHeader"
				oncomplete="PF('blockUIWidget').unblock()"
				update=":contentPanel :growlForm" />
		</h:form>
		<h:panelGroup layout="block" styleClass="Container">
			<h:panelGroup layout="block" styleClass="Container100">
				<p:panel id="errorPanel"
					header="#{messages['dev.panel.error.header']}"
					rendered="#{!jJDevelopment.render}">
					<h:panelGroup layout="block" styleClass="Container">
						<h:panelGroup layout="block" styleClass="Container100">
							<h:outputText value="#{messages['dev.panel.error.title']}"
								styleClass="Fs50" />
						</h:panelGroup>
					</h:panelGroup>
				</p:panel>
				<p:panel header="#{jJDevelopment.product.name}" id="devPanel"
					rendered="#{jJDevelopment.render}">
					<h:panelGroup layout="block" styleClass="Container ui-fluid">

						<h:form id="form">
							<h:panelGroup layout="block"
								styleClass="Container40 Responsive100">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:panelGrid style="width: 100%;">
										<f:facet name="header">
											<p:row>
												<p:column colspan="2" styleClass="TexAlLeft">
													<h:panelGroup layout="block"
														styleClass="Container ui-fluid">
														<h:panelGroup layout="block"
															styleClass="Container70 Responsive100 TexAlLeft">
															<h:panelGroup layout="block" styleClass="Container25">
																<h:panelGroup layout="block"
																	styleClass="ContainerIndentLabel">
																	<p:outputLabel for="taskSelectOneMenu"
																		value="#{messages['dev.taskSelectOneMenu.label']}:" />
																</h:panelGroup>
															</h:panelGroup>
															<h:panelGroup layout="block" styleClass="Container75">
																<h:panelGroup layout="block"
																	styleClass="ContainerIndent">
																	<p:autoComplete id="taskSelectOneMenu"
																		scrollHeight="200" value="#{jJDevelopment.task}"
																		itemLabel="#{t.name}" itemValue="#{t}"
																		panelStyle="max-width:250px;" required="true"
																		converter="com.starit.janjoonweb.ui.mb.converter.JJTaskConverter"
																		dropdown="true" var="t"
																		placeholder="-- #{messages['dev.taskSelectOneMenu.labelitem']} --"
																		completeMethod="#{jJDevelopment.completeTask}">
																		<p:ajax event="itemSelect" update="startTaskPanel"
																			immediate="true" />
																	</p:autoComplete>
																</h:panelGroup>
															</h:panelGroup>
														</h:panelGroup>
														<h:panelGroup layout="block"
															styleClass="Container30 Responsive100 TexAlLeft">
															<h:panelGroup layout="block" styleClass="Container33">
																<h:panelGroup layout="block"
																	styleClass="ContainerIndent">
																	<p:commandButton id="fetchFromRepo" immediate="true"
																		process="@this" icon="fa Fs20 fa-refresh"
																		onstart="PF('blockUIWidget').block()"
																		oncomplete="PF('blockUIWidget').unblock()"
																		actionListener="#{jJDevelopment.pull}"
																		update=":form :growlForm" />
																</h:panelGroup>
															</h:panelGroup>

															<h:panelGroup styleClass="Container66"
																id="startTaskPanel" layout="block">
																<h:panelGroup layout="block" styleClass="Container50">
																	<h:panelGroup layout="block"
																		styleClass="ContainerIndent">
																		<p:commandButton immediate="true"
																			icon="fa Fs20 fa-play"
																			disabled="#{jJDevelopment.task == null or jJDevelopment.task.startDateReal != null}"
																			actionListener="#{jJDevelopment.startTask}"
																			update=":form:taskSelectOneMenu startTaskPanel :growlForm" />
																	</h:panelGroup>
																</h:panelGroup>
																<h:panelGroup layout="block" styleClass="Container50">
																	<h:panelGroup layout="block"
																		styleClass="ContainerIndent">
																		<p:commandButton id="viewTaskButton"
																			icon="fa fa-eye Fs20"
																			update=":viewTaskForm :viewTaskDialogHeader"
																			resetValues="true"
																			disabled="#{jJDevelopment.task == null}"
																			immediate="true"
																			oncomplete="PF('viewTaskDialogWidget').show()"
																			actionListener="#{jJTaskBean.gettingTaskValue}"
																			title="#{messages.project_gantt_table_actions_viewMenuItem}">
																			<f:attribute name="taskValue"
																				value="#{jJDevelopment.task}" />
																		</p:commandButton>
																	</h:panelGroup>
																</h:panelGroup>
																<h:panelGroup layout="block" styleClass="Container100">
																	<h:panelGroup layout="block"
																		styleClass="ContainerIndent">
																		<h:outputText
																			value="#{jJDevelopment.task.startDateReal}"
																			rendered="#{jJDevelopment.task != null and jJDevelopment.task.startDateReal != null}"
																			style="color:red;">
																			<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
																		</h:outputText>
																	</h:panelGroup>
																</h:panelGroup>
															</h:panelGroup>
														</h:panelGroup>
													</h:panelGroup>
												</p:column>
											</p:row>
										</f:facet>
										<p:row>
											<p:column colspan="2"
												style="padding-left: 0px !important;padding-right: 0px !important;padding-top: 0px !important;padding-bottom: 0px !important;">


												<p:accordionPanel activeIndex="#{jJDevelopment.activeIndex}"
													styleClass="accordionTreePanel">
													<p:tab title="#{messages['devs.projectexplorer.label']}">

														<p:contextMenu for="fileTree" nodeType="folder">
															<p:menuitem
																value="#{messages['dev.menuitem.deleteFolder.label']}"
																icon="fa Fs20 fa-trash" immediate="true"
																update=":deletePanel" resetValues="true"
																oncomplete="PF('deleteFileDialogWidget').show()" />
															<p:menuitem
																value="#{messages['dev.menuitem.addFile.label']}"
																icon="fa Fs20 fa-file-o" immediate="true"
																resetValues="true" update=":createFilePanel"
																oncomplete="PF('createFileDialogWidget').show()" />
															<p:menuitem
																value="#{messages['dev.menuitem.uploadFile.label']}"
																icon="fa Fs20 fa-arrow-circle-o-up" immediate="true"
																resetValues="true"
																oncomplete="PF('uploadFileDialogWidget').show()" />
															<p:menuitem
																value="#{messages['dev.menuitem.commit.label']}"
																icon="fa Fs20 fa-arrow-circle-o-right" immediate="true"
																resetValues="true"
																oncomplete="PF('commitFileDialogWidget').show()" />
														</p:contextMenu>

														<p:contextMenu for="fileTree" nodeType="file">
															<p:menuitem
																value="#{messages['dev.menuitem.deleteFile.label']}"
																icon="Fs20 fa fa-trash" immediate="true"
																update=":deletePanel" resetValues="true"
																oncomplete="PF('deleteFileDialogWidget').show()" />
															<p:menuitem
																value="#{messages['dev.menuitem.commit.label']}"
																icon="fa Fs20 fa-arrow-circle-o-right" immediate="true"
																resetValues="true"
																oncomplete="PF('commitFileDialogWidget').show()" />
														</p:contextMenu>

														<p:tree id="fileTree" value="#{jJDevelopment.tree}"
															var="file" animate="true" dynamic="true"
															styleClass="reqTree Container99"
															selection="#{jJDevelopment.selectedTree}"
															selectionMode="single">
															<p:ajax event="select" update=":form:tabViewPanel"
																listener="#{jJDevelopment.onSelectTree}" />
															<p:treeNode type="folder"
																expandedIcon="ui-icon-folder-open"
																collapsedIcon="ui-icon-folder-collapsed">
																<h:outputText value="#{file.name}" />
															</p:treeNode>

															<p:treeNode type="file" icon="ui-icon-document">
																<h:outputText value="#{file.name}" />
															</p:treeNode>
														</p:tree>
													</p:tab>
												</p:accordionPanel>
											</p:column>
										</p:row>
										<p:row>
											<p:column>
												<p:commandButton
													value="#{messages['dev.menuitem.uploadFile.label']}"
													icon="fa Fs20 fa-arrow-circle-o-up" immediate="true"
													resetValues="true"
													actionListener="#{jJDevelopment.addToRoot}"
													oncomplete="PF('uploadFileDialogWidget').show()" />
											</p:column>
											<p:column>
												<p:commandButton
													value="#{messages['dev.menuitem.addFile.label']}"
													icon="fa Fs20 fa-file-o" immediate="true"
													resetValues="true" update=":createFilePanel"
													actionListener="#{jJDevelopment.addToRoot}"
													oncomplete="PF('createFileDialogWidget').show()" />

											</p:column>
										</p:row>
										<p:row>
											<p:column colspan="2">
												<p:inputTextarea id="textMess"
													value="#{jJDevelopment.comment}" required="true"
													placeholder="#{messages['dev.comment.label']}"
													requiredMessage="#{messages['dev.comment.requiredMessage']}"
													rows="4" autoResize="false"
													style="resize: none;margin-left:auto; margin-right:auto;" />
											</p:column>
										</p:row>
										<f:facet name="footer">
											<p:row>
												<p:column>
													<p:selectBooleanCheckbox value="#{jJDevelopment.check}"
														id="Marcasdone" />
													<h:outputLabel value="#{messages['dev.Marcasdone.label']}"
														for="Marcasdone" />
												</p:column>
												<p:column>
													<p:commandButton value="#{messages['dev.submit.button']}"
														id="submit" icon="Fs20 fa fa-save"
														onstart="PF('blockUIWidget').block()"
														oncomplete="PF('blockUIWidget').unblock()"
														actionListener="#{jJDevelopment.commit}"
														update=":growlForm,:form" />
												</p:column>
											</p:row>
										</f:facet>
									</p:panelGrid>
								</h:panelGroup>
							</h:panelGroup>
							<h:panelGroup layout="block"
								styleClass="Container60 Responsive100">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:panel id="tabViewPanel"
										header="#{messages['dev.fileContent.panel']}">
										<f:event type="preRenderComponent"
											listener="#{loginBean.updateTabViewWidth()}" />
										<h:panelGroup layout="block" styleClass="Container">
											<!-- 											<h:panelGroup layout="block" -->
											<!-- 												styleClass="Container100 Responsive100 ShowOnMobile ui-fluid"> -->

											<!-- 												<h:panelGroup layout="block" styleClass="Container30"> -->
											<!-- 													<h:panelGroup layout="block" -->
											<!-- 														styleClass="ContainerIndentLabel"> -->
											<!-- 														<p:outputLabel for="activeIndex" -->
											<!-- 															value="#{messages.label_tab}:" /> -->
											<!-- 													</h:panelGroup> -->
											<!-- 												</h:panelGroup> -->
											<!-- 												<h:panelGroup layout="block" styleClass="Container70"> -->
											<!-- 													<h:panelGroup layout="block" styleClass="ContainerIndent"> -->
											<!-- 														<p:selectOneMenu id="activeIndex"  -->
											<!-- 															value="#{jJDevelopment.activeTabIndex}"  -->
											<!-- 															effect="fade" onchange="PF('fileTabview').select(value);"> -->
											<!-- 															<f:selectItems value="#{jJDevelopment.files}" var="tab" -->
											<!-- 																itemLabel="#{tab.title}" -->
											<!-- 																itemValue="#{jJDevelopment.contains(tab)}" /> -->

											<!-- 														</p:selectOneMenu>														 -->
											<!-- 													</h:panelGroup> -->
											<!-- 												</h:panelGroup> -->

											<!-- 											</h:panelGroup> -->
											<h:panelGroup layout="block" styleClass="Container100">
												<h:panelGroup layout="block" styleClass="ContainerIndent">
													<p:tabView id="tabView" effectDuration="fast" styleClass=""
														widgetVar="fileTabview" style="max-width: 300px;"
														rendered="#{not empty jJDevelopment.files}"
														activeIndex="#{jJDevelopment.activeTabIndex}"
														effect="fade" scrollable="true"
														value="#{jJDevelopment.files}" var="tab">

														<p:ajax event="tabClose"
															listener="#{jJDevelopment.onCloseTab}"
															update=":form:tabViewPanel" />

														<p:ajax event="tabChange" update=":form:tabViewPanel" />

														<p:tab title="#{tab.title}" closable="true">

															<pe:codeMirror id="codeMirror" mode="#{tab.mode}"
																binding="#{codeMirror}" autoformat="true"
																theme="eclipse" value="#{tab.texte}" lineNumbers="true"
																tabSize="150" widgetVar="myCodeMirror_#{tab.index}"
																extraKeys="{ 'Ctrl-Space': function(cm) {CodeMirror.simpleHint(cm, CodeMirror.javascriptHint);}}">
																<p:ajax event="blur" update=":form:tabView:codeMirror"
																	listener="#{jJDevelopment.valueChangeHandlerCodeMirror}" />

																<f:attribute name="cm" value="#{codeMirror}" />
															</pe:codeMirror>
														</p:tab>
													</p:tabView>
												</h:panelGroup>
											</h:panelGroup>
										</h:panelGroup>
									</p:panel>
								</h:panelGroup>
							</h:panelGroup>
						</h:form>
					</h:panelGroup>
				</p:panel>
			</h:panelGroup>
		</h:panelGroup>
		<p:confirmDialog id="deletFileDialog"
			widgetVar="deleteFileDialogWidget"
			message="#{messages['dev.deletFileDialog.title']}" showEffect="fade"
			header="#{messages['dev.deletFileDialog.header']}" severity="alarm">

			<p:outputPanel id="deletePanel">
				<h:form id="deleteForm">
					<p:commandButton id="deleteYesButton" value="#{messages.label_yes}"
						action="#{jJDevelopment.deleteFile}"
						update=":form :growlForm :deletePanel"
						oncomplete="PF('deleteFileDialogWidget').hide()" />
					<p:commandButton id="deleteNoButton" value="#{messages.label_no}"
						onclick="PF('deleteFileDialogWidget').hide()" type="button" />
				</h:form>
			</p:outputPanel>
		</p:confirmDialog>
		<p:confirmDialog id="commitFileDialog"
			widgetVar="commitFileDialogWidget"
			message="#{messages['dev.commitFileDialog.title']}" showEffect="fade"
			header="#{messages['dev.commitFileDialog.header']}" severity="alarm">
			<p:outputPanel id="commitPanel">
				<h:form id="commitForm">
					<p:commandButton id="commitYesButton" value="#{messages.label_yes}"
						onstart="PF('blockUIWidget').block()"
						action="#{jJDevelopment.commitFile}" update=":form :growlForm"
						oncomplete="PF('commitFileDialogWidget').hide(),PF('blockUIWidget').unblock()" />
					<p:commandButton id="commitNoButton" value="#{messages.label_no}"
						onclick="PF('commitFileDialogWidget').hide()" type="button" />
				</h:form>
			</p:outputPanel>
		</p:confirmDialog>

		<p:confirmDialog id="saveFileDialog" widgetVar="saveFileDialogWidget"
			message="#{messages['dev.saveFileDialog.title']}" showEffect="fade"
			header="#{messages['dev.saveFileDialog.header']}" severity="alarm">
			<p:outputPanel id="savePanel">
				<h:form id="saveForm">
					<p:commandButton id="saveYesButton" value="#{messages.label_yes}"
						action="#{jJDevelopment.saveFile}"
						update=":form:tabViewPanel :growlForm" />
					<p:commandButton id="saveNoButton" value="#{messages.label_no}"
						action="#{jJDevelopment.notSaveFile}" update=":form:tabViewPanel" />
				</h:form>
			</p:outputPanel>
		</p:confirmDialog>

		<p:dialog id="createFileDialog" header="#{messages.label_create}"
			maximizable="false" widgetVar="createFileDialogWidget"
			responsive="true" resizable="false" showEffect="fade">
			<p:outputPanel id="createFilePanel">
				<h:form id="createFileForm">
					<h:panelGroup layout="block"
						styleClass="Container ui-fluid BorderAll"
						style="max-width: 300px;">
						<h:panelGroup layout="block" styleClass="Container100">
							<h:panelGroup layout="block" styleClass="ContainerIndent">
								<p:inputText id="fileName" placeholder="#{messages.label_name}"
									value="#{jJDevelopment.createdFileName}" required="true" />
							</h:panelGroup>
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="Container100">
							<h:panelGroup layout="block" styleClass="ContainerIndent">
								<p:selectBooleanButton id="fileType"
									value="#{jJDevelopment.fileOrFolder}" onLabel="File"
									offLabel="Folder" onIcon="fa Fs20 fa-file-o"
									offIcon="fa Fs20 fa-folder">
								</p:selectBooleanButton>
							</h:panelGroup>
						</h:panelGroup>

						<h:panelGroup layout="block" styleClass="Container50 Responsive50">
							<h:panelGroup layout="block" styleClass="ContainerIndent">
								<p:commandButton id="createSaveButton"
									value="#{messages.label_save}" update=":form,:growlForm"
									onstart="PF('blockUIWidget').block()"
									oncomplete="PF('blockUIWidget').unblock()"
									action="#{jJDevelopment.CreateFile}" />
							</h:panelGroup>
						</h:panelGroup>
						<h:panelGroup layout="block" styleClass="Container50 Responsive50">
							<h:panelGroup layout="block" styleClass="ContainerIndent">
								<p:commandButton id="createCloseButton"
									value="#{messages.label_close}"
									onclick="PF('createFileDialogWidget').hide()" type="button" />
							</h:panelGroup>
						</h:panelGroup>
					</h:panelGroup>
				</h:form>
			</p:outputPanel>
		</p:dialog>

		<p:dialog id="viewTaskDialog" responsive="true" modal="true"
			widgetVar="viewTaskDialogWidget" dynamic="true" resizable="false"
			maximizable="false" showEffect="fade" draggable="false">
			<p:ajax event="close"
				update=":form:taskSelectOneMenu :form:startTaskPanel"
				listener="#{jJTaskBean.closeEvent('dev')}" />
			<f:facet name="header">
				<p:outputLabel id="viewTaskDialogHeader"
					value="#{messages.label_view} #{jJTaskBean.getDialogHeader(jJTaskBean.task,null)}" />
			</f:facet>
			<p:outputPanel id="viewTaskPanel">
				<h:form id="viewTaskForm" enctype="multipart/form-data">
					<ui:include src="taskDialog.xhtml">
						<ui:param name="JJTask_" value="#{jJTaskBean.task}" />
						<ui:param name="View" value="dev" />
					</ui:include>
				</h:form>
			</p:outputPanel>
		</p:dialog>
		<p:dialog id="uploadFileDialog" responsive="true"
			header="#{messages['dev.uploadFileDialog.title']}"
			widgetVar="uploadFileDialogWidget" resizable="false"
			showEffect="fade">
			<p:outputPanel id="uploadFilePanel">
				<h:form id="uploadFileForm">
					<p:fileUpload id="uploadFileButton"
						fileUploadListener="#{jJDevelopment.handleFileUpload}"
						onstart="PF('blockUIWidget').block()"
						oncomplete="PF('blockUIWidget').unblock()" mode="advanced"
						dragDropSupport="false" update=":form :growlForm"
						sizeLimit="1000000" fileLimit="4" />
				</h:form>
			</p:outputPanel>
		</p:dialog>

		<p:hotkey bind="esc" handler="PF('videoHelpWidget').hide()" />
		<p:dialog id="videoHelpDialog" widgetVar="videoHelpWidget"
			responsive="true" position="center"
			header="#{messages.specification_video_help_title}"
			style="padding:0px;" resizable="false" draggable="false"
			minHeight="500" minWidth="500" showEffect="fade" hideEffect="fade">
			<video width="100%" height="100%" controls="true">
				<source src="https://www.starit.fr/jjtraining.mp4" type="video/mp4" />
			</video>
		</p:dialog>
	</ui:define>
</ui:composition>
</html>

