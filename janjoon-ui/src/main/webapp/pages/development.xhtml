<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/layout.xhtml">
	<link type="text/css" rel="stylesheet"
		href="#{facesContext.externalContext.requestContextPath}/syntaxhighlighter/syntaxhighlighter.css" />
	<link type="text/css" rel="stylesheet"
		href="/syntaxhighlighter/standard.css" />
	<ui:define name="content">
		<h:form>
			<p:remoteCommand name="updateHeader"
				oncomplete="PF('blockUIWidget').unblock()" update=":contentPanel" />
		</h:form>
		<br />
		<p:panel id="errorPanel"
			header="#{messages['dev.panel.error.header']}"
			style="width: 100%;valign: top;" rendered="#{!jJDevelopment.render}">
			<p:growl id="error" showDetail="true" life="2000" />
			<H1>#{messages['dev.panel.error.title']}</H1>
		</p:panel>


		<p:panel header="#{jJDevelopment.product.name}" id="devPanel"
			style="width: 100%;valign: top;" rendered="#{jJDevelopment.render}">
			<p:commandButton value="#{messages.specification_video_help_title}"
				id="videoHelpBtn" icon="ui-icon-video"
				onclick="PF('videoHelpWidget').show()" type="button" />
			<h:form id="form">
				<table>
					<tr>
						<td><p:panelGrid style="margin-top:10px">
								<p:row>
									<p:column>
										<h:outputText for="taskSelectOneMenu"
											value="#{messages['dev.taskSelectOneMenu.label']}" />

										<p:selectOneMenu id="taskSelectOneMenu" immediate="true"
											value="#{jJDevelopment.task}" panelStyle="width:150px"
											effect="fold" editable="false" style="width:160px"
											required="true" requiredMessage="Select task to commit">
											<f:selectItem itemValue="#{null}" noSelectionOption="true"
												itemLabel="-- #{messages['dev.taskSelectOneMenu.labelitem']} --" />
											<f:selectItems value="#{jJDevelopment.tasks}" var="t"
												itemLabel="#{t.name}" itemValue="#{t}" />
											<f:converter
												converterId="com.starit.janjoonweb.ui.mb.converter.JJTaskConverter" />

											<p:ajax update="startTaskPanel" />
										</p:selectOneMenu>
									</p:column>

									<p:column>
										<p:commandButton id="fetchFromRepo" immediate="true"
											process="@this" icon="ui-icon-refresh"
											actionListener="#{jJDevelopment.pull}" update=":form" />

										<h:panelGroup id="startTaskPanel">
										
											<p:commandButton immediate="true" icon="ui-icon-play"
												disabled="#{jJDevelopment.task == null or jJDevelopment.task.startDateReal != null}"
												actionListener="#{jJDevelopment.startTask}"
												update=":form:taskSelectOneMenu startTaskPanel" />

											<p:commandButton id="viewTaskButton" icon="ui-icon-zoomin"
												update=":viewTaskForm:viewTaskPanelGrid"
												disabled="#{jJDevelopment.task == null}" immediate="true"
												oncomplete="PF('viewTaskDialogWidget').show()"
												actionListener="#{jJTaskBean.gettingTaskValue}"
												title="#{messages.label_view}">
												<f:attribute name="taskValue" value="#{jJDevelopment.task}" />

												<!-- 												<f:setPropertyActionListener value="#{jJDevelopment.task}" -->
												<!-- 													target="#{jJTaskBean.JJTask_}" /> -->
											</p:commandButton>
											<p:tooltip for="viewTaskButton"
												value="#{messages.label_view}" showEffect="fade"
												hideEffect="fade" />
											<br />
											<h:outputText
												rendered="#{jJDevelopment.task != null and jJDevelopment.task.startDateReal != null}"
												style="color:red;" />

											<h:outputText value="#{jJDevelopment.task.startDateReal}"
												rendered="#{jJDevelopment.task != null and jJDevelopment.task.startDateReal != null}"
												style="color:red;">
												<f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
											</h:outputText>


										</h:panelGroup>
									</p:column>
								</p:row>
								<p:row>
									<p:column colspan="2">
										<p:message for="taskSelectOneMenu" id="taskmessage"
											closable="true" />
										<p:growl id="messages" showDetail="true" life="2000" />
										<p:panel header="#{messages['devs.projectexplorer.label']}">

											<p:scrollPanel id="fileTreeScrollPanel" style="height:250px;"
												mode="native">
												<p:contextMenu for="fileTree" nodeType="folder">
													<p:menuitem
														value="#{messages['dev.menuitem.deleteFolder.label']}"
														icon="ui-icon-trash" immediate="true"
														oncomplete="PF('deleteFileDialogWidget').show()" />
													<p:menuitem
														value="#{messages['dev.menuitem.addFile.label']}"
														icon="ui-icon-document" immediate="true"
														oncomplete="PF('createFileDialogWidget').show()" />
													<p:menuitem
														value="#{messages['dev.menuitem.uploadFile.label']}"
														icon="ui-icon-arrowthickstop-1-n" immediate="true"
														oncomplete="PF('uploadFileDialogWidget').show()" />
													<p:menuitem
														value="#{messages['dev.menuitem.commit.label']}"
														icon="ui-icon-arrowthickstop-1-e" immediate="true"
														oncomplete="PF('commitFileDialogWidget').show()" />
												</p:contextMenu>

												<p:contextMenu for="fileTree" nodeType="file">
													<p:menuitem
														value="#{messages['dev.menuitem.deleteFile.label']}"
														icon="ui-icon-trash" immediate="true"
														oncomplete="PF('deleteFileDialogWidget').show()" />
													<p:menuitem
														value="#{messages['dev.menuitem.commit.label']}"
														icon="ui-icon-arrowthickstop-1-e" immediate="true"
														oncomplete="PF('commitFileDialogWidget').show()" />
												</p:contextMenu>

												<p:tree id="fileTree" value="#{jJDevelopment.tree}"
													var="file" animate="true"
													selection="#{jJDevelopment.selectedTree}"
													selectionMode="single">
													<p:ajax event="select" update=":form:tabViewPanel"
														listener="#{jJDevelopment.onSelectTree}" />
													<p:treeNode type="folder"
														expandedIcon="ui-icon-folder-open"
														collapsedIcon="ui-icon-folder-collapsed">

														<h:outputText value="#{file.name}" />

													</p:treeNode>

													<p:treeNode type="file" icon="ui-icon-document">
														<h:outputText value="#{file.name}" />
													</p:treeNode>
												</p:tree>
											</p:scrollPanel>
											<p:commandButton
												value="#{messages['dev.menuitem.uploadFile.label']}"
												icon="ui-icon-arrowthickstop-1-n" immediate="true"
												actionListener="#{jJDevelopment.addToRoot}"
												oncomplete="PF('uploadFileDialogWidget').show()" />
											<p:commandButton
												value="#{messages['dev.menuitem.addFile.label']}"
												icon="ui-icon-document" immediate="true"
												actionListener="#{jJDevelopment.addToRoot}"
												oncomplete="PF('createFileDialogWidget').show()" />
										</p:panel>
									</p:column>
								</p:row>
								<p:row>
									<p:column colspan="2">
										<p:outputLabel for="textMess"
											value="#{messages['dev.comment.label']}" />
										<br />
										<p:inputTextarea id="textMess"
											value="#{jJDevelopment.comment}" required="true"
											requiredMessage="#{messages['dev.comment.requiredMessage']}"
											rows="5" cols="40" autoResize="false" />
										<p:message for="textMess" id="commentmessage" closable="true" />
									</p:column>
								</p:row>
								<p:row>
									<p:column>
										<p:selectBooleanCheckbox value="#{jJDevelopment.check}"
											id="Marcasdone" />
										<h:outputLabel value="#{messages['dev.Marcasdone.label']}"
											for="Marcasdone" />
									</p:column>
									<p:column>
										<p:commandButton value="#{messages['dev.submit.button']}"
											id="submit" icon="ui-icon-disk"
											actionListener="#{jJDevelopment.commit}"
											update=":form:messages,:form:tabView,:form:fileTree,:form:taskmessage,:form:commentmessage,startTaskPanel" />
									</p:column>
								</p:row>
							</p:panelGrid></td>
						<td><p:panel id="tabViewPanel"
								header="#{messages['dev.fileContent.panel']}"
								style="height:530px;width:700px;">
								<p:tabView id="tabView" effectDuration="fast"
									rendered="#{not empty jJDevelopment.files}"
									activeIndex="#{jJDevelopment.activeTabIndex}" effect="fade"
									scrollable="true" value="#{jJDevelopment.files}" var="tab">

									<p:ajax event="tabClose" listener="#{jJDevelopment.onCloseTab}"
										update=":form:tabViewPanel" />

									<p:ajax event="tabChange" update=":form:tabView" />

									<p:tab title="#{tab.title}" closable="true">

										<pe:codeMirror id="codeMirror" mode="#{tab.mode}"
											autoformat="true" widgetVar="myCodeMirror" theme="eclipse"
											value="#{tab.texte}" lineNumbers="true" tabSize="150"
											extraKeys="{ 'Ctrl-Space': function(cm) {CodeMirror.simpleHint(cm, CodeMirror.javascriptHint);}}">
											<p:ajax event="blur" update=":form:tabView:codeMirror"
												listener="#{jJDevelopment.valueChangeHandlerCodeMirror}">
												<f:attribute name="fileMapValue" value="#{tab}" />
											</p:ajax>
										</pe:codeMirror>
										<!-- 										<p:inputTextarea id="textArea" rows="27" cols="88" -->
										<!-- 											autoResize="false" scrollHeight="28" value="#{tab.texte}" /> -->
									</p:tab>
								</p:tabView>
							</p:panel></td>
					</tr>
				</table>

				<p:blockUI block="form" trigger=":form:submit">  
        				#{messages['dev.block.commit.label']}<br />
					<p:graphicImage library="images" name="ajax-loader.gif" />
				</p:blockUI>
				<p:blockUI block="form" trigger=":form:fetchFromRepo">  
        				#{messages['dev.block.fetch.label']}<br />
					<p:graphicImage library="images" name="ajax-loader.gif" />
				</p:blockUI>
				<p:blockUI block="form" trigger=":headerForm:projectSelectOneMenu">
					#{messages['dev.block.update.label']}<br />
					<p:graphicImage library="images" name="ajax-loader.gif" />
				</p:blockUI>

			</h:form>
			<p:confirmDialog id="deletFileDialog"
				widgetVar="deleteFileDialogWidget"
				message="#{messages['dev.deletFileDialog.title']}" showEffect="fade"
				hideEffect="explode"
				header="#{messages['dev.deletFileDialog.header']}" severity="alarm">

				<p:outputPanel id="deletePanel">
					<h:form id="deleteForm">
						<p:commandButton id="deleteYesButton"
							value="#{messages.label_yes}"
							action="#{jJDevelopment.deleteFile}" update=":form"
							oncomplete="PF('deleteFileDialogWidget').hide()" />
						<p:commandButton id="deleteNoButton" value="#{messages.label_no}"
							onclick="PF('deleteFileDialogWidget').hide()" type="button" />
					</h:form>
				</p:outputPanel>
			</p:confirmDialog>
			<p:confirmDialog id="commitFileDialog"
				widgetVar="commitFileDialogWidget"
				message="#{messages['dev.commitFileDialog.title']}"
				showEffect="fade" hideEffect="explode"
				header="#{messages['dev.commitFileDialog.header']}" severity="alarm">
				<p:outputPanel id="commitPanel">
					<h:form id="commitForm">
						<p:commandButton id="commitYesButton"
							value="#{messages.label_yes}"
							action="#{jJDevelopment.commitFile}" update=":form"
							oncomplete="PF('commitFileDialogWidget').hide()" />
						<p:commandButton id="commitNoButton" value="#{messages.label_no}"
							onclick="PF('commitFileDialogWidget').hide()" type="button" />
					</h:form>
				</p:outputPanel>
			</p:confirmDialog>

			<p:confirmDialog id="saveFileDialog" widgetVar="saveFileDialogWidget"
				message="#{messages['dev.saveFileDialog.title']}" showEffect="fade"
				hideEffect="explode"
				header="#{messages['dev.saveFileDialog.header']}" severity="alarm">
				<p:outputPanel id="savePanel">
					<h:form id="saveForm">
						<p:commandButton id="saveYesButton" value="#{messages.label_yes}"
							action="#{jJDevelopment.saveFile}" update=":form:tabViewPanel" />
						<p:commandButton id="saveNoButton" value="#{messages.label_no}"
							action="#{jJDevelopment.notSaveFile}" update=":form:tabViewPanel" />
					</h:form>
				</p:outputPanel>
			</p:confirmDialog>

			<p:dialog id="createFileDialog" header="#{messages.label_create}"
				widgetVar="createFileDialogWidget" resizable="true"
				showEffect="fade" hideEffect="explode">
				<p:outputPanel id="createFilePanel">
					<h:form id="createFileForm">
						<h:panelGrid columns="2" styleClass="dialog">
							<p:outputLabel for="fileName" value="Nom :" />
							<p:inputText id="fileName"
								value="#{jJDevelopment.createdFileName}" required="true" />
							<p:outputLabel for="fileType" value="Type :" />
							<p:selectBooleanButton id="fileType"
								value="#{jJDevelopment.fileOrFolder}" onLabel="File"
								offLabel="Folder" onIcon="ui-icon-document"
								offIcon="ui-icon-folder-collapsed">
							</p:selectBooleanButton>
							<p:commandButton id="createSaveButton"
								value="#{messages.label_save}" update=":form,"
								action="#{jJDevelopment.CreateFile}" />
							<p:commandButton id="createCloseButton"
								value="#{messages.label_close}"
								onclick="PF('createFileDialogWidget').hide()" type="button" />
						</h:panelGrid>
					</h:form>
				</p:outputPanel>
			</p:dialog>

			<p:dialog id="viewTaskDialog" header="#{messages.label_view} JJTask"
				modal="true" widgetVar="viewTaskDialogWidget" dynamic="true"
				resizable="true" maximizable="true" showEffect="fade"
				hideEffect="explode" draggable="false">
				<p:outputPanel id="viewTaskPanel">
					<h:form id="viewTaskForm" enctype="multipart/form-data">
						<ui:include src="taskDialog.xhtml">
							<ui:param name="JJTask_" value="#{jJDevelopment.task}" />
						</ui:include>
						<p:commandButton id="viewCloseButton"
							value="#{messages.label_close}"
							onclick="PF('viewTaskDialogWidget').hide()" type="button" />
					</h:form>
				</p:outputPanel>
			</p:dialog>

			<p:dialog id="uploadFileDialog"
				header="#{messages['dev.uploadFileDialog.title']}"
				widgetVar="uploadFileDialogWidget" resizable="true"
				showEffect="fade" hideEffect="explode">
				<p:outputPanel id="uploadFilePanel">
					<h:form id="uploadFileForm">
						<p:fileUpload id="uploadFileButton"
							fileUploadListener="#{jJDevelopment.handleFileUpload}"
							mode="advanced" dragDropSupport="false" update=":form"
							sizeLimit="1000000" fileLimit="4" />
					</h:form>
				</p:outputPanel>
			</p:dialog>
			<p:blockUI block=":devPanel"
				trigger=":uploadFileForm:uploadFileButton">  
        				#{messages['dev.block.upload.label']}<br />
				<p:graphicImage library="images" name="ajax-loader.gif" />
			</p:blockUI>
			<p:blockUI block=":devPanel"
				trigger=":createFileForm:createSaveButton">  
        				#{messages['dev.block.create.label']}<br />
				<p:graphicImage library="images" name="ajax-loader.gif" />
			</p:blockUI>
			<p:blockUI block=":devPanel" trigger=":commitForm:commitYesButton">  
        				#{messages['dev.block.commit.label']}<br />
				<p:graphicImage library="images" name="ajax-loader.gif" />
			</p:blockUI>
		</p:panel>
		<p:hotkey bind="esc" handler="PF('videoHelpWidget').hide()" />
		<p:dialog id="videoHelpDialog" widgetVar="videoHelpWidget"
			position="center" header="#{messages.specification_video_help_title}"
			style="padding:0px;" resizable="false" draggable="false"
			minHeight="500" minWidth="500" showEffect="fade" hideEffect="fade">
			<video width="100%" height="100%" controls="true">
				<source src="https://www.starit.fr/jjtraining.mp4" type="video/mp4" />
			</video>
		</p:dialog>
		<p:blockUI block=":devPanel"
			trigger=":headerForm:versionSelectOneMenu"
			rendered="#{jJDevelopment.render}">
			#{messages['dev.block.render.label']}<br />
			<p:graphicImage library="images" name="ajax-loader.gif" />
		</p:blockUI>

		<p:blockUI block=":errorPanel"
			trigger=":headerForm:versionSelectOneMenu"
			rendered="#{!jJDevelopment.render}">
			#{messages['dev.block.error.label']}<br />
			<p:graphicImage library="images" name="ajax-loader.gif" />
		</p:blockUI>

	</ui:define>
	<ui:define name="outer">
		<center>
			<ui:insert name="highlight">
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shCore.js"></script>

				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushXml.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushJava.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushCss.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushJScript.js"></script>
				<script type="text/javascript">
					dp.SyntaxHighlighter.ClipboardSwf = '\#{request.contextPath}/syntaxhighlighter/clipboard.swf';
					dp.SyntaxHighlighter.HighlightAll('code');
				</script>
			</ui:insert>
		</center>
	</ui:define>
</ui:composition>
</html>

