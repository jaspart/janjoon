<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/layout.xhtml">
	<link type="text/css" rel="stylesheet"
		href="#{facesContext.externalContext.requestContextPath}/syntaxhighlighter/syntaxhighlighter.css" />
	<link type="text/css" rel="stylesheet"
		href="/syntaxhighlighter/standard.css" />
	<ui:define name="content">
		<center>
			<p:tabMenu activeIndex="3" name="content">
				<ui:include src="/templates/menu.xhtml" />
			</p:tabMenu>
			<br />
			<p:panel header="Error" style="width: 90%;valign: top;"
				rendered="#{!jJDevelopment.render}">
				<H1>Product not available on the version control manager.</H1>
			</p:panel>
			<p:panel header="#{jJDevelopment.product.name}"
				style="width: 90%;valign: top;" rendered="#{jJDevelopment.render}">
				<h:link value="TestWith CodeMirror" outcome="development2" />

				<h:form id="form">
					<table class="mytable">

						<tr>
							<td valign="top"><p:outputLabel for="taskSelectOneMenu"
									value="Task :" /> <p:selectOneMenu id="taskSelectOneMenu"
									value="#{jJDevelopment.task}" panelStyle="width:150px"
									effect="fold" editable="false" style="width:160px"
									required="true" requiredMessage="Select task to commit">
									<f:selectItem itemValue="#{null}" itemLabel="-- select one --" />
									<f:selectItems value="#{jJDevelopment.tasks}" var="t"
										itemLabel="#{t.name}" itemValue="#{t}" />
									<f:converter
										converterId="com.starit.janjoonweb.ui.mb.converter.JJTaskConverter" />

								</p:selectOneMenu> <p:message for="taskSelectOneMenu" id="taskmessage"
									closable="true" /> <p:growl id="messages" showDetail="true" />
									<p:panel header="Project Explorer" style="height:500px;" >
									<p:scrollPanel  style="height:250px;" mode="native">
									
								<p:tree id="fileTree" value="#{jJDevelopment.tree}" var="file"
									animate="true" selection="#{jJDevelopment.selectedTree}"
									selectionMode="single"  >
									<p:ajax event="select" update=":form:messages,:form:tabView"
										listener="#{jJDevelopment.onSelectTree}" />
									<p:treeNode type="folder" expandedIcon="ui-icon-folder-open"
										collapsedIcon="ui-icon-folder-collapsed">
										<h:outputText value="#{file.name}" />
									</p:treeNode>
									<p:treeNode type="file" icon="ui-icon-document">
										<h:outputText value="#{file.name}" />
									</p:treeNode>
								</p:tree>
								</p:scrollPanel> 
								<br/>
								<p:outputLabel for="textMess" value="Comment : " />	
								<p:inputTextarea id="textMess" value="#{jJDevelopment.comment}" required="true"
								 requiredMessage="Set Comment to commit" rows="12" cols="37" autoResize="false"/>		
								 <p:message for="textMess" id="commentmessage" closable="true" />					
								</p:panel>
								</td>				

							<td><p:panel header="File Content" style="height:530px;width:700px;valign:center;" >

									<p:tabView id="tabView"
										activeIndex="#{jJDevelopment.activeTabIndex}"
										binding="#{jJDevelopment.tabView}" scrollable="true"
										value="#{jJDevelopment.files}" var="tab" style="">
										<p:ajax event="tabClose"
											listener="#{jJDevelopment.onCloseTab}" />
										<p:ajax event="tabChange"
											listener="#{jJDevelopment.onChangeTab}" />
										<p:tab title="#{tab.title}" closable="true">
											<p:inputTextarea id="textArea" rows="27" cols="88" autoResize="false" scrollHeight="28"
												value="#{tab.texte}">
												<p:ajax event="blur"
													listener="#{jJDevelopment.valueChangeHandler}" />
											</p:inputTextarea>
										</p:tab>

									</p:tabView>
								</p:panel>
								</td>
						</tr>
						<tr>
							<td><p:selectBooleanCheckbox value="#{jJDevelopment.check}"
									id="Marcasdone" /> <h:outputLabel value="Marc as done"
									for="Marcasdone" /> <br /></td>
							<td><p:commandButton value="UpdateToHead" id="fetchFromRepo" immediate="true"
									icon="ui-icon-disk" actionListener="#{jJDevelopment.pull}"
									update=":form:messages,:form:tabView,:form:fileTree,:form" /></td>
						</tr>
						<tr>
							<td><p:commandButton value="Commit" id="submit"
									icon="ui-icon-disk" actionListener="#{jJDevelopment.commit}"
									update=":form:messages,:form:tabView,:form:fileTree,:form:taskmessage" /></td>

							<td><p:commandButton id="showDialogButton" type="button"
									value="CreateMessage" onclick="PF('dlg').show()" /></td>

						</tr>

					</table>
				<p:growl id="grow" showDetail="true" life="3000" />

					<p:dialog id="dialog" header="Create Message" widgetVar="dlg"
						resizable="false">

						<h:panelGrid columns="2" cellpadding="5">
							<p:outputLabel for="name" value="Name:" />
							<p:inputText value="#{jJDevelopment.message.name}" id="name"
								 label="name" />

							<p:outputLabel for="description" value="Description:" />
							<p:inputText value="#{jJDevelopment.message.description}"
								id="description" label="description" />

							<p:outputLabel for="message" value="Message:" />
							<p:inputText value="#{jJDevelopment.message.message}"
								id="message" label="message" />


							<f:facet name="footer">
								<p:commandButton id="loginButton" value="Login" update="grow"
									actionListener="#{jJDevelopment.PersistMessage}"
									oncomplete="handleLoginRequest(xhr, status, args)" />
							</f:facet>
						</h:panelGrid>

					</p:dialog>
				</h:form>
				
				<script type="text/javascript">  
    			function handleLoginRequest(xhr, status, args) {  
        			if(args.validationFailed || !args.loggedIn) {  
            				PF('dlg').jq.effect("shake", { times:5 }, 100);  
        						}   
        			else {  
           					 PF('dlg').hide();  
            				$('#showDialogButton').fadeOut();  
        					}  
    					}  
				</script>

				<p:blockUI block="form" trigger=":form:submit">  
        				LOADING<br />
					<p:graphicImage library="images" name="ajax-loader1.gif" />
				</p:blockUI>
				<p:blockUI block="form" trigger=":form:fetchFromRepo">  
        				LOADING<br />
					<p:graphicImage library="images" name="ajax-loader1.gif" />
				</p:blockUI>
			</p:panel>
		</center>
	</ui:define>
	<ui:define name="outer">
		<center>
			<ui:insert name="highlight">
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shCore.js"></script>
				
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushXml.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushJava.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushCss.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushJScript.js"></script>
				<script type="text/javascript">
					dp.SyntaxHighlighter.ClipboardSwf = '\#{request.contextPath}/syntaxhighlighter/clipboard.swf';
					dp.SyntaxHighlighter.HighlightAll('code');
				</script>
			</ui:insert>
		</center>
	</ui:define>
</ui:composition>
</html>
