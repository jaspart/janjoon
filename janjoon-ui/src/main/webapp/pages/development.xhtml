<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/layout.xhtml">
	<link type="text/css" rel="stylesheet"
		href="#{facesContext.externalContext.requestContextPath}/syntaxhighlighter/syntaxhighlighter.css" />
	<link type="text/css" rel="stylesheet"
		href="/syntaxhighlighter/standard.css" />
	<ui:define name="content">
		<!--center-->
		<!--p:tabMenu activeIndex="3" name="content">
		<ui:include src="/templates/menu.xhtml" />
		</p:tabMenu->
		<br /-->
		<p:panel header="Error" rendered="#{!jJDevelopment.render}">
			<H1>Product not available on the version control manager.</H1>
		</p:panel>
		<p:panel header="#{jJDevelopment.product.name}" rendered="#{jJDevelopment.render}">
			<!--h:link value="TestWith TexteArea" outcome="development" /-->
			<h:form id="form">
			<table class="mytable"><tr><td valign="top">
				<p:panelGrid style="margin-top:10px">
					<p:row>
						<p:column>
							<h:outputText for="taskSelectOneMenu" value="Task :" />
							<p:selectOneMenu id="taskSelectOneMenu"
								value="#{jJDevelopment.task}" panelStyle="width:150px"
								effect="fold" editable="false" style="width:160px"
								required="true" requiredMessage="Select task to commit">
							<f:selectItem itemValue="#{null}" itemLabel="-- select one --" />
							<f:selectItems value="#{jJDevelopment.tasks}" var="t"
								itemLabel="#{t.name}" itemValue="#{t}" />
							<f:converter
								converterId="com.starit.janjoonweb.ui.mb.converter.JJTaskConverter" />
							<f:ajax event="valueChange"
								listener="#{jJDevelopment.taskValueChangeListener}" />
							</p:selectOneMenu>
							<p:message for="taskSelectOneMenu" id="taskmessage" closable="true" />
							<p:growl id="messages" showDetail="true" />
						</p:column>
						<p:column>
							<p:commandButton value="update" id="fetchFromRepo"
								icon="ui-icon-refresh" actionListener="#{jJDevelopment.pull}"
								update=":form:messages,:form:tabView,:form:fileTree" />
						</p:column>
					</p:row>
					<p:row>
						<p:column colspan="2">
							<p:panel header="Project Explorer">
							<p:scrollPanel style="height:350px;" mode="native">
							<p:tree id="fileTree" value="#{jJDevelopment.tree}" var="file"
								animate="true" selection="#{jJDevelopment.selectedTree}"
								selectionMode="single">
								<p:ajax event="select" update=":form:messages,:form:tabView"
									listener="#{jJDevelopment.onSelectTree}" />
								<p:treeNode type="folder" expandedIcon="ui-icon-folder-open"
									collapsedIcon="ui-icon-folder-collapsed">
									<h:outputText value="#{file.name}" />
								</p:treeNode>
								<p:treeNode type="file" icon="ui-icon-document">
									<h:outputText value="#{file.name}" />
								</p:treeNode>
							</p:tree>
							</p:scrollPanel>
							</p:panel>
						</p:column>
					</p:row>
					<p:row>
						<p:column colspan="2">
							<p:outputLabel for="textMess" value="Comment : " />
							<p:inputTextarea id="textMess" value="#{jJDevelopment.comment}"
								required="true" requiredMessage="Set Comment to commit"
								rows="2" cols="36" autoResize="false" />
							<p:message for="textMess" id="commentmessage" closable="true" />
						</p:column>
					</p:row>
					<p:row>
						<p:column>
							<p:selectBooleanCheckbox value="#{jJDevelopment.check}" id="Markasdone" />
							<h:outputLabel value=" Mark as done" for="Markasdone" />
						</p:column>
						<p:column>
							<p:commandButton value="Commit" id="submit"
								icon="ui-icon-disk" actionListener="#{jJDevelopment.commit}"
								update=":form:messages,:form:tabView,:form:fileTree,:form:taskmessage" />
						</p:column>
					</p:row>
				</p:panelGrid>
			</td><td>
				<p:panel header="#{jJDevelopment.file.name}"
					style="height:430px;width:700px;">
					<p:tabView id="tabView" cache="true" effect="Fade" style=""
						effectDuration="slow"
						activeIndex="#{jJDevelopment.activeTabIndex}"
						binding="#{jJDevelopment.tabView}" scrollable="true"
						value="#{jJDevelopment.files}" var="tab">
						<p:ajax event="tabClose"
							listener="#{jJDevelopment.onCloseTab}" update=":form:tabView" />
						<p:ajax event="tabChange"
							listener="#{jJDevelopment.onChangeTab}"
							update=":form:tabView" />
						<p:tab title="#{tab.title}" closable="true">
							<pe:codeMirror id="codeMirror1" mode="javaScript"
								widgetVar="myCodeMirror" theme="eclipse"
								value="#{tab.texte}" lineNumbers="true"
								extraKeys="{ 'Ctrl-Space': function(cm) {CodeMirror.simpleHint(cm, CodeMirror.javascriptHint);}}"
								tabSize="100">
								<p:ajax event="blur"
									listener="#{jJDevelopment.valueChangeHandlerCodeMirror}" />
							</pe:codeMirror>
						</p:tab>
					</p:tabView>
				</p:panel>
			</td></tr></table>
				<p:growl id="grow" showDetail="true" life="3000" />
				<p:dialog id="dialog" header="Create Message" widgetVar="dlg"
					resizable="false">
					<h:panelGrid columns="2" cellpadding="5">
					<p:outputLabel for="name" value="Name:" />
						<p:inputText value="#{jJDevelopment.message.name}" id="name"
							label="name" />

						<p:outputLabel for="description" value="Description:" />
						<p:inputText value="#{jJDevelopment.message.description}"
							id="description" label="description" />
						<p:outputLabel for="message" value="Message:" />
						<p:inputText value="#{jJDevelopment.message.message}"
							id="message" label="message" />

						<f:facet name="footer">
							<p:commandButton id="loginButton" value="Login" update="grow"
							actionListener="#{jJDevelopment.PersistMessage}"
							oncomplete="handleLoginRequest(xhr, status, args)" />
						</f:facet>
					</h:panelGrid>
				</p:dialog>
			</h:form>
		<script type="text/javascript">  
			function handleLoginRequest(xhr, status, args) {  
       			if(args.validationFailed || !args.loggedIn) {  
           				PF('dlg').jq.effect("shake", { times:5 }, 100);  
        						}   
        			else {  
           				PF('dlg').hide();  
            				$('#showDialogButton').fadeOut();  
        			}  
    			}  
		</script>
		<p:blockUI block="form" trigger=":form:submit">  
        		LOADING<br />
			<p:graphicImage library="images" name="ajax-loader1.gif" />
		</p:blockUI>
		<p:blockUI block="form" trigger=":form:fetchFromRepo">  
        		LOADING<br />
			<p:graphicImage library="images" name="ajax-loader1.gif" />
		</p:blockUI>
		</p:panel>
		<!--/center-->
	</ui:define>
	<ui:define name="outer">
		<center>
			<ui:insert name="highlight">
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shCore.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushXml.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushJava.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushCss.js"></script>
				<script type="text/javascript"
					src="#{request.contextPath}/syntaxhighlighter/shBrushJScript.js"></script>
				<script type="text/javascript">
					dp.SyntaxHighlighter.ClipboardSwf = '\#{request.contextPath}/syntaxhighlighter/clipboard.swf';
					dp.SyntaxHighlighter.HighlightAll('code');
				</script>
			</ui:insert>
		</center>
	</ui:define>
</ui:composition>
</html>