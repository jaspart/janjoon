<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

<ui:composition template="../templates/layout.xhtml">

	<ui:define name="content">
		<h:outputScript library="js" name="ckEditor.js" />

		<h:form id="categoryForm">
			<ui:repeat value="#{jJRequirementBean.categoryList}" var="category">
				<p:commandButton value="#{category.name}" update=":specForm @form"
					action="#{jJRequirementBean.updateTemplate(category.id)}"
					onstart="PF('blockUIWidget').block()"
					oncomplete="PF('blockUIWidget').unblock()" />
			</ui:repeat>
			<p:commandButton value="#{messages.specification_import_button}"
				style="float: right;" disabled="#{jJRequirementBean.disabledExport}"
				actionListener="#{jJRequirementBean.loadImportFormat()}"
				update=":requirementImportDialog"
				onstart="PF('blockUIWidget').block()"
				oncomplete="PF('blockUIWidget').unblock();PF('requirementImportDialogWidget').show()" />

			<p:commandButton id="reloadBtn" icon="ui-icon-refresh" onstart="PF('blockUIWidget').block()"				
				style="float: right;" actionListener="#{jJRequirementBean.reloadPage}" />
				
			<p:commandButton id="colorBtn" icon="ui-icon-info" type="button"
				style="float: right;" />
			<p:overlayPanel id="colorPanel" for="colorBtn" hideEffect="fade"
				dynamic="true" style="width:600px">
				<p:panelGrid>
					<f:facet name="header">
						<p:row>
							<p:column colspan="12">Code des Couleurs</p:column>
						</p:row>
					</f:facet>
					<p:row>
						<p:column colspan="2" styleClass="RequirementNotLinked">
							<p:outputLabel value="Exigence sans liens haut ou bas" />
						</p:column>

						<p:column colspan="2" styleClass="RequirementNoTask">
							<p:outputLabel value="Exigence sans tache" />
						</p:column>

						<p:column colspan="2" styleClass="RequirementInProcess">
							<p:outputLabel value="Exigence en cours d'execution" />
						</p:column>

						<p:column colspan="2" styleClass="RequirementFinishedTestProcess">
							<p:outputLabel
								value="Exigence avec taches termines et tests en cours" />
						</p:column>

						<p:column colspan="2" styleClass="RequirementFinishedSuccessed">
							<p:outputLabel
								value="Exigence avec taches et tests termines avec succes" />
						</p:column>
					</p:row>
				</p:panelGrid>
			</p:overlayPanel>		
		</h:form>
		<h:form id="specForm" style="overflow:hidden;width:100%">
		<ui:repeat value="#{jJRequirementBean.tableDataModelList}" var="tableDataModel" varStatus="loop">
				<div style="width:#{jJRequirementBean.tableDataModelSizePct};float:left;">	
					<p:dataTable id="categoryTable" var="reqUtil"
						value="#{tableDataModel}" scrollable="true" scrollHeight="300"
						sortMode="multiple" resizableColumns="true"
						rowStyleClass="#{reqUtil.style}"
						filteredValue="#{tableDataModel.filtredRequirements}"
						rowKey="#{reqUtil.requirement.id}"
						rendered="#{tableDataModel.rendered}" selectionMode="single"
						widgetVar="dataTable_#{loop.index}_Widget">
						<p:ajax event="rowDblselect" onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock();PF('requirementDialogWidget').show()"
							update=":requirementDialog"
							disabled="#{!loginBean.authorisationService.wRequiement}"
							listener="#{jJRequirementBean.onRowDblClckSelect}" />

						<f:facet name="header">
							<h:outputText value="#{tableDataModel.nameDataModel}" />
							<p:panelGrid>
								<f:facet name="header">
									<p:row>
										<p:column colspan="1">
											<p:commandButton id="manageChapterButton"
												icon="ui-icon-document" title="#{jJChapterBean.warnMessage}"
												update=":chapterDialog"
												disabled="#{jJChapterBean.disabledChapter}"
												actionListener="#{jJChapterBean.loadData(tableDataModel.categoryId)}"
												onstart="PF('blockUIWidget').block()"
												oncomplete="PF('blockUIWidget').unblock();PF('chapterDialogWidget').show()" />
										</p:column>
										<p:column colspan="1">
											<p:commandButton id="releaseRequirementButton"
												icon=".ui-icon-carat-2-n-s" title="Release All Requirements"
												actionListener="#{jJRequirementBean.preReleaseRequirement(tableDataModel.categoryId)}"
												oncomplete="PF('requirementReleaseDialogWidget').show()" />
										</p:column>
										<p:column colspan="3">
											<p:inputText id="globalFilter" style="width:100%"
												onkeyup="dataTable_#{loop.index}_Widget.filter()" />
										</p:column>
										<p:column colspan="1">
											<p:commandButton id="newRequirementButton"
												icon="ui-icon-plus" title="#{loginBean.authorisationService.wRequiementMSG}"
												disabled="#{jJRequirementBean.disabledRequirement or !loginBean.authorisationService.wRequiement}"
												actionListener="#{jJRequirementBean.newRequirement(tableDataModel.categoryId)}"
												update=":requirementDialog"
												onstart="PF('blockUIWidget').block()"
												oncomplete="PF('blockUIWidget').unblock();PF('requirementDialogWidget').show()" />
										</p:column>
										<p:column colspan="1">
											<p:selectBooleanButton id="mineSpec"
												value="#{tableDataModel.mine}" onLabel="Mine" offLabel="All"
												onIcon="ui-icon-check" offIcon="ui-icon-close">
												<p:ajax onstart="PF('blockUIWidget').block()"
													oncomplete="PF('blockUIWidget').unblock()"
													listener="#{jJRequirementBean.mineChangeEvent(tableDataModel)}"
													update=":specForm" />
											</p:selectBooleanButton>
										</p:column>
										<p:column colspan="1">
											<h:commandLink id="pdf"
												disabled="#{jJRequirementBean.disabledExport}"
												actionListener="#{jJChapterBean.updateCategoryId(tableDataModel.categoryId)}">
												<p:graphicImage value="/resources/images/pdf.png" />
												<p:dataExporter type="pdf" target="categoryTable"
													fileName="Document"
													preProcessor="#{jJChapterBean.preProcessPDF}" />
											</h:commandLink>
											<p:tooltip for="pdf" value="#{jJRequirementBean.warnMessage}"
												showEffect="fade" hideEffect="fade" />
										</p:column>
									</p:row>
								</f:facet>
							</p:panelGrid>
						</f:facet>

						<p:column rendered="false" exportable="false" filterBy="requirement.id"
							filterStyle="display:none" sortBy="requirement.id">
							<f:facet name="header">
								<h:outputText value="Id" />
							</f:facet>
							<h:outputText value="#{reqUtil.requirement.id}" />
						</p:column>

						<p:column filterBy="name" filterStyle="display:none" sortBy="requirement.id">
							<f:facet name="header">
								<h:outputText
									value="#{messages.specification_table_requirement_title}" />
							</f:facet>
							<h:outputText id="reqContent" value="#{reqUtil.requirement.name}" />
							<p:tooltip id="toolTipContent" for="reqContent" showEffect="clip"
								hideEffect="explode" style="width:300px">
								<p:panelGrid style="width:300px">
									<f:facet name="header">
										<p:row>
											<p:column>
												<h:outputText style="font-weight: bold;"
													value="Requirement: #{reqUtil.requirement.name}" />
											</p:column>
										</p:row>
									</f:facet>
									<p:row>
										<p:column>
											<p:outputLabel style="font-weight: bold;" for="tolDesc"
												value="Description :" />
											<br />
											<h:outputText id="tolDesc" readonly="true" escape="false"
												style="width:300px"
												value="#{reqUtil.requirement.description}" />
										</p:column>
									</p:row>
								</p:panelGrid>
							</p:tooltip>
						</p:column>

						<p:column filterBy="product.name" filterStyle="display:none"
							sortBy="requirement.product.name">
							<f:facet name="header">
								<h:outputText
									value="#{messages.specification_table_product_title}" />
							</f:facet>
							<h:outputText value="#{reqUtil.requirement.product.name}" />
						</p:column>

						<p:column filterBy="chapter.name" filterStyle="display:none"
							sortBy="requirement.chapter.name">
							<f:facet name="header">
								<h:outputText
									value="#{messages.specification_table_chapter_title}" />
							</f:facet>
							<h:outputText value="#{reqUtil.requirement.chapter.name}" />
						</p:column>

						<p:column exportable="false" styleClass="action-column">
							<f:facet name="header">
								<h:outputText value="Actions" />
							</f:facet>
							<p:splitButton id="viewButton" value="View" icon="ui-icon-search"
								onstart="PF('blockUIWidget').block()"
								action="#{jJRequirementBean.viewLinks()}"
								oncomplete="PF('blockUIWidget').unblock()" update=":specForm">
								<p:menuitem id="editButton" icon="ui-icon-pencil"
									action="#{jJRequirementBean.editRequirement()}"
									onstart="PF('blockUIWidget').block()"
									oncomplete="PF('blockUIWidget').unblock();PF('requirementDialogWidget').show()"
									update=":requirementDialog" value="Edit"
									disabled="#{jJRequirementBean.getDisabledEdit(reqUtil.requirement) or !loginBean.authorisationService.wRequiement}">
									<f:setPropertyActionListener value="#{reqUtil.requirement}"
										target="#{jJRequirementBean.requirement}" />
								</p:menuitem>
								<p:tooltip for="editButton" value="Edit" showEffect="fade"
									hideEffect="fade" />

								<p:menuitem id="mindMapButton" value="View ReqMap"
									icon="ui-icon-search" onstart="PF('blockUIWidget').block()"
									action="#{jJRequirementBean.initReqMindMap}"
									oncomplete="PF('blockUIWidget').unblock()"
									update=":mindMapForm">
									<f:setPropertyActionListener value="#{reqUtil.requirement}"
										target="#{jJRequirementBean.requirement}" />
								</p:menuitem>
								<p:tooltip for="mindMapButton" value="ReqMap" showEffect="fade"
									hideEffect="fade" />

								<p:menuitem id="deleteButton" icon="ui-icon-trash"
									oncomplete="PF('requirementDeleteDialogWidget').show()"
									value="Delete">
									<f:setPropertyActionListener value="#{reqUtil.requirement}"
										target="#{jJRequirementBean.requirement}" />
								</p:menuitem>
								<p:tooltip for="deleteButton" value="Delete" showEffect="fade"
									hideEffect="fade" />
								<f:setPropertyActionListener value="#{reqUtil.requirement}"
									target="#{jJRequirementBean.requirement}" />
							</p:splitButton>
						</p:column>
						<f:facet name="footer">
							<p:accordionPanel dynamic="true"
								activeIndex="#{tableDataModel.activeIndex}" cache="false">
								<p:ajax event="tabClose"
									listener="#{jJRequirementBean.onTabClose(tableDataModel.categoryId)}" />
								<p:ajax event="tabChange"
									listener="#{jJRequirementBean.calculateCovCom(tableDataModel.categoryId)}"
									onstart="PF('blockUIWidget').block()"
									oncomplete="PF('blockUIWidget').unblock()" />
								<p:tab title="#{messages.specification_progress_footer}">
									<p:row>
										<p:progressBar id="coverage"
											value="#{tableDataModel.coverageProgress}"
											labelTemplate="#{messages.specification_coverage_progress} {value}%"
											displayOnly="true" />
									</p:row>
									<p:row>
										<p:progressBar id="completion"
											value="#{tableDataModel.completionProgress}"
											labelTemplate="#{messages.specification_completion_progress} {value}%"
											displayOnly="true" />
									</p:row>
								</p:tab>
							</p:accordionPanel>
						</f:facet>
					</p:dataTable>
				</div>
			</ui:repeat>
		</h:form>

		<p:hotkey bind="esc" handler="PF('requirementDialogWidget').hide()" />
		<p:hotkey bind="alt+enter" handler="requirementSaveWidget.jq.click()" />
		<p:dialog id="requirementDialog" draggable="false"
			header="#{messages[jJRequirementBean.message]}" modal="true"
			widgetVar="requirementDialogWidget" dynamic="true" resizable="false"
			position="center" style="padding:0px;">
			<p:ajax event="close" listener="#{jJRequirementBean.closeDialog(false)}"
				 	onstart="PF('blockUIWidget').block()"
					oncomplete="PF('blockUIWidget').unblock()" />
			<p:outputPanel id="requirementDialogPanel">

				<pe:blockUI widgetVar="requirementBlockUIWidget"
					target="requirementDialogPanel">
					<h:panelGrid columns="2">
						<p:graphicImage library="images" name="ajax-loader.gif"
							style="vertical-align: middle;" />
						<h:outputText value="#{messages.label_refresh}"
							style="white-space: nowrap;" />
					</h:panelGrid>
				</pe:blockUI>

				<h:form id="requirementDialogForm" style="padding:0px;">
					<p:growl id="msg" />
					<p:scrollPanel mode="native">
						<p:panelGrid style="margin-top:0px">
							<p:row>
								<p:column>
									<p:inputText id="name"
										value="#{jJRequirementBean.requirement.name}" required="true"
										widgetVar="nameWidget"
										label="#{messages.specification_create_name_label}"
										requiredMessage="#{messages.specification_create_name_alert}" >
											<f:validateLength maximum="100" />
									</p:inputText>
									<p:watermark for="name"
										value="#{messages.specification_create_name_watermark}" />
								</p:column>
								<p:column>
									<h:outputText for="status"
										value="#{messages.specification_create_status_label}" />
									<!-- 									<p:selectOneMenu id="status" -->
									<!-- 										value="#{jJRequirementBean.requirementStatus}" required="true" -->
									<!-- 										requiredMessage="Requirement Status is a required value" -->
									<!-- 										panelStyle="width:150px" effect="fade" style="width:150px" -->
									<!-- 										filter="true" filterMatchMode="startsWith" -->
									<!-- 										disabled="#{jJRequirementBean.disabledStatus}"> -->
									<!-- 										<f:converter -->
									<!-- 											converterId="com.starit.janjoonweb.ui.mb.converter.JJStatusConverter" /> -->
									<!-- 										<f:selectItem -->
									<!-- 											itemLabel="#{jJRequirementBean.requirementStatus.name}" -->
									<!-- 											itemValue="#{jJRequirementBean.requirementStatus}" /> -->
									<!-- 										<f:selectItems -->
									<!-- 											value="#{jJRequirementBean.requirementStatusList}" var="c" -->
									<!-- 											itemLabel="#{c.name}" itemValue="#{c}" /> -->
									<!-- 										<p:ajax partialSubmit="true" -->
									<!-- 											listener="#{jJRequirementBean.handleSelectStatus()}" /> -->
									<!-- 									</p:selectOneMenu> -->
								</p:column>
								<p:column>
									<h:outputText for="project"
										value="#{messages.specification_create_project_label} *" />
									<p:selectOneMenu id="project"
										value="#{jJRequirementBean.requirementProject}"
										panelStyle="width:150px" effect="fade" style="width:150px"
										filter="true" filterMatchMode="startsWith"
										disabled="#{jJRequirementBean.disabledProject}"
										converter="com.starit.janjoonweb.ui.mb.converter.JJProjectConverter">

										<f:selectItems
											value="#{jJRequirementBean.requirementProjectList}" var="c"
											itemLabel="#{c.name}" itemValue="#{c}" />
										<p:ajax partialSubmit="true"
											onstart="PF('requirementBlockUIWidget').block()"
											oncomplete="PF('requirementBlockUIWidget').unblock()"
											update="lowRequirement mediumRequirement highRequirement chapter"
											listener="#{jJRequirementBean.handleSelectProject()}" />
									</p:selectOneMenu>
								</p:column>
							</p:row>
							<p:row>
								<p:column>
									<h:outputText for="product"
										value="#{messages.specification_create_product_label}" />
									<p:selectOneMenu id="product"
										value="#{jJRequirementBean.requirementProduct}"
										panelStyle="width:150px" effect="fade" style="width:150px"
										filter="true" filterMatchMode="startsWith"
										converter="com.starit.janjoonweb.ui.mb.converter.JJProductConverter">

										<f:selectItem itemValue="#{null}"
											itemLabel="#{messages.specification_create_select_label}" />
										<f:selectItems
											value="#{jJRequirementBean.requirementProductList}" var="c"
											itemLabel="#{c.name}" itemValue="#{c}" />
										<p:ajax partialSubmit="true" update="version"
											onstart="PF('requirementBlockUIWidget').block()"
											oncomplete="PF('requirementBlockUIWidget').unblock()"
											listener="#{jJRequirementBean.handleSelectProduct()}" />
									</p:selectOneMenu>
								</p:column>
								<p:column>
									<h:outputText for="version"
										value="#{messages.specification_create_version_label}" />
									<p:selectOneMenu id="version"
										value="#{jJRequirementBean.requirementVersion}"
										panelStyle="width:150px" effect="fade" style="width:150px"
										filter="true" filterMatchMode="startsWith"
										disabled="#{jJRequirementBean.disabledVersion}"
										converter="com.starit.janjoonweb.ui.mb.converter.JJVersionConverter">

										<f:selectItem itemValue="#{null}"
											itemLabel="#{messages.specification_create_select_label}" />
										<f:selectItems
											value="#{jJRequirementBean.requirementVersionList}" var="c"
											itemLabel="#{c.name}" itemValue="#{c}" />
										<p:ajax partialSubmit="true"
											listener="#{jJRequirementBean.handleSelectVersion()}" />
									</p:selectOneMenu>
								</p:column>
								<p:column>
									<h:outputText for="chapter"
										value="#{messages.specification_create_chapter_label}" />
									<p:selectOneMenu id="chapter"
										value="#{jJRequirementBean.requirementChapter}"
										panelStyle="width:150px" effect="fade" style="width:150px"
										filter="true" filterMatchMode="startsWith"
										converter="com.starit.janjoonweb.ui.mb.converter.JJChapterConverter">

										<f:selectItem itemValue="#{null}"
											itemLabel="#{messages.specification_create_select_label}" />
										<f:selectItems
											value="#{jJRequirementBean.requirementChapterList}" var="c"
											itemLabel="#{c.name}" itemValue="#{c}" />
										<p:ajax partialSubmit="true"
											listener="#{jJRequirementBean.handleSelectChapter()}" />
									</p:selectOneMenu>
								</p:column>
							</p:row>
							<p:row>
								<p:column>
									<p:selectCheckboxMenu id="lowRequirement"
										value="#{jJRequirementBean.selectedLowRequirementsList}"
										label="#{jJRequirementBean.lowCategoryName}" filter="true"
										filterText="Filter" filterMatchMode="contains"
										panelStyle="width:220px"
										converter="com.starit.janjoonweb.ui.mb.converter.JJRequirementConverter"
										disabled="#{jJRequirementBean.disabledLowRequirements}">
										<f:selectItems
											value="#{jJRequirementBean.lowRequirementsList}"
											var="requirement" itemLabel="#{requirement.name}"
											itemValue="#{requirement}" />
										<p:ajax listener="#{jJRequirementBean.handleChangeLow}" />
									</p:selectCheckboxMenu>
								</p:column>
								<p:column>
									<p:selectCheckboxMenu id="mediumRequirement"
										value="#{jJRequirementBean.selectedMediumRequirementsList}"
										label="#{jJRequirementBean.mediumCategoryName}" filter="true"
										filterText="Filter" filterMatchMode="contains"
										panelStyle="width:220px"
										converter="com.starit.janjoonweb.ui.mb.converter.JJRequirementConverter"
										disabled="#{jJRequirementBean.disabledMediumRequirements}">
										<f:selectItems
											value="#{jJRequirementBean.mediumRequirementsList}"
											var="requirement" itemLabel="#{requirement.name}"
											itemValue="#{requirement}" />
										<p:ajax listener="#{jJRequirementBean.handleChangeMedium}" />
									</p:selectCheckboxMenu>
								</p:column>
								<p:column>
									<p:selectCheckboxMenu id="highRequirement"
										value="#{jJRequirementBean.selectedHighRequirementsList}"
										label="#{jJRequirementBean.highCategoryName}" filter="true"
										filterText="Filter" filterMatchMode="contains"
										panelStyle="width:220px"
										converter="com.starit.janjoonweb.ui.mb.converter.JJRequirementConverter"
										disabled="#{jJRequirementBean.disabledHighRequirements}">
										<f:selectItems
											value="#{jJRequirementBean.highRequirementsList}"
											var="requirement" itemLabel="#{requirement.name}"
											itemValue="#{requirement}" />
										<p:ajax listener="#{jJRequirementBean.handleChangeHigh}" />
									</p:selectCheckboxMenu>
								</p:column>
							</p:row>
							<p:row>
								<p:column colspan="3">
									<h:outputText
										value="#{messages.specification_create_description_label}" />
									<pe:ckEditor id="description" widgetVar="descriptionWidget"
										toolbar="[['Bold','Italic','Underline','Strike','NumberedList','BulletedList','Image','TextColor','BGColor','Undo','Table']]"
										style="width:680px;height:150px;margin-left:auto;margin-right:auto;"
										customConfig="#{request.contextPath}/resources/js/ckEditor.js"
										value="#{jJRequirementBean.requirement.description}"
										required="true"
										requiredMessage="Requirement Description is a required value" />

									<p:message for="description" id="editorMessageId" />
									<!--h:outputLabel for="description" value="#{request.contextPath}" /-->
								</p:column>
							</p:row>
							<!--							<p:row>
								<p:column>
									<h:outputText
										value="#{messages.specification_create_initiate_label}" />
									<p:selectBooleanCheckbox
										value="#{jJRequirementBean.initiateTask}"
										disabled="#{jJRequirementBean.disabledInitTask}">
										<p:ajax listener="#{jJRequirementBean.loadTask()}"
											update="outputPanel completion" />
									</p:selectBooleanCheckbox>
								</p:column>
								<p:column>
									<h:outputLabel for="workload"
										value="#{messages.specification_create_workload_label}" />
									<p:outputPanel id="outputPanel">
										<p:spinner id="workload"
											value="#{jJRequirementBean.task.workloadPlanned}"
											stepFactor="1" min="0"
											disabled="#{jJRequirementBean.disabledTask}">
											<p:ajax update="workloadvalue" process="@this" />
										</p:spinner>
										<h:outputText id="workloadvalue"
											value="#{jJRequirementBean.task.workloadPlanned} #{messages.specification_create_increment_label}" />
									</p:outputPanel>
								</p:column>

								<p:column>
									<h:outputText
										value="#{messages.specification_create_completed_label}" />
									<p:selectBooleanCheckbox id="completion"
										value="#{jJRequirementBean.task.completed}"
										disabled="#{jJRequirementBean.disabledTask}">
										<p:ajax listener="#{jJRequirementBean.checkCompleteTask()}" />
									</p:selectBooleanCheckbox>
								</p:column>

							</p:row>-->
							<p:row>
								<p:column rowspan="3" colspan="3">
									<p:inputTextarea id="note" rows="3" cols="100"
										value="#{jJRequirementBean.requirement.note}"
										autoResize="false"
										style="width: 600px;margin-left:auto;margin-right:auto;" />
									<p:watermark for="note"
										value="#{messages.specification_create_note_watermark}" />
								</p:column>
							</p:row>
							<f:facet name="footer">
								<p:row>
									<p:column colspan="3">
										<p:commandButton
											value="#{messages.specification_create_save_button}"
											onstart="PF('requirementBlockUIWidget').block()"
											oncomplete="PF('requirementBlockUIWidget').unblock()"
											action="#{jJRequirementBean.save()}"
											widgetVar="requirementSaveWidget" update="@form :contentPanel" />
									</p:column>
								</p:row>
							</f:facet>
						</p:panelGrid>
					</p:scrollPanel>
				</h:form>
			</p:outputPanel>
		</p:dialog>

		<p:hotkey bind="esc" handler="PF('chapterDialogWidget').hide()" />
		<p:dialog id="chapterDialog"
			header="#{messages.specification_chapter_header}" modal="true"
			widgetVar="chapterDialogWidget" dynamic="true" resizable="false">
			<p:ajax event="close" update=":specForm"
				onstart="PF('blockUIWidget').block()"
				oncomplete="PF('blockUIWidget').unblock()"
				listener="#{jJChapterBean.closeDialog}" />
			<p:outputPanel id="chapterDialogPanel">

				<pe:blockUI widgetVar="chapterBlockUIWidget"
					target="chapterDialogPanel">
					<h:panelGrid columns="2">
						<p:graphicImage library="images" name="ajax-loader.gif"
							style="vertical-align: middle;" />
						<h:outputText value="#{messages.label_refresh}"
							style="white-space: nowrap;" />
					</h:panelGrid>
				</pe:blockUI>

				<h:form id="chapterDialogForm">
					<p:growl id="msg" sticky="true" />
					<p:scrollPanel style="width:760px;height:450px" mode="native">
						<p:panelGrid style="margin-top:10px">
							<p:row>
								<p:column>
									<p:inputText id="name" value="#{jJChapterBean.chapter.name}"
										required="true" widgetVar="nameWidget"
										label="#{message.specification_chapter_name_label}"
										requiredMessage="#{message.specification_chapter_name_alert}" >
										<f:validateLength maximum="100" />
									</p:inputText>
									<p:watermark for="name"
										value="#{messages.specification_create_name_watermark}" />
								</p:column>
								<p:column>
									<h:outputText for="parent"
										value="#{messages.specification_chapter_parent_label}" />
									<p:selectOneMenu id="parent"
										value="#{jJChapterBean.parentChapter}"
										panelStyle="width:150px" effect="fade" style="width:160px"
										filter="true" filterMatchMode="startsWith"
										widgetVar="parentWidget"
										converter="com.starit.janjoonweb.ui.mb.converter.JJChapterConverter">

										<f:selectItem itemValue="#{null}"
											itemLabel="#{messages.specification_create_select_label}" />
										<f:selectItems value="#{jJChapterBean.chapterList}" var="c"
											itemLabel="#{c.name}" itemValue="#{c}" />
										<p:ajax partialSubmit="true"
											onstart="PF('chapterBlockUIWidget').block()"
											oncomplete="PF('chapterBlockUIWidget').unblock()"
											listener="#{jJChapterBean.handleSelectParentChapter()}" />
									</p:selectOneMenu>
								</p:column>
							</p:row>
							<p:row>
								<p:column>
									<h:outputText
										value="#{messages.specification_chapter_description_label}" />
									<pe:ckEditor id="description" widgetVar="descriptionWidget"
										style="width:320px"
										customConfig="#{request.contextPath}/resources/js/ckEditor.js"
										toolbar="[['Bold','Italic','Underline','Strike','NumberedList','BulletedList','Image','TextColor','BGColor','Undo','Table']]"
										value="#{jJChapterBean.chapter.description}" required="true"
										requiredMessage="#{messages.specification_chapter_description_alert}" />
								</p:column>
								<p:column>
									<p:contextMenu for="chapterTreeSingle">
										<p:menuitem
											value="#{message.specification_chapter_edit_menuitem}"
											actionListener="#{jJChapterBean.editChapter()}"
											process="@this" icon="ui-icon-pencil"
											onstart="PF('chapterBlockUIWidget').block()"
											oncomplete="PF('chapterBlockUIWidget').unblock()"
											update="chapterDialogForm" />
										<p:menuitem
											value="#{message.specification_chapter_delete_menuitem}"
											actionListener="#{jJChapterBean.deleteChapter()}"
											process="@this" icon="ui-icon-close"
											onstart="PF('chapterBlockUIWidget').block()"
											oncomplete="PF('chapterBlockUIWidget').unblock()"
											update="chapterDialogForm" />
									</p:contextMenu>
									<h:outputText
										value="#{message.specification_chapter_tree_label}" />
									<p:tree id="chapterTreeSingle" style="width:320px"
										value="#{jJChapterBean.chapterRoot}" var="nodeChapter"
										selectionMode="single"
										selection="#{jJChapterBean.selectedChapterNode}"
										dynamic="true" cache="false">
										<p:ajax event="select"
											listener="#{jJChapterBean.onNodeSelect}" />
										<p:treeNode>
											<h:outputText value="#{nodeChapter}" />
										</p:treeNode>
									</p:tree>
								</p:column>
							</p:row>
							<f:facet name="footer">
								<p:row>
									<p:column colspan="3">
										<p:commandButton
											value="#{messages.specification_chapter_save_button}"
											action="#{jJChapterBean.save}"
											update="chapterDialogForm" style="float: right;"
											onstart="PF('chapterBlockUIWidget').block()"
											oncomplete="PF('chapterBlockUIWidget').unblock()" />
									</p:column>
								</p:row>
							</f:facet>
						</p:panelGrid>
						<p:panelGrid>
							<p:row>
								<p:column colspan="3">
									<p:scrollPanel style="height:250px;" mode="native">
										<p:tree id="leftTreeIncorporated"
											value="#{jJChapterBean.leftRoot}" var="nodeLeft"
											selectionMode="single"
											selection="#{jJChapterBean.selectedLeftNode}"
											draggable="true" droppable="true" dragdropScope="demo"
											cache="false">
											<p:ajax event="dragdrop"
												listener="#{jJChapterBean.onDragDrop}"
												update=":chapterDialogForm"
												onstart="PF('chapterBlockUIWidget').block()"
												oncomplete="PF('chapterBlockUIWidget').unblock()" />
											<p:treeNode>
												<h:outputText value="#{nodeLeft}" />
											</p:treeNode>
										</p:tree>
									</p:scrollPanel>
								</p:column>
								<p:column colspan="3">
									<p:graphicImage alt="Transfer" library="images"
										name="transfer.png" />
								</p:column>
								<p:column colspan="3">
									<p:scrollPanel style="height:250px;" mode="native">
										<p:tree id="RightTreeIncorporated"
											value="#{jJChapterBean.rightRoot}" var="nodeRight"
											selectionMode="single"
											selection="#{jJChapterBean.selectedRightNode}"
											draggable="true" droppable="true" dragdropScope="demo"
											cache="false">
											<p:ajax event="dragdrop"
												listener="#{jJChapterBean.onDragDrop}"
												update=":chapterDialogForm"
												onstart="PF('chapterBlockUIWidget').block()"
												oncomplete="PF('chapterBlockUIWidget').unblock()" />
											<p:treeNode>
												<h:outputText value="#{nodeRight}" />
											</p:treeNode>
										</p:tree>
									</p:scrollPanel>
								</p:column>
							</p:row>
						</p:panelGrid>
					</p:scrollPanel>
				</h:form>
			</p:outputPanel>
		</p:dialog>

		<p:confirmDialog id="requirementDeleteDialog"
			header="#{messages.specification_delete_title}"
			message="#{messages.specification_delete_label}"
			widgetVar="requirementDeleteDialogWidget" showEffect="fade"
			hideEffect="fade" severity="alarm">
			<p:outputPanel id="requirementDeletePanel">
				<h:form id="requirementDeleteForm">
					<p:commandButton id="deleteYesButton"
						value="#{messages.specification_delete_yes_button}"
						action="#{jJRequirementBean.deleteRequirement}" update=":specForm"
						onstart="PF('requirementDeleteDialogWidget').hide();PF('blockUIWidget').block()"
						oncomplete="PF('blockUIWidget').unblock()" />
					<p:commandButton id="deleteNoButton"
						value="#{messages.specification_delete_no_button}"
						onclick="PF('requirementDeleteDialogWidget').hide()" type="button" />
				</h:form>
			</p:outputPanel>
		</p:confirmDialog>

		<p:confirmDialog id="requirementReleaseDialog"
			header="#{messages.specification_release_title}"
			message="#{messages.specification_release_label}"
			widgetVar="requirementReleaseDialogWidget" showEffect="fade"
			hideEffect="fade" severity="alarm">
			<p:outputPanel id="requirementReleasePanel">
				<h:form id="requirementReleaseForm">
					<p:commandButton id="releaseYesButton"
						value="#{messages.specification_release_yes_button}"
						action="#{jJRequirementBean.releaseRequirement}"
						update=":specForm"
						onstart="PF('requirementReleaseDialogWidget').hide();PF('blockUIWidget').block()"
						oncomplete="PF('blockUIWidget').unblock()" />
					<p:commandButton id="releaseNoButton"
						value="#{messages.specification_release_no_button}"
						onclick="PF('requirementReleaseDialogWidget').hide()" type="button" />
				</h:form>
			</p:outputPanel>
		</p:confirmDialog>

		<p:hotkey bind="esc" handler="PF('requirementImportDialogWidget').hide()" />
		<p:dialog id="requirementImportDialog"
			header="#{messages.specification_import_title}" modal="true"
			widgetVar="requirementImportDialogWidget" dynamic="true"
			resizable="false">
			<p:ajax event="close" onstart="PF('blockUIWidget').block()"
				oncomplete="PF('blockUIWidget').unblock()"
				listener="#{jJRequirementBean.closeDialogImport}" />
			<p:layout style="min-width:510px;min-height:510px;">
				<p:layoutUnit position="center">
					<p:outputPanel id="importPanel">

						<pe:blockUI widgetVar="importBlockUIWidget" target="importPanel">
							<h:panelGrid columns="2">
								<p:graphicImage library="images" name="ajax-loader.gif"
									style="vertical-align: middle;" />
								<h:outputText value="#{messages.label_refresh}"
									style="white-space: nowrap;" />
							</h:panelGrid>
						</pe:blockUI>

						<h:form id="importForm">
							<p:panelGrid>
								<p:row>
									<p:column>
										<h:outputText
											value="#{messages.specification_import_project_label}" />
										<p:selectOneMenu id="projectSelectOneMenu"
											value="#{jJRequirementBean.importProject}"
											panelStyle="width:150px" effect="fade" style="width:160px"
											filter="true" filterMatchMode="startsWith"
											converter="com.starit.janjoonweb.ui.mb.converter.JJProjectConverter">

											<f:selectItem itemValue="#{null}"
												itemLabel="#{messages.specification_import_select_label}" />
											<f:selectItems value="#{jJRequirementBean.importProjectList}"
												var="p" itemLabel="#{p.name}" itemValue="#{p}" />
											<p:ajax partialSubmit="true"
												onstart="PF('importBlockUIWidget').block()"
												oncomplete="PF('importBlockUIWidget').unblock()"
												listener="#{jJRequirementBean.handelSelectImportProject}"
												update="importDataTable :importForm:importButton" />
										</p:selectOneMenu>
									</p:column>
									<p:column>
										<h:outputText
											value="#{messages.specification_import_category_label}" />
										<p:selectOneMenu id="categorySelectOneMenu"
											value="#{jJRequirementBean.importCategory}"
											panelStyle="width:150px" effect="fade" style="width:160px"
											filter="true" filterMatchMode="startsWith"
											converter="com.starit.janjoonweb.ui.mb.converter.JJCategoryConverter">

											<f:selectItem itemValue="#{null}"
												itemLabel="#{messages.specification_import_select_label}" />
											<f:selectItems
												value="#{jJRequirementBean.importCategoryList}" var="p"
												itemLabel="#{p.name}" itemValue="#{p}" />
											<p:ajax partialSubmit="true"
												onstart="PF('importBlockUIWidget').block()"
												oncomplete="PF('importBlockUIWidget').unblock()"
												listener="#{jJRequirementBean.handelSelectImportCategory}"
												update="importDataTable :importForm:importButton" />
										</p:selectOneMenu>
									</p:column>

								</p:row>
								<p:row>

									<p:column>
										<h:outputText
											value="#{messages.specification_import_product_label}" />
										<p:selectOneMenu id="productSelectOneMenu"
											value="#{jJRequirementBean.importProduct}"
											panelStyle="width:150px" effect="fade" style="width:160px"
											filter="true" filterMatchMode="startsWith"
											converter="com.starit.janjoonweb.ui.mb.converter.JJProductConverter">

											<f:selectItem itemValue="#{null}"
												itemLabel="#{messages.specification_import_select_label}" />
											<f:selectItems value="#{jJRequirementBean.importProductList}"
												var="p" itemLabel="#{p.name}" itemValue="#{p}" />
											<p:ajax partialSubmit="true"
												onstart="PF('importBlockUIWidget').block()"
												oncomplete="PF('importBlockUIWidget').unblock()"
												listener="#{jJRequirementBean.handelSelectImportProduct}"
												update="importDataTable versionSelectOneMenu :importForm:importButton" />
										</p:selectOneMenu>
									</p:column>
									<p:column>
										<h:outputText
											value="#{messages.specification_import_version_label}" />
										<p:selectOneMenu id="versionSelectOneMenu"
											value="#{jJRequirementBean.importVersion}"
											panelStyle="width:150px" effect="fade" style="width:160px"
											filter="true" filterMatchMode="startsWith"
											disabled="#{jJRequirementBean.disableImportVersion}"
											converter="com.starit.janjoonweb.ui.mb.converter.JJVersionConverter">

											<f:selectItem itemValue="#{null}"
												itemLabel="#{messages.specification_import_select_label}" />
											<f:selectItems value="#{jJRequirementBean.importVersionList}"
												var="v" itemLabel="#{v.name}" itemValue="#{v}" />
											<p:ajax partialSubmit="true"
												onstart="PF('importBlockUIWidget').block()"
												oncomplete="PF('importBlockUIWidget').unblock()"
												listener="#{jJRequirementBean.handelSelectImportVersion}"
												update="importDataTable :importForm:importButton" />
										</p:selectOneMenu>
									</p:column>
								</p:row>
								<p:row>
									<p:column>
										<h:outputText
											value="#{messages.specification_import_status_label}" />
										<p:selectOneMenu id="statusSelectOneMenu"
											value="#{jJRequirementBean.importStatus}"
											panelStyle="width:150px" effect="fade" style="width:160px"
											filter="true" filterMatchMode="startsWith"
											converter="com.starit.janjoonweb.ui.mb.converter.JJStatusConverter">

											<f:selectItem itemValue="#{null}"
												itemLabel="#{messages.specification_import_select_label}" />
											<f:selectItems value="#{jJRequirementBean.importStatusList}"
												var="p" itemLabel="#{p.name}" itemValue="#{p}" />
											<p:ajax partialSubmit="true"
												onstart="PF('importBlockUIWidget').block()"
												oncomplete="PF('importBlockUIWidget').unblock()"
												listener="#{jJRequirementBean.handelSelectImportStatus}"
												update="importDataTable :importForm:importButton" />
										</p:selectOneMenu>
									</p:column>
								</p:row>
							</p:panelGrid>

							<p:dataTable id="importDataTable" var="format" scrollable="true"
								style="width:500px;" scrollHeight="300"
								value="#{jJRequirementBean.importFormats}">
								<f:facet name="header">
									<h:outputText
										value="#{messages.specification_import_table_title}" />
								</f:facet>

								<p:column style="width:30%">
									<f:facet name="header">
										<p:row>
											<p:column>
												<p:selectBooleanCheckbox
													value="#{jJRequirementBean.copyRequirements}">
													<p:ajax update="importDataTable :importForm:importButton"
														onstart="PF('importBlockUIWidget').block()"
														oncomplete="PF('importBlockUIWidget').unblock()"
														listener="#{jJRequirementBean.copyRequirements}" />
												</p:selectBooleanCheckbox>
											</p:column>
											<p:column>
												<h:outputText
													value="#{messages.specification_import_requirement_header}" />
											</p:column>
										</p:row>
									</f:facet>

									<p:selectBooleanCheckbox value="#{format.copyRequirement}">
										<p:ajax update="importDataTable :importForm:importButton"
											listener="#{jJRequirementBean.copyRequirement}" />
									</p:selectBooleanCheckbox>
									<h:outputText value="#{format.requirement.name}" />
								</p:column>
								<p:column style="width:30%">
									<f:facet name="header">
										<p:row>
											<p:column>
												<p:selectBooleanCheckbox
													value="#{jJRequirementBean.copyTestcases}">
													<p:ajax update="importDataTable"
														onstart="PF('importBlockUIWidget').block()"
														oncomplete="PF('importBlockUIWidget').unblock()"
														listener="#{jJRequirementBean.copyTestcases}" />
												</p:selectBooleanCheckbox>
											</p:column>
											<p:column>
												<h:outputText
													value="#{messages.specification_import_testcase_header}" />
											</p:column>
										</p:row>
									</f:facet>

									<p:selectBooleanCheckbox value="#{format.copyTestcase}">
										<p:ajax update="importDataTable"
											listener="#{jJRequirementBean.copyTestcase}" />
									</p:selectBooleanCheckbox>

								</p:column>
								<p:column style="width:30%">
									<f:facet name="header">
										<p:row>
											<p:column>
												<p:selectBooleanCheckbox
													value="#{jJRequirementBean.copyChapters}">
													<p:ajax update="importDataTable"
														onstart="PF('importBlockUIWidget').block()"
														oncomplete="PF('importBlockUIWidget').unblock()"
														listener="#{jJRequirementBean.copyChapters}" />
												</p:selectBooleanCheckbox>
											</p:column>
											<p:column>
												<h:outputText
													value="#{messages.specification_import_chapter_header}" />
											</p:column>
										</p:row>
									</f:facet>

									<p:selectBooleanCheckbox value="#{format.copyChapter}">
										<p:ajax update="importDataTable"
											listener="#{jJRequirementBean.copyChapter}" />
									</p:selectBooleanCheckbox>
								</p:column>
							</p:dataTable>
							<h3 style="margin-top: 0" />
							<p:commandButton id="importButton" value="Import"
								update=":specForm" onstart="PF('importBlockUIWidget').block()"
								oncomplete="PF('importBlockUIWidget').unblock()"
								style="float: right;"
								disabled="#{jJRequirementBean.disableImportButton}"
								action="#{jJRequirementBean.importRequirement()}" />
						</h:form>
					</p:outputPanel>
				</p:layoutUnit>
			</p:layout>
		</p:dialog>

		<p:dialog id="requirementMindMap"
			header="#{messages.specification_MindMap_title}" modal="true"
			style="width:75% !important;" draggable="false"
			widgetVar="requirementMindMap" dynamic="true" resizable="true">			
			<p:panel>
				<ui:include src="mindMapReq.xhtml" />
			</p:panel>
		</p:dialog>
	</ui:define>
</ui:composition>
</html>
