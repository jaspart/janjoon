<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">


	<h:panelGroup layout="block" id="layout-topbar">
		<h:panelGroup layout="block" id="logo" styleClass="Fleft">
			<!--a href="#"-->
			<h:link outcome="main">
				<p:graphicImage library="images" name="janjoon_logo.png"
					rendered="#{loginBean.contact.company.logo == null}"
					styleClass="banner" alt="JanJoon Home"
					style="float: left;margin: auto;margin-left: 25%;" />

				<p:graphicImage
					style="width:70px; height:70px;float: left;margin: auto;margin-left: 25%;"
					styleClass="banner" value="#{imageStreamer.image}"
					alt="JanJoon Home"
					rendered="#{loginBean.contact.company.logo != null}">
					<f:param name="contactId" value="#{loginBean.contact.id}" />
					<f:param name="company" value="true" />
				</p:graphicImage>
			</h:link>
			<a id="mobile-menu-button"
				class="Fright ShowOnMobile ripplelink Unselectable ShadowEffect"><i
				class="icon-add186"></i></a>
		</h:panelGroup>

		<a class="ripplelink WhiteBlue Fright ShowOnMobile" id="show-top-menu"><i
			class="icon-show8"></i></a>

		<ul id="top-menu" class="ShowOnDesktop">

			<li><a class="ripplelink"> <i class="icon-settings49"></i> <span
					class="Txt">#{loginBean.contact.firstname}
						#{loginBean.contact.name}</span></a>
				<ul>
					<li><a
						href="#{request.contextPath}/pages/contactConfig.jsf?faces-redirect=true">#{loginBean.contact.firstname}
							#{loginBean.contact.name}</a></li>
				</ul></li>
			<li class="ShowOnDesktop"><a class="ShowOnDesktop ripplelink"><i
					class="ShowOnDesktop icon-bubble8"></i> <span
					class="ShowOnDesktop Txt">Messages</span></a>
				<ul>
					<li><p:commandLink id="communicationButton"
							styleClass="ShowOnDesktop" type="button"
							title="#{message.header_communication_label}"
							onclick="PF('mPanel').loadContents()" immediate="true">
							#{loginBean.messageCount} Message</p:commandLink></li>
				</ul></li>
			<li><a class="ripplelink"><i class="icon-in-alt"></i> <span
					class="Txt">#{messages.header_logout_link}</span></a>
				<ul>
					<li><a href="logout.jsf">#{messages.header_logout_link}</a></li>
				</ul></li>
		</ul>
		<p:overlayPanel id="mPanel" for="communicationButton"
			hideEffect="clip" dynamic="true" style="width:300px"
			styleClass="ShowOnDesktop" widgetVar="mPanel">
			<f:event listener="#{jJMessageBean.initJJMessageLayout}"
				type="preRenderView" />
			<h:form id="messageCreationForm">
				<p:dataTable id="dataTable1" value="#{jJMessageBean.mainMessages}"
					rowKey="#{mes.id}" var="mes" paginator="true"
					paginatorPosition="bottom" rendered="#{loginBean.enable}"
					style="border-spacing:0px;" selectionMode="single" rows="5"
					paginatorTemplate="{CurrentPageReport} {PreviousPageLink} {NextPageLink}"
					lazy="true" emptyMessage="#{messages.label_notRecordFound}"
					sortBy="#{mes.creationDate}" sortOrder="DESCENDING">
					<p:ajax event="rowSelect" update=":viewMessagePanel"
						listener="#{jJMessageBean.onRowSelect}" immediate="true"
						oncomplete="PF('viewMessageDialogWidget').show()" />
					<p:column headerText="Messages" sortBy="#{mes.creationDate}"
						style="text-align: center;">
						<h:outputText value="#{mes.criticity.name}" style="color: #fff;"
							styleClass="#{mes.criticity.name}" />
						<h:outputText id="viewButton"
							value=" #{fn:substring(mes.message,0, 20)}"
							title="#{messages.label_view} #{mes.name}" />
					</p:column>
					<f:facet name="footer">
						<h:panelGroup layout="block" styleClass="Container ui-fluid" >
							<h:panelGroup layout="block" styleClass="Container100">
								<h:panelGroup layout="block" styleClass="ContainerIndent">
									<p:inputTextarea id="messagedsc" rows="6" placeholder="Message"
										value="#{jJMessageBean.message.message}"
										requiredMessage="#{messages.label_alert_message_null}"
										required="true" />
								</h:panelGroup>
							</h:panelGroup>
							<h:panelGroup layout="block" styleClass="Container100">
								<h:panelGroup layout="block" styleClass="Container40">
									<h:panelGroup layout="block" styleClass="ContainerIndent">
										<p:inputSwitch id="alert" 
											value="#{jJMessageBean.alertOrInfo}" onLabel="Alert"
											offLabel="Info" />
									</h:panelGroup>
								</h:panelGroup>
								<h:panelGroup layout="block" styleClass="Container60">
									<h:panelGroup layout="block" styleClass="ContainerIndent">
										<p:commandButton id="submitMes" icon="fa fa-send Fs20"
											process="@this,alert,messagedsc" value="#{messages.label_send}"
											actionListener="#{jJMessageBean.createMessage(false,null)}"
											update=":messageCreationForm :headerForm:communicationButton :communicationButton :growlForm" />
									</h:panelGroup>
								</h:panelGroup>
							</h:panelGroup>
						</h:panelGroup>
					</f:facet>
				</p:dataTable>
			</h:form>
		</p:overlayPanel>
	</h:panelGroup>
</ui:composition>
