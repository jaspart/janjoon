<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">
<ui:composition>
	<title>#{messages.label_appName}</title>
	<h:outputStylesheet library="css" name="standard.css" />
	<h:outputScript library="js" name="calendar.js" />
	<f:event listener="#{loginBean.loadingMain}" type="preRenderView" />

	<h:form id="headerForm">
		<p:remoteCommand name="updateCommunicationButton"
			update=":messageCreationForm communicationButton" />
		<h:panelGrid id="panelHeader" columns="#{loginBean.columns}"
			cellpadding="2" style="background-color:white;width:100%;">

			<h:link outcome="main">
				<p:graphicImage library="images" name="janjoon_logo.png"
					rendered="#{loginBean.contact.company.logo == null}"
					styleClass="banner" alt="JanJoon Home" style="float: left;" />

				<p:graphicImage style="width:75px; height:75px;float: left;"
					styleClass="banner" value="#{imageStreamer.image}"
					alt="JanJoon Home" cache="false"
					rendered="#{loginBean.contact.company.logo != null}">
					<f:param name="contactId" value="#{loginBean.contact.id}" />
					<f:param name="company" value="true" />
				</p:graphicImage>
			</h:link>


			<h:panelGrid id="panelMenu" columns="1" cellpadding="2"
				style="background-color:white;width:100%;">

				<h:panelGrid columns="8" align="left" style="width:100%;">

					<!--h:outputText value="#{messages.header_project_label}:" /-->
					<p:selectOneMenu id="projectSelectOneMenu"
						value="#{jJProjectBean.project}" panelStyle="width:120px"
						effect="fade" style="width:160px" filter="#{!loginBean.mobile}"
						valueChangeListener="#{loginBean.changeEvent}"
						filterMatchMode="contains"
						converter="com.starit.janjoonweb.ui.mb.converter.JJProjectConverter">

						<f:selectItem itemValue="#{null}"
							itemLabel="#{messages.header_any_project}" />
						<f:selectItems value="#{jJProjectBean.projectList}" var="p"
							itemLabel="#{p.name}" itemValue="#{p}" />
						<p:ajax onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()"
							update=":contentPanel tabMenu :scrollRight :messageCreationForm communicationButton :growlForm" />
						<!-- 																:messagePanel -->
					</p:selectOneMenu>

					<!--h:outputText value="#{messages.header_product_label}:" /-->
					<p:selectOneMenu id="productSelectOneMenu"
						value="#{jJProductBean.product}" panelStyle="width:120px"
						effect="fade" style="width:160px" filter="#{!loginBean.mobile}"
						valueChangeListener="#{loginBean.changeEvent}"
						filterMatchMode="contains"
						converter="com.starit.janjoonweb.ui.mb.converter.JJProductConverter">

						<f:selectItem itemValue="#{null}"
							itemLabel="#{messages.header_any_product}" />
						<f:selectItems value="#{jJProductBean.productList}" var="p"
							itemLabel="#{p.name}" itemValue="#{p}" />
						<p:ajax onstart="PF('blockUIWidget').block()"
							update="versionSelectOneMenu :contentPanel tabMenu :scrollRight :messageCreationForm communicationButton :growlForm"
							oncomplete="PF('blockUIWidget').unblock()" />
						<!-- 																:messagePanel -->
					</p:selectOneMenu>

					<!--h:outputText value="#{messages.header_version_label}:" /-->
					<p:selectOneMenu id="versionSelectOneMenu"
						value="#{jJVersionBean.version}" panelStyle="width:120px"
						effect="fade" style="width:160px" filter="#{!loginBean.mobile}"
						valueChangeListener="#{loginBean.changeEvent}"
						converter="com.starit.janjoonweb.ui.mb.converter.JJVersionConverter"
						filterMatchMode="contains" disabled="#{jJVersionBean.disabled}">

						<f:selectItem itemValue="#{null}"
							itemLabel="#{messages.header_any_version}" />

						<f:selectItems value="#{jJVersionBean.versionList}" var="v"
							itemLabel="#{v.name}" itemValue="#{v}" />

						<p:ajax onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()"
							update=":contentPanel :growlForm" />
					</p:selectOneMenu>

					<p:splitButton
						value="#{loginBean.contact.firstname} #{loginBean.contact.name}"
						icon="ui-icon-person" actionListener="#{loginBean.contactConfig}"
						rendered="#{loginBean.enable}" style="right: 0px;">
						<p:menuitem value="#{messages.header_config_link}"
							icon="ui-icon-person"
							url="/pages/contactConfig.jsf?faces-redirect=true" />
						<p:menuitem value="#{messages.header_logout_link}"
							url="logout.jsf" actionListener="#{loginBean.logout}"
							icon="ui-icon-extlink" />
					</p:splitButton>
					<p:commandButton id="communicationButton" icon="ui-icon-comment"
						value="#{loginBean.messageCount}" type="button"		
						onclick="PF('mPanel').loadContents()" immediate="true"				
						title="#{message.header_communication_label}"
						rendered="#{loginBean.enable}" />
				</h:panelGrid>

				<p:tabMenu id="tabMenu" name="content" binding="#{tabMenu}" style="float: none;"
					activeIndex="#{loginBean.menuIndex}"
					rendered="#{loginBean.enable and !loginBean.mobile}">

					<p:menuitem value="" icon="ui-icon-home"
						url="/pages/main.jsf?faces-redirect=true" style="width: 10px;" />				

					<p:menuitem id="proAction"
						value="#{messages.header_project_menuitem}"
						title="#{loginBean.authorisationService.rProjectMSG}"
						onstart="PF('blockUIWidget').block()"
						actionListener="#{loginBean.redirection}" update=":growlForm"
						icon="ui-icon-calendar" style="min-width: 80px;"
						rendered="#{loginBean.enable and !loginBean.mobile and loginBean.authorisationService.rProject}" />

					<p:menuitem value="#{messages.header_spec_menuitem}"
						title="#{loginBean.authorisationService.rRequiementMSG}"
						url="/pages/specifications.jsf?faces-redirect=true"
						icon="ui-icon-document"
						rendered="#{loginBean.authorisationService.rRequiement}" />				

					<p:menuitem value="#{messages.header_bug_menuitem}"
						rendered="#{!loginBean.mobile and loginBean.authorisationService.rBug}"
						title="#{loginBean.authorisationService.rBugMSG}"
						url="/pages/bugs.jsf?faces-redirect=true" icon="ui-icon-gear" />				

					<p:menuitem id="devAction" value="#{messages.header_dev_menuitem}"
						onstart="PF('blockUIWidget').block()"
						title="#{loginBean.authorisationService.rwDevMSG}"
						actionListener="#{loginBean.redirectToDev}" update=":growlForm"
						icon="ui-icon-wrench"
						rendered="#{loginBean.authorisationService.rwDev}" />

					<p:menuitem id="testAction"
						title="#{loginBean.authorisationService.rTestMSG}"
						value="#{messages.header_test_menuitem}"
						onstart="PF('blockUIWidget').block()"
						actionListener="#{loginBean.redirection}" update=":growlForm"
						icon="ui-icon-clipboard"
						rendered="#{loginBean.authorisationService.rTest}" />

					<p:menuitem value="#{messages.header_exploitation_menuitem}"
						title="#{messages.header_exploitation_menuitemhelp}"
						rendered="false" style="min-width: 80px;"
						url="/pages/exploitation.jsf?faces-redirect=true"
						icon="ui-icon-suitcase" />

					<p:menuitem value="#{messages.header_delivery_menuitem}"
						rendered="#{loginBean.authorisationService.rBuild}"
						title="#{loginBean.authorisationService.rBuildMSG}"
						url="/pages/delivery.jsf?faces-redirect=true" icon="ui-icon-star" />					

					<p:menuitem value="#{messages.header_team_menuitem}"
						rendered="#{loginBean.authorisationService.rProject}"
						title="#{messages.header_team_menuitem}"
						url="/pages/teams.jsf?faces-redirect=true" icon="ui-icon-person" />					

					<p:menuitem id="statsAction"
						title="#{messages.header_stat_menuitemhelp}"
						value="#{messages.header_stat_menuitem}"
						onstart="PF('blockUIWidget').block()"
						actionListener="#{loginBean.redirection}" update=":growlForm"
						icon="ui-icon-calculator"
						rendered="#{loginBean.authorisationService.rProject}" />

					<p:menuitem value="#{messages.header_admin_menuitem}"
						title="#{messages.header_admin_menuitemhelp}"
						rendered="#{loginBean.authorisationService.renderAdmin}"
						url="/pages/administration.jsf?faces-redirect=true"
						icon="ui-icon-key" update=":contentPanel" />

				</p:tabMenu>
			</h:panelGrid>
			<p:commandButton value="&#9776;" id="pnl-basic"
				oncomplete="PF('headerPanel').show();"
				style="font-weight: bold;font-size: x-large;"
				rendered="#{loginBean.mobile}" />
		</h:panelGrid>
		<!--p:sticky target="panelMenu" /-->
	</h:form>
</ui:composition>
</html>
